{"version":3,"sources":["../../../../../../strony_www/drozniak-landingpage/app/panel/marketing/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useCallback, useEffect, useRef, createContext, useContext } from 'react';\nimport { createPortal } from 'react-dom';\nimport {\n  ReactFlow,\n  Node,\n  Edge,\n  addEdge,\n  Connection,\n  useNodesState,\n  useEdgesState,\n  Controls,\n  MiniMap,\n  Background,\n  BackgroundVariant,\n  Panel,\n  NodeTypes,\n  EdgeTypes,\n  MarkerType,\n  getBezierPath,\n  getSmoothStepPath,\n  EdgeLabelRenderer,\n  Handle,\n  Position,\n  NodeResizer,\n  BaseEdge,\n  type NodeChange,\n  type EdgeChange,\n} from '@xyflow/react';\n// CSS React Flow jest importowany globalnie w index.tsx\nimport * as SimpleIcons from 'simple-icons';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/app/hooks/useAuth';\nimport { supabase } from '@/lib/supabase-client';\nimport { AlertModal } from '@/components/AlertModal';\nimport { LoadingState } from '@/components/LoadingState';\nimport { CustomSelect } from '@/components/CustomSelect';\nimport { CustomCheckbox } from '@/components/CustomCheckbox';\nimport { IconPicker } from '@/components/IconPicker';\nimport { CommentPanel } from '@/components/CommentPanel';\nimport { CommentThread } from '@/components/CommentThread';\nimport { CommentForm } from '@/components/CommentForm';\nimport { CommentBadge } from '@/components/CommentBadge';\nimport { \n  MegaphoneSimple, \n  MagnifyingGlass, \n  Envelope, \n  DeviceMobile, \n  Globe, \n  FileText, \n  CreditCard, \n  CheckCircle, \n  Notebook, \n  PresentationChart, \n  ChatCircle, \n  Phone, \n  Gear,\n  DotsThree,\n  // Dodatkowe ikony dla marketingu\n  Money,\n  Wallet,\n  ShoppingCart,\n  Tag,\n  CurrencyDollar,\n  Storefront,\n  TrendUp,\n  TrendDown,\n  ChartLine,\n  Users,\n  User,\n  Calendar,\n  Clock,\n  PaperPlaneTilt,\n  VideoCamera,\n  Camera,\n  Image,\n  Link,\n  Share,\n  Heart,\n  Star,\n  Bell,\n  Warning,\n  Info,\n  Question,\n  Check,\n  X,\n  Plus,\n  Minus,\n  ArrowRight,\n  ArrowLeft,\n  ArrowUp,\n  ArrowDown,\n  Download,\n  Upload,\n  Eye,\n  EyeSlash,\n  Lock,\n  LockOpen,\n  Key,\n  Shield,\n  Trash,\n  Pencil,\n  Copy,\n  Clipboard,\n  Folder,\n  Database,\n  Cloud,\n  WifiHigh,\n  Broadcast,\n  // Ikony dla systemu komentarzy\n  ChatCircleDots,\n  CheckSquare,\n  ClipboardText,\n  Funnel,\n  CrosshairSimple,\n  ArrowSquareOut,\n  XCircle,\n  Spinner,\n  ShieldCheck,\n  WarningCircle,\n  Hand\n} from 'phosphor-react';\n\n// Kontekst trybu zaznaczania: klik = dodaj do zaznaczenia, przytrzymaj = odznacz ten element\nconst FunnelSelectModeContext = createContext<{\n  isSelectMode: boolean;\n  onLongPressDeselect: (nodeId: string) => void;\n}>({ isSelectMode: false, onLongPressDeselect: () => {} });\n\n// Mapowanie starych emotikonÃ³w na nazwy ikon Phosphor\nconst iconEmojiMap: Record<string, string> = {\n  'ðŸ“¢': 'MegaphoneSimple',\n  'ðŸ”': 'MagnifyingGlass',\n  'ðŸ“§': 'Envelope',\n  'ðŸ“±': 'DeviceMobile',\n  'âš™ï¸': 'Gear',\n  'ðŸŒ': 'Globe',\n  'ðŸ“„': 'FileText',\n  'ðŸ’³': 'CreditCard',\n  'âœ…': 'CheckCircle',\n  'ðŸ“': 'Notebook',\n  'ðŸ“Š': 'PresentationChart',\n  'ðŸ’¬': 'ChatCircle',\n  'ðŸ“ž': 'Phone',\n};\n\n// Funkcja renderujÄ…ca Simple Icons logotypy marek (monochromatyczne)\nconst renderSimpleIcon = (slug: string, size: number = 24, className: string = '') => {\n  try {\n    const iconKey = `si${slug.charAt(0).toUpperCase() + slug.slice(1)}` as keyof typeof SimpleIcons;\n    const icon = (SimpleIcons as any)[iconKey];\n    if (!icon || !icon.path) return null;\n    \n    return (\n      <svg\n        role=\"img\"\n        viewBox=\"0 0 24 24\"\n        width={size}\n        height={size}\n        className={className}\n        fill=\"currentColor\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path d={icon.path} />\n      </svg>\n    );\n  } catch (e) {\n    return null;\n  }\n};\n\n// Funkcja renderujÄ…ca ikonÄ™ Phosphor na podstawie nazwy (obsÅ‚uguje teÅ¼ stare emotikony i Simple Icons)\nconst renderPhosphorIcon = (iconName: string, size: number = 24, className: string = '') => {\n  // JeÅ›li ikona zaczyna siÄ™ od \"simple:\", uÅ¼yj Simple Icons\n  if (iconName.startsWith('simple:')) {\n    const slug = iconName.replace('simple:', '');\n    return renderSimpleIcon(slug, size, className);\n  }\n  \n  const iconProps = { size, weight: 'regular' as const, className, color: 'currentColor' };\n  \n  // JeÅ›li to emotikon, zamieÅ„ na nazwÄ™ ikony Phosphor\n  const mappedIcon = iconEmojiMap[iconName] || iconName;\n  \n  switch (mappedIcon) {\n    case 'MegaphoneSimple': return <MegaphoneSimple {...iconProps} />;\n    case 'MagnifyingGlass': return <MagnifyingGlass {...iconProps} />;\n    case 'Envelope': return <Envelope {...iconProps} />;\n    case 'DeviceMobile': return <DeviceMobile {...iconProps} />;\n    case 'Globe': return <Globe {...iconProps} />;\n    case 'FileText': return <FileText {...iconProps} />;\n    case 'CreditCard': return <CreditCard {...iconProps} />;\n    case 'CheckCircle': return <CheckCircle {...iconProps} />;\n    case 'Notebook': return <Notebook {...iconProps} />;\n    case 'PresentationChart': return <PresentationChart {...iconProps} />;\n    case 'ChatCircle': return <ChatCircle {...iconProps} />;\n    case 'Phone': return <Phone {...iconProps} />;\n    case 'Gear': return <Gear {...iconProps} />;\n    case 'DotsThree': return <DotsThree {...iconProps} />;\n    // Dodatkowe ikony\n    case 'Money': return <Money {...iconProps} />;\n    case 'Wallet': return <Wallet {...iconProps} />;\n    case 'ShoppingCart': return <ShoppingCart {...iconProps} />;\n    case 'Tag': return <Tag {...iconProps} />;\n    case 'CurrencyDollar': return <CurrencyDollar {...iconProps} />;\n    case 'Storefront': return <Storefront {...iconProps} />;\n    case 'TrendUp': return <TrendUp {...iconProps} />;\n    case 'TrendDown': return <TrendDown {...iconProps} />;\n    case 'ChartLine': return <ChartLine {...iconProps} />;\n    case 'Users': return <Users {...iconProps} />;\n    case 'User': return <User {...iconProps} />;\n    case 'Calendar': return <Calendar {...iconProps} />;\n    case 'Clock': return <Clock {...iconProps} />;\n    case 'PaperPlaneTilt': return <PaperPlaneTilt {...iconProps} />;\n    case 'VideoCamera': return <VideoCamera {...iconProps} />;\n    case 'Camera': return <Camera {...iconProps} />;\n    case 'Image': return <Image {...iconProps} />;\n    case 'Link': return <Link {...iconProps} />;\n    case 'Share': return <Share {...iconProps} />;\n    case 'Heart': return <Heart {...iconProps} />;\n    case 'Star': return <Star {...iconProps} />;\n    case 'Bell': return <Bell {...iconProps} />;\n    case 'Warning': return <Warning {...iconProps} />;\n    case 'Info': return <Info {...iconProps} />;\n    case 'Question': return <Question {...iconProps} />;\n    case 'Check': return <Check {...iconProps} />;\n    case 'X': return <X {...iconProps} />;\n    case 'Plus': return <Plus {...iconProps} />;\n    case 'Minus': return <Minus {...iconProps} />;\n    case 'ArrowRight': return <ArrowRight {...iconProps} />;\n    case 'ArrowLeft': return <ArrowLeft {...iconProps} />;\n    case 'ArrowUp': return <ArrowUp {...iconProps} />;\n    case 'ArrowDown': return <ArrowDown {...iconProps} />;\n    case 'Download': return <Download {...iconProps} />;\n    case 'Upload': return <Upload {...iconProps} />;\n    case 'Eye': return <Eye {...iconProps} />;\n    case 'EyeSlash': return <EyeSlash {...iconProps} />;\n    case 'Lock': return <Lock {...iconProps} />;\n    case 'LockOpen': return <LockOpen {...iconProps} />;\n    case 'Key': return <Key {...iconProps} />;\n    case 'Shield': return <Shield {...iconProps} />;\n    case 'Trash': return <Trash {...iconProps} />;\n    case 'Pencil': return <Pencil {...iconProps} />;\n    case 'Copy': return <Copy {...iconProps} />;\n    case 'Clipboard': return <Clipboard {...iconProps} />;\n    case 'Folder': return <Folder {...iconProps} />;\n    case 'Database': return <Database {...iconProps} />;\n    case 'Cloud': return <Cloud {...iconProps} />;\n    case 'WifiHigh': return <WifiHigh {...iconProps} />;\n    case 'Broadcast': return <Broadcast {...iconProps} />;\n    default: return <FileText {...iconProps} />;\n  }\n};\n\n// Custom Node Types\ninterface CustomNodeData {\n  label: string;\n  icon: string;\n  color?: string;\n  notes?: string;\n  link?: string; // Link do konkretnego elementu\n  isPinned?: boolean;\n  category?: string; // Kategoria dla wizualnych wskaÅºnikÃ³w\n  customFields?: NodeCustomField[]; // Customowe pola (tekst, data, liczba, link)\n}\n\ninterface NodeCustomField {\n  id?: string;\n  field_name: string;\n  field_type: 'text' | 'date' | 'number' | 'link';\n  field_value: string;\n  display_order?: number;\n}\n\ninterface EdgeCustomField {\n  id?: string;\n  field_name: string;\n  field_type: 'text' | 'date' | 'number' | 'link';\n  field_value: string;\n  display_order?: number;\n}\n\ninterface TextNodeData {\n  text: string;\n  fontSize?: number;\n  fontWeight?: 'normal' | 'bold' | 'semibold';\n  textAlign?: 'left' | 'center' | 'right';\n  verticalAlign?: 'top' | 'middle' | 'bottom';\n  showHandles?: boolean;\n  width?: number;\n  height?: number;\n  isPinned?: boolean;\n}\n\n// Custom Node Component with Handles (connection points)\nconst CustomNode: React.FC<{ id: string; data: CustomNodeData & { commentCount?: number; commentStatus?: 'warning' | 'pending' | 'neutral' | 'closed' }; selected?: boolean }> = ({ id, data, selected }) => {\n  return (\n    <div\n      className={`px-5 py-4 rounded-xl border-2 transition-all duration-200 min-w-[120px] relative group ${\n        selected\n          ? 'border-[#fee715] shadow-lg shadow-[#fee715]/30 bg-[#18232F]'\n          : 'border-[#fee715]/20 bg-[#0a0f14] hover:border-[#fee715]/50 hover:bg-[#18232F]'\n      }`}\n      style={{\n        boxShadow: selected ? '0 0 20px rgba(254, 231, 21, 0.3)' : '0 4px 6px rgba(0, 0, 0, 0.1)',\n      }}\n    >\n      {/* Comment Badge */}\n      {data.commentCount !== undefined && data.commentCount > 0 && (\n        <CommentBadge\n          count={data.commentCount}\n          status={(data.commentStatus === 'closed' ? 'neutral' : data.commentStatus) || 'neutral'}\n          onClick={() => {}}\n        />\n      )}\n      {/* Jedno kÃ³Å‚ko na stronÄ™: przeciÄ…gnij z kropki do kropki na drugim panelu (tryb loose = sourceâ†’source). */}\n      {/* Uchwyty sÄ… przezroczyste i pojawiajÄ… siÄ™ tylko na hover noda */}\n      <Handle type=\"source\" position={Position.Top} id=\"top\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ top: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n      <Handle type=\"source\" position={Position.Bottom} id=\"bottom\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ bottom: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n      <Handle type=\"source\" position={Position.Left} id=\"left\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ left: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n      <Handle type=\"source\" position={Position.Right} id=\"right\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ right: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n      \n\n      <div className=\"flex items-center gap-3 mb-2\">\n        <div\n          className=\"w-9 h-9 rounded-lg flex items-center justify-center\"\n          style={{ backgroundColor: data.color || '#fee71520', color: '#101820' }}\n        >\n          {renderPhosphorIcon(data.icon, 20)}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"text-sm font-medium text-white leading-tight\">{data.label}</div>\n        </div>\n      </div>\n      {data.notes && (\n        <div className=\"text-xs text-gray-400 mt-1 line-clamp-1\">{data.notes}</div>\n      )}\n      {data.link && (\n        <div className=\"text-xs text-[#fee715] mt-1 line-clamp-1 flex items-center gap-1\">\n          <Link size={12} weight=\"bold\" />\n          <a href={data.link} target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:underline\" onClick={(e) => e.stopPropagation()}>\n            {data.link.length > 30 ? data.link.substring(0, 30) + '...' : data.link}\n          </a>\n        </div>\n      )}\n      {data.customFields && data.customFields.length > 0 && (\n        <div className=\"mt-2 pt-2 border-t border-white/5 space-y-1\">\n          {data.customFields.map((field, index) => (\n            <div key={index} className=\"text-xs text-gray-400 flex items-center gap-2\">\n              <span className=\"text-gray-500 font-medium\">{field.field_name}:</span>\n              {field.field_type === 'link' ? (\n                <a \n                  href={field.field_value} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\" \n                  className=\"text-[#fee715] hover:underline line-clamp-1\" \n                  onClick={(e) => e.stopPropagation()}\n                >\n                  {field.field_value.length > 25 ? field.field_value.substring(0, 25) + '...' : field.field_value}\n                </a>\n              ) : field.field_type === 'date' ? (\n                <span>{field.field_value ? new Date(field.field_value).toLocaleDateString('pl-PL') : '-'}</span>\n              ) : (\n                <span className=\"line-clamp-1\">{field.field_value || '-'}</span>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Custom Edge: linia od A (source) do B (target), strzaÅ‚ka TYLKO na koÅ„cu w B (kierunek Aâ†’B)\nconst CustomEdge = ({ id, sourceX, sourceY, targetX, targetY, sourcePosition, targetPosition, data, style, markerEnd }: any) => {\n  const [edgePath, labelX, labelY] = getSmoothStepPath({\n    sourceX,\n    sourceY,\n    sourcePosition,\n    targetX,\n    targetY,\n    targetPosition,\n    borderRadius: 20,\n  });\n\n  // Oblicz dÅ‚ugoÅ›Ä‡ Å›cieÅ¼ki i pozycjÄ™ wzdÅ‚uÅ¼ Å›cieÅ¼ki\n  const pathElementRef = React.useRef<SVGPathElement | null>(null);\n  \n  React.useEffect(() => {\n    if (pathElementRef.current) return;\n    const svgPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    svgPath.setAttribute('d', edgePath);\n    pathElementRef.current = svgPath;\n  }, [edgePath]);\n\n  // Oblicz offset dla etykiety, aby uniknÄ…Ä‡ kolizji z innymi etykietami\n  const [labelOffset, setLabelOffset] = React.useState(0);\n  const labelRef = React.useRef<HTMLDivElement>(null);\n\n  React.useEffect(() => {\n    if (!data?.notes || !labelRef.current || !pathElementRef.current) return;\n\n    const checkCollisions = () => {\n      const currentLabel = labelRef.current;\n      if (!currentLabel) return;\n\n      const currentRect = currentLabel.getBoundingClientRect();\n      const allLabels = document.querySelectorAll('[data-edge-label]');\n      \n      // SprawdÅº kolizje z innymi etykietami\n      const margin = 15; // Margines dla wykrywania kolizji\n      let hasCollision = false;\n      for (const otherLabel of allLabels) {\n        if (otherLabel === currentLabel) continue;\n        const otherRect = otherLabel.getBoundingClientRect();\n        \n        // SprawdÅº czy prostokÄ…ty siÄ™ nakÅ‚adajÄ… (z marginesem 15px)\n        const overlapX = !(currentRect.right + margin < otherRect.left || currentRect.left - margin > otherRect.right);\n        const overlapY = !(currentRect.bottom + margin < otherRect.top || currentRect.top - margin > otherRect.bottom);\n        \n        if (overlapX && overlapY) {\n          hasCollision = true;\n          break;\n        }\n      }\n\n      // JeÅ›li jest kolizja, przesuÅ„ etykietÄ™ wzdÅ‚uÅ¼ Å›cieÅ¼ki\n      if (hasCollision && pathElementRef.current) {\n        try {\n          const pathLength = pathElementRef.current.getTotalLength();\n          const midPoint = pathLength / 2;\n          const offsetStep = 30; // Krok przesuniÄ™cia w pikselach\n          const maxOffset = pathLength * 0.25; // Maksymalne przesuniÄ™cie (25% dÅ‚ugoÅ›ci)\n          \n          // SprÃ³buj przesunÄ…Ä‡ w gÃ³rÄ™ i w dÃ³Å‚ Å›cieÅ¼ki\n          let bestOffset = 0;\n          for (let offset = offsetStep; offset <= maxOffset; offset += offsetStep) {\n            // SprÃ³buj w gÃ³rÄ™\n            const pointUp = pathElementRef.current.getPointAtLength(midPoint - offset);\n            const testRectUp = {\n              left: pointUp.x - currentRect.width / 2,\n              right: pointUp.x + currentRect.width / 2,\n              top: pointUp.y - currentRect.height / 2,\n              bottom: pointUp.y + currentRect.height / 2,\n            };\n            \n            let collisionUp = false;\n            for (const otherLabel of allLabels) {\n              if (otherLabel === currentLabel) continue;\n              const otherRect = otherLabel.getBoundingClientRect();\n              const overlapX = !(testRectUp.right + margin < otherRect.left || testRectUp.left - margin > otherRect.right);\n              const overlapY = !(testRectUp.bottom + margin < otherRect.top || testRectUp.top - margin > otherRect.bottom);\n              if (overlapX && overlapY) {\n                collisionUp = true;\n                break;\n              }\n            }\n            \n            if (!collisionUp) {\n              bestOffset = -offset;\n              break;\n            }\n            \n            // SprÃ³buj w dÃ³Å‚\n            const pointDown = pathElementRef.current.getPointAtLength(midPoint + offset);\n            const testRectDown = {\n              left: pointDown.x - currentRect.width / 2,\n              right: pointDown.x + currentRect.width / 2,\n              top: pointDown.y - currentRect.height / 2,\n              bottom: pointDown.y + currentRect.height / 2,\n            };\n            \n            let collisionDown = false;\n            for (const otherLabel of allLabels) {\n              if (otherLabel === currentLabel) continue;\n              const otherRect = otherLabel.getBoundingClientRect();\n              const overlapX = !(testRectDown.right + margin < otherRect.left || testRectDown.left - margin > otherRect.right);\n              const overlapY = !(testRectDown.bottom + margin < otherRect.top || testRectDown.top - margin > otherRect.bottom);\n              if (overlapX && overlapY) {\n                collisionDown = true;\n                break;\n              }\n            }\n            \n            if (!collisionDown) {\n              bestOffset = offset;\n              break;\n            }\n          }\n          \n          setLabelOffset(bestOffset);\n        } catch (e) {\n          // Ignoruj bÅ‚Ä™dy\n        }\n      } else {\n        setLabelOffset(0);\n      }\n    };\n\n    // OpÃ³Åºnij sprawdzenie, aby wszystkie etykiety byÅ‚y juÅ¼ wyrenderowane\n    const timeoutId = setTimeout(checkCollisions, 150);\n    return () => clearTimeout(timeoutId);\n  }, [data?.notes, edgePath, labelX, labelY]);\n\n  // Oblicz finalnÄ… pozycjÄ™ etykiety\n  const finalPosition = React.useMemo(() => {\n    if (labelOffset === 0 || !pathElementRef.current) {\n      return { x: labelX, y: labelY };\n    }\n    \n    try {\n      const pathLength = pathElementRef.current.getTotalLength();\n      const point = pathElementRef.current.getPointAtLength(pathLength / 2 + labelOffset);\n      return { x: point.x, y: point.y };\n    } catch (e) {\n      return { x: labelX, y: labelY };\n    }\n  }, [labelX, labelY, labelOffset]);\n\n  return (\n    <>\n      <BaseEdge\n        id={id}\n        path={edgePath}\n        style={style}\n        markerEnd={markerEnd}\n        markerStart={undefined}\n      />\n      {/* Comment Badge dla edge */}\n      {data?.commentCount !== undefined && data.commentCount > 0 && (\n        <EdgeLabelRenderer>\n          <div\n            style={{\n              position: 'absolute',\n              transform: `translate(-50%, -50%) translate(${labelX}px,${labelY - 20}px)`,\n            }}\n            className=\"nodrag nopan\"\n          >\n            <CommentBadge\n              count={data.commentCount}\n              status={(data.commentStatus === 'closed' ? 'neutral' : data.commentStatus) || 'neutral'}\n              onClick={() => {}}\n            />\n          </div>\n        </EdgeLabelRenderer>\n      )}\n      {data?.notes && (\n        <EdgeLabelRenderer>\n          <div\n            ref={labelRef}\n            data-edge-label={id}\n            style={{\n              position: 'absolute',\n              transform: `translate(-50%, -50%) translate(${finalPosition.x}px,${finalPosition.y}px)`,\n            }}\n            className=\"nodrag nopan\"\n          >\n            <div className=\"px-2 py-1 bg-[#fee715] text-[#101820] text-xs font-semibold rounded shadow-lg border-2 border-[#101820] max-w-[200px] break-words whitespace-normal leading-tight\">\n              {data.notes}\n              {data?.link && (\n                <a\n                  href={data.link}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  onClick={(e) => e.stopPropagation()}\n                  className=\"block mt-1 text-[#101820] underline hover:text-blue-600\"\n                >\n                  ðŸ”— Link\n                </a>\n              )}\n            </div>\n          </div>\n        </EdgeLabelRenderer>\n      )}\n    </>\n  );\n};\n\n// Text Node Component (tekst + handles do Å‚Ä…czenia, z moÅ¼liwoÅ›ciÄ… resize)\nconst TextNode: React.FC<{ id: string; data: TextNodeData & { commentCount?: number; commentStatus?: 'warning' | 'pending' | 'neutral' | 'closed' }; selected?: boolean; width?: number; height?: number }> = ({ id, data, selected, width, height }) => {\n\n  // UÅ¼yj width/height z props (React Flow automatycznie je aktualizuje przez NodeResizer) lub z data, lub domyÅ›lne\n  const nodeWidth = width || data.width || 250;\n  const nodeHeight = height || data.height || 100;\n\n  return (\n    <div\n      className={`px-8 py-5 rounded-xl border-2 transition-all duration-200 relative group ${\n        selected\n          ? 'border-[#fee715] shadow-lg shadow-[#fee715]/30 bg-[#18232F]'\n          : 'border-[#fee715]/20 bg-[#0a0f14] hover:border-[#fee715]/50 hover:bg-[#18232F]'\n      }`}\n      style={{\n        boxShadow: selected ? '0 0 20px rgba(254, 231, 21, 0.3)' : '0 4px 6px rgba(0, 0, 0, 0.1)',\n        width: nodeWidth,\n        height: nodeHeight,\n        minWidth: 150,\n        minHeight: 60,\n      }}\n    >\n      {/* Comment Badge */}\n      {data.commentCount !== undefined && data.commentCount > 0 && (\n        <CommentBadge\n          count={data.commentCount}\n          status={(data.commentStatus === 'closed' ? 'neutral' : data.commentStatus) || 'neutral'}\n          onClick={() => {}}\n        />\n      )}\n      {/* Handles tylko jeÅ›li wÅ‚Ä…czone (domyÅ›lnie wyÅ‚Ä…czone dla paneli tekstowych) */}\n      {/* Uchwyty sÄ… przezroczyste i pojawiajÄ… siÄ™ tylko na hover noda */}\n      {data.showHandles && (\n        <>\n          <Handle type=\"source\" position={Position.Top} id=\"top\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ top: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n          <Handle type=\"source\" position={Position.Bottom} id=\"bottom\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ bottom: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n          <Handle type=\"source\" position={Position.Left} id=\"left\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ left: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n          <Handle type=\"source\" position={Position.Right} id=\"right\" className=\"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100\" style={{ right: -10 }} title=\"PrzeciÄ…gnij do kropki na drugim panelu\" />\n        </>\n      )}\n      <NodeResizer\n        color=\"#fee715\"\n        isVisible={selected}\n        minWidth={150}\n        minHeight={60}\n        handleStyle={{\n          backgroundColor: '#fee715',\n          border: '2px solid #101820',\n          borderRadius: '4px',\n          width: '10px',\n          height: '10px',\n        }}\n      />\n      <div\n        className=\"text-white break-words h-full w-full flex\"\n        style={{\n          fontSize: data.fontSize || 16,\n          fontWeight: data.fontWeight || 'normal',\n          textAlign: data.textAlign || 'left',\n          justifyContent: data.textAlign === 'center' ? 'center' : data.textAlign === 'right' ? 'flex-end' : 'flex-start',\n          alignItems: data.verticalAlign === 'top' ? 'flex-start' : data.verticalAlign === 'bottom' ? 'flex-end' : 'center',\n          padding: '8px',\n        }}\n      >\n        {data.text || 'Kliknij, aby edytowaÄ‡'}\n      </div>\n    </div>\n  );\n};\n\n// Node Types Configuration\nconst nodeTypes: NodeTypes = {\n  custom: CustomNode,\n  text: TextNode,\n};\n\n// Edge Types Configuration\nconst edgeTypes = {\n  custom: CustomEdge,\n};\n\n// Available Node Templates (Sidebar)\nconst nodeTemplates = [\n  { type: 'text', icon: 'FileText', label: 'Tekst', category: 'NarzÄ™dzia' },\n  // Å¹rÃ³dÅ‚a Ruchu\n  { type: 'custom', icon: 'simple:facebook', label: 'Facebook Ads', color: '#1877F2', category: 'Å¹rÃ³dÅ‚a Ruchu' },\n  { type: 'custom', icon: 'simple:google', label: 'Google Ads', color: '#4285F4', category: 'Å¹rÃ³dÅ‚a Ruchu' },\n  { type: 'custom', icon: 'Envelope', label: 'Email', color: '#EA4335', category: 'Å¹rÃ³dÅ‚a Ruchu' },\n  { type: 'custom', icon: 'simple:instagram', label: 'Instagram', color: '#E4405F', category: 'Å¹rÃ³dÅ‚a Ruchu' },\n  { type: 'custom', icon: 'simple:youtube', label: 'Youtube', color: '#FF0000', category: 'Å¹rÃ³dÅ‚a Ruchu' },\n  { type: 'custom', icon: 'Gear', label: 'Inne', color: '#fee715', category: 'Å¹rÃ³dÅ‚a Ruchu', isCustom: true },\n  // Typ Strony\n  { type: 'custom', icon: 'Globe', label: 'Landing', color: '#00C9A7', category: 'Typ Strony' },\n  { type: 'custom', icon: 'FileText', label: 'Sales page', color: '#00C9A7', category: 'Typ Strony' },\n  { type: 'custom', icon: 'CreditCard', label: 'Checkout', color: '#00C9A7', category: 'Typ Strony' },\n  { type: 'custom', icon: 'CheckCircle', label: 'Thank you', color: '#00C9A7', category: 'Typ Strony' },\n  { type: 'custom', icon: 'Gear', label: 'Inne', color: '#00C9A7', category: 'Typ Strony', isCustom: true },\n  // DziaÅ‚ania\n  { type: 'custom', icon: 'Notebook', label: 'Ebook', color: '#fee715', category: 'DziaÅ‚ania' },\n  { type: 'custom', icon: 'Phone', label: 'Rozmowa', color: '#fee715', category: 'DziaÅ‚ania' },\n  { type: 'custom', icon: 'FileText', label: 'Formularz', color: '#fee715', category: 'DziaÅ‚ania' },\n  { type: 'custom', icon: 'PresentationChart', label: 'Webinar', color: '#fee715', category: 'DziaÅ‚ania' },\n  { type: 'custom', icon: 'Gear', label: 'Inne', color: '#fee715', category: 'DziaÅ‚ania', isCustom: true },\n  // Cel/Konwersja\n  { type: 'custom', icon: 'CheckCircle', label: 'Lead', color: '#10B981', category: 'Cel/Konwersja' },\n  { type: 'custom', icon: 'Calendar', label: 'Rezerwacja', color: '#10B981', category: 'Cel/Konwersja' },\n  { type: 'custom', icon: 'Phone', label: 'Telefon', color: '#10B981', category: 'Cel/Konwersja' },\n  { type: 'custom', icon: 'CurrencyDollar', label: 'SprzedaÅ¼', color: '#10B981', category: 'Cel/Konwersja' },\n  { type: 'custom', icon: 'Gear', label: 'Inne', color: '#10B981', category: 'Cel/Konwersja', isCustom: true },\n];\n\ninterface FunnelDiagram {\n  id: string;\n  project_name: string;\n  client_id: string | null;\n  diagram_data: any;\n  status: string;\n  subtitle?: string | null;\n}\n\n// DatePickerField component for custom fields\nexport interface DatePickerFieldProps {\n  value: string;\n  onChange: (value: string) => void;\n}\n\nexport const DatePickerField: React.FC<DatePickerFieldProps> = ({ value, onChange }) => {\n  const [isDatePickerOpen, setIsDatePickerOpen] = useState(false);\n  const datePickerRef = useRef<HTMLDivElement>(null);\n  const calendarRef = useRef<HTMLDivElement>(null);\n  const [calendarStyle, setCalendarStyle] = useState<React.CSSProperties>({});\n\n  const formatDateForDisplay = (dateStr: string) => {\n    if (!dateStr) return 'dd.mm.rrrr';\n    const date = new Date(dateStr + 'T00:00:00');\n    return date.toLocaleDateString('pl-PL', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const formatDateForInput = (date: Date) => {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  };\n\n  const getCalendarDays = () => {\n    const currentDate = value ? new Date(value + 'T00:00:00') : new Date();\n    const year = currentDate.getFullYear();\n    const month = currentDate.getMonth();\n\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n    const daysInMonth = lastDay.getDate();\n    const startingDayOfWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;\n\n    const days = [];\n\n    const prevMonthLastDay = new Date(year, month, 0).getDate();\n    for (let i = startingDayOfWeek - 1; i >= 0; i--) {\n      days.push({\n        day: prevMonthLastDay - i,\n        isCurrentMonth: false,\n        date: new Date(year, month - 1, prevMonthLastDay - i)\n      });\n    }\n\n    for (let day = 1; day <= daysInMonth; day++) {\n      days.push({\n        day,\n        isCurrentMonth: true,\n        date: new Date(year, month, day)\n      });\n    }\n\n    const remainingDays = 42 - days.length;\n    for (let day = 1; day <= remainingDays; day++) {\n      days.push({\n        day,\n        isCurrentMonth: false,\n        date: new Date(year, month + 1, day)\n      });\n    }\n\n    return { days, year, month };\n  };\n\n  const calendarData = getCalendarDays();\n  const monthNames = ['StyczeÅ„', 'Luty', 'Marzec', 'KwiecieÅ„', 'Maj', 'Czerwiec', 'Lipiec', 'SierpieÅ„', 'WrzesieÅ„', 'PaÅºdziernik', 'Listopad', 'GrudzieÅ„'];\n  const dayNames = ['Pon', 'Wt', 'Åšr', 'Czw', 'Pt', 'Sob', 'Nie'];\n\n  const handleDateSelect = (date: Date) => {\n    const dateStr = formatDateForInput(date);\n    onChange(dateStr);\n    setIsDatePickerOpen(false);\n  };\n\n  const navigateMonth = (direction: number) => {\n    const currentDate = value ? new Date(value + 'T00:00:00') : new Date();\n    const newDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + direction, 1);\n    onChange(formatDateForInput(newDate));\n  };\n\n  const selectToday = () => {\n    handleDateSelect(new Date());\n  };\n\n  const clearDate = () => {\n    onChange('');\n    setIsDatePickerOpen(false);\n  };\n\n  // Pozycjonowanie kalendarza\n  useEffect(() => {\n    if (!isDatePickerOpen) return;\n\n    const updatePosition = () => {\n      const anchor = datePickerRef.current;\n      const popover = calendarRef.current;\n      if (!anchor || !popover) return;\n\n      const anchorRect = anchor.getBoundingClientRect();\n      const popRect = popover.getBoundingClientRect();\n\n      const margin = 8;\n      const padding = 12;\n      const calendarWidth = 280; // StaÅ‚a szerokoÅ›Ä‡ kalendarza\n\n      let top = anchorRect.bottom + margin;\n      if (top + popRect.height > window.innerHeight - padding) {\n        top = anchorRect.top - popRect.height - margin;\n      }\n      top = Math.max(padding, Math.min(top, window.innerHeight - popRect.height - padding));\n\n      // Pozycjonowanie poziome: wyrÃ³wnaj lewÄ… krawÄ™dÅº kalendarza do lewej krawÄ™dzi pola input\n      let left = anchorRect.left;\n      \n      // SprawdÅº czy kalendarz mieÅ›ci siÄ™ w viewport\n      // JeÅ›li nie mieÅ›ci siÄ™ po prawej stronie, przesuÅ„ w lewo\n      if (left + calendarWidth > window.innerWidth - padding) {\n        left = window.innerWidth - calendarWidth - padding;\n      }\n      \n      // JeÅ›li przesuniÄ™ty w lewo, upewnij siÄ™ Å¼e nie wychodzi poza lewÄ… krawÄ™dÅº\n      if (left < padding) {\n        left = padding;\n      }\n\n      setCalendarStyle({\n        position: 'fixed',\n        zIndex: 99999,\n        top: `${top}px`,\n        left: `${left}px`,\n        width: `${calendarWidth}px`,\n      });\n    };\n\n    const raf = requestAnimationFrame(updatePosition);\n    window.addEventListener('scroll', updatePosition, true);\n    window.addEventListener('resize', updatePosition);\n    return () => {\n      cancelAnimationFrame(raf);\n      window.removeEventListener('scroll', updatePosition, true);\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [isDatePickerOpen]);\n\n  // Zamknij po klikniÄ™ciu poza\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      const target = event.target as HTMLElement | null;\n      if (\n        isDatePickerOpen &&\n        target &&\n        datePickerRef.current &&\n        !datePickerRef.current.contains(target) &&\n        calendarRef.current &&\n        !calendarRef.current.contains(target)\n      ) {\n        setIsDatePickerOpen(false);\n      }\n    };\n\n    if (isDatePickerOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n      document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape') {\n          setIsDatePickerOpen(false);\n        }\n      });\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isDatePickerOpen]);\n\n  return (\n    <div className=\"relative\" ref={datePickerRef}>\n      <button\n        type=\"button\"\n        onClick={() => setIsDatePickerOpen(!isDatePickerOpen)}\n        className=\"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 flex items-center justify-between\"\n      >\n        <span className={value ? 'text-white' : 'text-gray-500'}>\n          {formatDateForDisplay(value)}\n        </span>\n        <svg className=\"w-4 h-4 text-white flex-shrink-0 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n        </svg>\n      </button>\n\n      {isDatePickerOpen && createPortal(\n        <div\n          ref={calendarRef}\n          className=\"fixed bg-[#18232F] border border-white/15 rounded-lg shadow-xl p-4\"\n          style={Object.keys(calendarStyle).length ? calendarStyle : { zIndex: 99999 }}\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-3\">\n            <button\n              type=\"button\"\n              onClick={() => navigateMonth(-1)}\n              className=\"p-1 rounded hover:bg-white/10 transition-colors\"\n            >\n              <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n              </svg>\n            </button>\n            <h3 className=\"text-white text-sm font-medium\">\n              {monthNames[calendarData.month]} {calendarData.year}\n            </h3>\n            <button\n              type=\"button\"\n              onClick={() => navigateMonth(1)}\n              className=\"p-1 rounded hover:bg-white/10 transition-colors\"\n            >\n              <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n              </svg>\n            </button>\n          </div>\n\n          {/* Dni tygodnia */}\n          <div className=\"grid grid-cols-7 gap-1 mb-2\">\n            {dayNames.map((day, idx) => (\n              <div key={idx} className=\"text-center text-[10px] text-gray-400 py-1\">\n                {day}\n              </div>\n            ))}\n          </div>\n\n          {/* Kalendarz */}\n          <div className=\"grid grid-cols-7 gap-1\">\n            {calendarData.days.map((dayObj, idx) => {\n              const isSelected = value && formatDateForInput(dayObj.date) === value;\n              const isToday = formatDateForInput(dayObj.date) === formatDateForInput(new Date());\n\n              return (\n                <button\n                  key={idx}\n                  type=\"button\"\n                  onClick={() => dayObj.isCurrentMonth && handleDateSelect(dayObj.date)}\n                  disabled={!dayObj.isCurrentMonth}\n                  className={`aspect-square rounded text-[11px] font-medium transition-all ${\n                    !dayObj.isCurrentMonth\n                      ? 'text-gray-600 cursor-not-allowed'\n                      : isSelected\n                      ? 'bg-[#fee715] text-[#101820] font-bold'\n                      : isToday\n                      ? 'bg-white/10 text-[#fee715] border border-[#fee715]/50'\n                      : 'text-white hover:bg-white/10'\n                  }`}\n                >\n                  {dayObj.day}\n                </button>\n              );\n            })}\n          </div>\n\n          {/* Przyciski */}\n          <div className=\"flex gap-2 mt-3 pt-3 border-t border-white/10\">\n            <button\n              type=\"button\"\n              onClick={clearDate}\n              className=\"flex-1 px-2 py-1.5 bg-white/5 hover:bg-white/10 border border-white/20 rounded text-white text-[10px] transition-colors\"\n            >\n              WyczyÅ›Ä‡\n            </button>\n            <button\n              type=\"button\"\n              onClick={selectToday}\n              className=\"flex-1 px-2 py-1.5 bg-[#fee715] text-[#101820] rounded text-[10px] font-bold transition-colors hover:bg-[#fee715]/90\"\n            >\n              Dzisiaj\n            </button>\n          </div>\n        </div>,\n        document.body\n      )}\n    </div>\n  );\n};\n\nexport default function FunnelBuilderPage({ params }: { params: Promise<{ id: string }> }) {\n  const [resolvedParams, setResolvedParams] = useState<{ id: string } | null>(null);\n  const [id, setId] = useState<string | null>(null);\n  \n  // Resolve params (Next.js 15+)\n  useEffect(() => {\n    params.then((p) => {\n      setResolvedParams(p);\n      setId(p.id);\n    });\n  }, [params]);\n\n  const { user } = useAuth();\n  const router = useRouter();\n  const [funnel, setFunnel] = useState<FunnelDiagram | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [isEditingTitle, setIsEditingTitle] = useState(false);\n  const [isEditingSubtitle, setIsEditingSubtitle] = useState(false);\n  const [editedTitle, setEditedTitle] = useState('');\n  const [editedSubtitle, setEditedSubtitle] = useState('');\n  const [subtitleMode, setSubtitleMode] = useState<'select' | 'custom'>('select');\n  const [selectedNode, setSelectedNode] = useState<Node | null>(null);\n  const [showPropertiesPanel, setShowPropertiesPanel] = useState(false);\n  const [customTemplates, setCustomTemplates] = useState<Array<{ type: string; icon: string; label: string; color: string; category: string; isCustom?: boolean }>>([]);\n  const [nodeProperties, setNodeProperties] = useState<Omit<CustomNodeData, 'color'>>({\n    label: '',\n    icon: 'FileText',\n    notes: '',\n    link: '',\n    isPinned: false,\n  });\n  const [nodeCustomFields, setNodeCustomFields] = useState<NodeCustomField[]>([]);\n  const [textNodeProperties, setTextNodeProperties] = useState<TextNodeData>({\n    text: '',\n    fontSize: 18,\n    fontWeight: 'bold',\n    textAlign: 'left',\n    verticalAlign: 'middle',\n    showHandles: false,\n    isPinned: false,\n  });\n  const [selectedEdge, setSelectedEdge] = useState<Edge | null>(null);\n  const [edgeProperties, setEdgeProperties] = useState({ notes: '', link: '' });\n  const [edgeCustomFields, setEdgeCustomFields] = useState<EdgeCustomField[]>([]);\n  const [showEdgeProperties, setShowEdgeProperties] = useState(false);\n  const [showMinimap, setShowMinimap] = useState(false);\n  const [showAlignToolbar, setShowAlignToolbar] = useState(false);\n  const [showHeader, setShowHeader] = useState(true);\n  const [showSidebar, setShowSidebar] = useState(true);\n  const [showBottomToolbar, setShowBottomToolbar] = useState(true);\n  const [showLegend, setShowLegend] = useState(false);\n  const [interactionMode, setInteractionMode] = useState<'pan' | 'select' | 'comment'>('pan');\n  const [alertModal, setAlertModal] = useState<{ isOpen: boolean; title: string; message: string; type: 'success' | 'error' | 'info' | 'warning' }>({\n    isOpen: false,\n    title: '',\n    message: '',\n    type: 'info',\n  });\n  // System komentarzy\n  const [commentMode, setCommentMode] = useState(false);\n  const [showCommentPanel, setShowCommentPanel] = useState(false);\n  const [selectedThreadId, setSelectedThreadId] = useState<string | null>(null);\n  const [commentFormAnchor, setCommentFormAnchor] = useState<{ type: 'node' | 'edge' | 'region'; id?: string; coords?: { x: number; y: number; width: number; height: number } } | null>(null);\n  const [nodeCommentCounts, setNodeCommentCounts] = useState<Map<string, { count: number; status: 'warning' | 'pending' | 'neutral' | 'closed' }>>(new Map());\n  const [edgeCommentCounts, setEdgeCommentCounts] = useState<Map<string, { count: number; status: 'warning' | 'pending' | 'neutral' | 'closed' }>>(new Map());\n  const [commentPanelRefreshTrigger, setCommentPanelRefreshTrigger] = useState(0);\n\n  // React Flow state\n  const [nodes, setNodes, onNodesChange] = useNodesState([] as Node[]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([] as Edge[]);\n  \n  // Ref do aktualnych nodÃ³w dla wrappedOnNodesChange (aby uniknÄ…Ä‡ stale closure)\n  const nodesRef = useRef<Node[]>([]);\n  \n  // Aktualizuj ref przy kaÅ¼dej zmianie nodÃ³w\n  useEffect(() => {\n    nodesRef.current = nodes;\n  }, [nodes]);\n\n  // Historia do Cofnij (Wstecz) â€” max 50 krokÃ³w\n  const HISTORY_MAX = 50;\n  const [undoHistory, setUndoHistory] = useState<{ nodes: Node[]; edges: Edge[] }[]>([]);\n\n  const reactFlowWrapper = useRef<HTMLDivElement>(null);\n  const hasCenteredOnPinnedRef = useRef(false);\n  const hasSetInitialViewportRef = useRef(false);\n  const lastSavedStateRef = useRef<{ nodes: Node[]; edges: Edge[] } | null>(null);\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const lastSavedNodePropertiesRef = useRef<Omit<CustomNodeData, 'color'> | null>(null);\n  const lastSavedTextNodePropertiesRef = useRef<TextNodeData | null>(null);\n  const lastSavedEdgePropertiesRef = useRef<{ notes: string; link: string } | null>(null);\n  const [hasUnsavedNodeChanges, setHasUnsavedNodeChanges] = useState(false);\n  const [hasUnsavedTextNodeChanges, setHasUnsavedTextNodeChanges] = useState(false);\n  const [hasUnsavedEdgeChanges, setHasUnsavedEdgeChanges] = useState(false);\n  const [reactFlowInstance, setReactFlowInstance] = useState<any>(null);\n  const [copiedNodes, setCopiedNodes] = useState<Node[]>([]);\n  const [copiedEdges, setCopiedEdges] = useState<Edge[]>([]);\n  const [isSpacePressed, setIsSpacePressed] = useState(false);\n  const [currentZoom, setCurrentZoom] = useState(1);\n  const [alignmentGuides, setAlignmentGuides] = useState<{ vertical: number[]; horizontal: number[] }>({ vertical: [], horizontal: [] });\n  const [viewport, setViewport] = useState({ x: 0, y: 0, zoom: 1 });\n  const [flowContainerSize, setFlowContainerSize] = useState({ w: 0, h: 0 });\n  const isManualSelectionRef = useRef(false); // Flaga, Å¼e rÄ™cznie zarzÄ…dzamy selekcjÄ…\n  const pendingSelectionRef = useRef<{ nodeId: string; shouldSelect: boolean } | null>(null); // Intencja selekcji z onNodeClick\n  const previousSelectedNodeIdsRef = useRef<Set<string>>(new Set()); // Poprzednio zaznaczone nody (przed klikniÄ™ciem)\n  const isRestoringSelectionRef = useRef(false); // Flaga, Å¼e przywracamy selekcjÄ™ (aby uniknÄ…Ä‡ pÄ™tli)\n\n  // Zapisz bieÅ¼Ä…cy stan do historii (przed zmianÄ…) â€” do Cofnij\n  const pushUndoHistory = useCallback(() => {\n    const snap = {\n      nodes: JSON.parse(JSON.stringify(nodes)) as Node[],\n      edges: JSON.parse(JSON.stringify(edges)) as Edge[],\n    };\n    setUndoHistory((h) => {\n      const next = [...h, snap];\n      return next.length > HISTORY_MAX ? next.slice(1) : next;\n    });\n  }, [nodes, edges]);\n\n  const handleUndo = useCallback(() => {\n    if (undoHistory.length === 0) return;\n    const prev = undoHistory[undoHistory.length - 1];\n    setNodes(prev.nodes);\n    setEdges(prev.edges);\n    setUndoHistory((h) => h.slice(0, -1));\n    setSelectedNode(null);\n    setSelectedEdge(null);\n    setShowPropertiesPanel(false);\n    setShowEdgeProperties(false);\n  }, [undoHistory, setNodes, setEdges]);\n\n  // Rozmiar kontenera flow (do linii pomocniczych)\n  useEffect(() => {\n    const el = reactFlowWrapper.current;\n    if (!el) return;\n    const update = () => {\n      if (el) setFlowContainerSize({ w: el.offsetWidth, h: el.offsetHeight });\n    };\n    update();\n    const ro = new ResizeObserver(update);\n    ro.observe(el);\n    return () => ro.disconnect();\n  }, []);\n\n  // Åadowanie wÅ‚asnych szablonÃ³w z bazy\n  const loadCustomTemplates = useCallback(async () => {\n    if (!user) return;\n    try {\n      const { data, error } = await supabase\n        .from('custom_node_templates')\n        .select('*')\n        .eq('created_by', user.id)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      const templates = (data || []).map(template => ({\n        type: 'custom' as const,\n        icon: template.icon,\n        label: template.label,\n        color: template.color,\n        category: template.category,\n        isCustom: true,\n      }));\n\n      setCustomTemplates(templates);\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d Å‚adowania wÅ‚asnych szablonÃ³w:', error);\n    }\n  }, [user]);\n\n  // Åadowanie liczby wÄ…tkÃ³w dla nodÃ³w/edges\n  const loadCommentCounts = useCallback(async () => {\n    if (!id) return;\n    try {\n      const { data, error } = await supabase\n        .from('comment_threads')\n        .select(`\n          id,\n          status,\n          comment_anchors (\n            anchor_type,\n            anchor_id,\n            region_x,\n            region_y,\n            region_width,\n            region_height\n          )\n        `)\n        .eq('funnel_id', id);\n\n      if (error) {\n        console.error('BÅ‚Ä…d pobierania wÄ…tkÃ³w:', error);\n        throw error;\n      }\n\n      // Debug: sprawdÅº co faktycznie wraca z bazy\n      console.log('=== RAW DATA FROM DB ===');\n      console.log('Threads count:', data?.length || 0);\n      if (data && data.length > 0) {\n        console.log('First thread raw data:', JSON.stringify(data[0], null, 2));\n        console.log('All threads anchors:', data.map((t: any) => {\n          const anchors = t.comment_anchors;\n          const anchor = Array.isArray(anchors) ? anchors[0] : anchors;\n          return {\n            threadId: t.id,\n            anchors: anchors,\n            isArray: Array.isArray(anchors),\n            anchorsLength: Array.isArray(anchors) ? anchors.length : (anchors ? 1 : 0),\n            firstAnchor: anchor\n          };\n        }));\n      }\n\n      const nodeCounts = new Map<string, { count: number; status: 'warning' | 'pending' | 'neutral' | 'closed' }>();\n      const edgeCounts = new Map<string, { count: number; status: 'warning' | 'pending' | 'neutral' | 'closed' }>();\n\n      (data || []).forEach((thread: any) => {\n        // Supabase moÅ¼e zwrÃ³ciÄ‡ comment_anchors jako obiekt (gdy jest jeden) lub tablicÄ™ (gdy jest wiele)\n        const anchors = thread.comment_anchors;\n        const anchor = Array.isArray(anchors) ? anchors[0] : anchors;\n        if (!anchor || !anchor.anchor_type) return;\n\n        const isOpen = thread.status !== 'Zatwierdzone' && thread.status !== 'Odrzucone';\n        if (!isOpen) return; // Tylko otwarte wÄ…tki\n\n        let status: 'warning' | 'pending' | 'neutral' | 'closed' = 'neutral';\n        if (thread.status === 'Otwarte') status = 'warning';\n        else if (thread.status === 'Do akceptacji') status = 'pending';\n        else if (thread.status === 'W toku') status = 'neutral';\n\n        if (anchor.anchor_type === 'node' && anchor.anchor_id) {\n          const existing = nodeCounts.get(anchor.anchor_id) || { count: 0, status: 'neutral' };\n          nodeCounts.set(anchor.anchor_id, {\n            count: existing.count + 1,\n            status: status === 'warning' || existing.status === 'warning' ? 'warning' : status === 'pending' || existing.status === 'pending' ? 'pending' : 'neutral',\n          });\n        } else if (anchor.anchor_type === 'edge' && anchor.anchor_id) {\n          const existing = edgeCounts.get(anchor.anchor_id) || { count: 0, status: 'neutral' };\n          edgeCounts.set(anchor.anchor_id, {\n            count: existing.count + 1,\n            status: status === 'warning' || existing.status === 'warning' ? 'warning' : status === 'pending' || existing.status === 'pending' ? 'pending' : 'neutral',\n          });\n        }\n      });\n\n      setNodeCommentCounts(nodeCounts);\n      setEdgeCommentCounts(edgeCounts);\n      \n      // Debug: sprawdÅº czy dane sÄ… poprawnie zaÅ‚adowane\n      const allAnchorsInfo = (data || []).map((t: any) => {\n        const anchors = t.comment_anchors;\n        const anchor = Array.isArray(anchors) ? anchors[0] : anchors;\n        return {\n          threadId: t.id,\n          anchorType: anchor?.anchor_type,\n          anchorId: anchor?.anchor_id,\n          anchorIdType: typeof anchor?.anchor_id,\n          anchorIdValue: anchor?.anchor_id,\n          status: t.status,\n          isOpen: t.status !== 'Zatwierdzone' && t.status !== 'Odrzucone',\n          fullAnchor: anchor\n        };\n      });\n      \n      console.log('=== DEBUG: ZaÅ‚adowane liczniki komentarzy ===');\n      console.log('Total threads:', data?.length || 0);\n      console.log('Node counts:', Array.from(nodeCounts.entries()));\n      console.log('Edge counts:', Array.from(edgeCounts.entries()));\n      console.log('All anchors info (szczegÃ³Å‚y):', JSON.stringify(allAnchorsInfo, null, 2));\n      console.log('Nodes with comments:', Array.from(nodeCounts.keys()));\n      console.log('Edges with comments:', Array.from(edgeCounts.keys()));\n      \n      // SprawdÅº, ktÃ³re wÄ…tki sÄ… pomijane i dlaczego\n      (data || []).forEach((thread: any) => {\n        const anchors = thread.comment_anchors;\n        const anchor = Array.isArray(anchors) ? anchors[0] : anchors;\n        if (!anchor || !anchor.anchor_type) {\n          console.warn('âš ï¸ Thread bez anchor:', thread.id);\n        } else if (anchor.anchor_type === 'region') {\n          console.log('â„¹ï¸ Thread dla regionu (pomijany):', thread.id);\n        } else if (anchor.anchor_type === 'node' && !anchor.anchor_id) {\n          console.warn('âš ï¸ Thread dla node bez anchor_id:', thread.id, anchor);\n        } else if (anchor.anchor_type === 'edge' && !anchor.anchor_id) {\n          console.warn('âš ï¸ Thread dla edge bez anchor_id:', thread.id, anchor);\n        } else if (thread.status === 'Zatwierdzone' || thread.status === 'Odrzucone') {\n          console.log('â„¹ï¸ Thread zamkniÄ™ty (pomijany):', thread.id, thread.status);\n        }\n      });\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d Å‚adowania liczby wÄ…tkÃ³w:', error);\n    }\n  }, [id]);\n\n  // Load funnel data and custom templates\n  useEffect(() => {\n    if (id && user) {\n      loadFunnel();\n      loadCustomTemplates();\n      loadCommentCounts();\n    }\n  }, [id, user, loadCustomTemplates, loadCommentCounts]);\n\n  // Ustawienie viewportu po zaÅ‚adowaniu danych (tylko raz)\n  useEffect(() => {\n    if (!reactFlowInstance || !funnel || nodes.length === 0 || hasSetInitialViewportRef.current) return;\n    \n    // SprawdÅº, czy jest przypiÄ™ty node\n    const pinnedNode = nodes.find((n) => {\n      if (n.type === 'text') {\n        return ((n.data as unknown) as TextNodeData).isPinned === true;\n      } else {\n        return ((n.data as unknown) as CustomNodeData).isPinned === true;\n      }\n    });\n    \n    hasSetInitialViewportRef.current = true;\n    \n    if (pinnedNode) {\n      // WyÅ›rodkuj przypiÄ™ty node\n      hasCenteredOnPinnedRef.current = true;\n      \n      // UÅ¼yj requestAnimationFrame dla szybszego renderowania (zamiast setTimeout)\n      const setViewport = () => {\n        if (!reactFlowInstance || !reactFlowWrapper.current) {\n          requestAnimationFrame(setViewport);\n          return;\n        }\n        \n        // SprawdÅº, czy node rzeczywiÅ›cie istnieje w aktualnych nodes\n        const currentPinnedNode = nodes.find((n) => n.id === pinnedNode.id);\n        if (!currentPinnedNode) {\n          console.warn('PrzypiÄ™ty node nie zostaÅ‚ znaleziony:', pinnedNode.id);\n          // Fallback: ustaw domyÅ›lny viewport\n          reactFlowInstance.setViewport({ x: 0, y: 0, zoom: 0.48 }, { duration: 0 });\n          return;\n        }\n        \n        // Oblicz wymiary noda\n        const width = currentPinnedNode.width || currentPinnedNode.measured?.width || (currentPinnedNode.type === 'text' ? 250 : 150);\n        const height = currentPinnedNode.height || currentPinnedNode.measured?.height || (currentPinnedNode.type === 'text' ? 100 : 80);\n        \n        // Oblicz Å›rodek noda w przestrzeni flow\n        const cx = currentPinnedNode.position.x + width / 2;\n        const cy = currentPinnedNode.position.y + height / 2;\n        \n        // Oblicz wymiary kontenera\n        const containerWidth = reactFlowWrapper.current.offsetWidth;\n        const containerHeight = reactFlowWrapper.current.offsetHeight;\n        const zoom = 0.48;\n        \n        // Oblicz pozycjÄ™ viewport tak, aby Å›rodek noda byÅ‚ na Å›rodku ekranu\n        const x = containerWidth / 2 - cx * zoom;\n        const y = containerHeight / 2 - cy * zoom;\n        \n        // Ustaw viewport z wyÅ›rodkowanym nodem i zoomem 0.48\n        reactFlowInstance.setViewport({ x, y, zoom }, { duration: 200 });\n      };\n      \n      // UÅ¼yj requestAnimationFrame dla natychmiastowego renderowania\n      requestAnimationFrame(() => {\n        requestAnimationFrame(setViewport);\n      });\n    } else {\n      // Nie ma przypiÄ™tego noda - uÅ¼yj fitView jako domyÅ›lny widok\n      const setViewport = () => {\n        if (!reactFlowInstance) {\n          requestAnimationFrame(setViewport);\n          return;\n        }\n        \n        // UÅ¼yj fitView jako domyÅ›lny widok\n        reactFlowInstance.fitView({ padding: 0.2, duration: 200 });\n      };\n      \n      // UÅ¼yj requestAnimationFrame dla natychmiastowego renderowania\n      requestAnimationFrame(() => {\n        requestAnimationFrame(setViewport);\n      });\n    }\n  }, [reactFlowInstance, funnel, nodes, viewport]);\n\n  // Reset flagi przy zaÅ‚adowaniu nowego lejka\n  useEffect(() => {\n    if (id) {\n      hasCenteredOnPinnedRef.current = false;\n      hasSetInitialViewportRef.current = false;\n    }\n  }, [id]);\n\n  // SprawdÅº, czy sÄ… niezapisane zmiany (dirty state)\n  useEffect(() => {\n    if (!lastSavedStateRef.current) {\n      // Pierwsze zaÅ‚adowanie - zapisz stan jako \"zapisany\"\n      lastSavedStateRef.current = {\n        nodes: JSON.parse(JSON.stringify(nodes)),\n        edges: JSON.parse(JSON.stringify(edges)),\n      };\n      setHasUnsavedChanges(false);\n      return;\n    }\n\n    // PorÃ³wnaj aktualny stan z ostatnio zapisanym\n    const currentState = JSON.stringify({ nodes, edges });\n    const savedState = JSON.stringify(lastSavedStateRef.current);\n    \n    setHasUnsavedChanges(currentState !== savedState);\n  }, [nodes, edges]);\n\n  // Auto-save on changes - ale NIE podczas edycji w modalu (properties panel)\n  useEffect(() => {\n    if (funnel && nodes.length >= 0 && !showPropertiesPanel && !showEdgeProperties) {\n      const timeoutId = setTimeout(() => {\n        saveFunnel();\n      }, 2000); // Debounce 2 seconds\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [nodes, edges, funnel, showPropertiesPanel, showEdgeProperties]);\n\n  // Funkcja kopiowania zaznaczonych nodÃ³w i edges\n  const handleCopy = useCallback(() => {\n    const selectedNodes = nodes.filter((n) => n.selected);\n    if (selectedNodes.length === 0) return;\n\n    // ZnajdÅº edges miÄ™dzy zaznaczonymi nodami\n    const selectedNodeIds = new Set(selectedNodes.map((n) => n.id));\n    const selectedEdges = edges.filter(\n      (e) => selectedNodeIds.has(e.source) && selectedNodeIds.has(e.target)\n    );\n\n    setCopiedNodes(JSON.parse(JSON.stringify(selectedNodes)));\n    setCopiedEdges(JSON.parse(JSON.stringify(selectedEdges)));\n  }, [nodes, edges]);\n\n  // Funkcja wklejania skopiowanych nodÃ³w i edges\n  const handlePaste = useCallback(() => {\n    if (copiedNodes.length === 0 || !reactFlowInstance) return;\n\n    pushUndoHistory();\n\n    // Oblicz offset dla nowych nodÃ³w (przesuÅ„ o 50px w prawo i w dÃ³Å‚)\n    const offset = { x: 50, y: 50 };\n    const newNodes: Node[] = copiedNodes.map((node) => {\n      const newId = `${node.type === 'text' ? 'text-node' : 'node'}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n      return {\n        ...node,\n        id: newId,\n        selected: false,\n        position: {\n          x: node.position.x + offset.x,\n          y: node.position.y + offset.y,\n        },\n      };\n    });\n\n    // UtwÃ³rz mapÄ™ starych ID -> nowych ID\n    const idMap = new Map<string, string>();\n    copiedNodes.forEach((oldNode, index) => {\n      idMap.set(oldNode.id, newNodes[index].id);\n    });\n\n    // UtwÃ³rz nowe edges z nowymi ID\n    const newEdges: Edge[] = copiedEdges.map((edge) => {\n      const newId = `edge-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n      return {\n        ...edge,\n        id: newId,\n        source: idMap.get(edge.source) || edge.source,\n        target: idMap.get(edge.target) || edge.target,\n        selected: false,\n      };\n    });\n\n    // Dodaj nowe nody i edges\n    setNodes((nds) => [...nds, ...newNodes]);\n    setEdges((eds) => [...eds, ...newEdges]);\n  }, [copiedNodes, copiedEdges, reactFlowInstance, setNodes, setEdges, pushUndoHistory]);\n\n  // ObsÅ‚uga Space (pan), Ctrl/Cmd+Z (cofnij), Ctrl/Cmd+C (kopiuj), Ctrl/Cmd+V (wklej) â€” pomijamy w polach formularza\n  useEffect(() => {\n    const isFormElement = (el: EventTarget | null): boolean => {\n      if (!el || !(el instanceof HTMLElement)) return false;\n      return el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' || el.tagName === 'SELECT' || el.isContentEditable === true;\n    };\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (isFormElement(e.target) || isFormElement(document.activeElement)) return;\n      if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {\n        e.preventDefault();\n        handleUndo();\n        return;\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key === 'c') {\n        e.preventDefault();\n        handleCopy();\n        return;\n      }\n      if ((e.metaKey || e.ctrlKey) && e.key === 'v') {\n        e.preventDefault();\n        handlePaste();\n        return;\n      }\n      if (e.code === 'Space' && !e.repeat) {\n        e.preventDefault();\n        setIsSpacePressed(true);\n      }\n    };\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (isFormElement(e.target) || isFormElement(document.activeElement)) return;\n      if (e.code === 'Space') {\n        e.preventDefault();\n        setIsSpacePressed(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [handleUndo, handleCopy, handlePaste]);\n\n  // Zapisywanie wÅ‚asnego szablonu\n  const saveCustomTemplate = useCallback(async (label: string, icon: string, color: string, category: string) => {\n    if (!user) return;\n    try {\n      const { error } = await supabase\n        .from('custom_node_templates')\n        .insert({\n          created_by: user.id,\n          label,\n          icon,\n          color,\n          category,\n        });\n\n      if (error) throw error;\n\n      // PrzeÅ‚aduj szablony\n      await loadCustomTemplates();\n\n      setAlertModal({\n        isOpen: true,\n        title: 'Sukces',\n        message: 'Szablon zostaÅ‚ zapisany i dodany do sidebaru!',\n        type: 'success',\n      });\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d zapisywania szablonu:', error);\n      setAlertModal({\n        isOpen: true,\n        title: 'BÅ‚Ä…d',\n        message: 'Nie udaÅ‚o siÄ™ zapisaÄ‡ szablonu: ' + (error.message || 'Nieznany bÅ‚Ä…d'),\n        type: 'error',\n      });\n    }\n  }, [user, loadCustomTemplates]);\n\n  // Åadowanie customowych pÃ³l dla wybranego noda\n  const loadNodeCustomFields = useCallback(async (nodeId: string, funnelId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('node_custom_fields')\n        .select('*')\n        .eq('funnel_id', funnelId)\n        .eq('node_id', nodeId)\n        .order('display_order', { ascending: true });\n\n      if (error) throw error;\n\n      const fields: NodeCustomField[] = (data || []).map(f => ({\n        id: f.id,\n        field_name: f.field_name,\n        field_type: f.field_type as 'text' | 'date' | 'number' | 'link',\n        field_value: f.field_value || '',\n        display_order: f.display_order || 0,\n      }));\n\n      setNodeCustomFields(fields);\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d Å‚adowania customowych pÃ³l:', error);\n    }\n  }, []);\n\n  // Zapisywanie customowych pÃ³l dla wybranego noda\n  const saveNodeCustomFields = useCallback(async (nodeId: string, funnelId: string, fields: NodeCustomField[]) => {\n    try {\n      // Najpierw usuÅ„ wszystkie istniejÄ…ce pola dla tego noda\n      const { error: deleteError } = await supabase\n        .from('node_custom_fields')\n        .delete()\n        .eq('funnel_id', funnelId)\n        .eq('node_id', nodeId);\n\n      if (deleteError) throw deleteError;\n\n      // NastÄ™pnie dodaj nowe pola\n      if (fields.length > 0) {\n        const fieldsToInsert = fields.map((f, index) => ({\n          funnel_id: funnelId,\n          node_id: nodeId,\n          field_name: f.field_name,\n          field_type: f.field_type,\n          field_value: f.field_value || '',\n          display_order: index,\n        }));\n\n        const { error: insertError } = await supabase\n          .from('node_custom_fields')\n          .insert(fieldsToInsert);\n\n        if (insertError) throw insertError;\n      }\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d zapisywania customowych pÃ³l:', error);\n      throw error;\n    }\n  }, []);\n\n  // Åadowanie customowych pÃ³l dla wybranego edge'a\n  const loadEdgeCustomFields = useCallback(async (edgeId: string, funnelId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('edge_custom_fields')\n        .select('*')\n        .eq('funnel_id', funnelId)\n        .eq('edge_id', edgeId)\n        .order('display_order', { ascending: true });\n\n      if (error) throw error;\n\n      const fields: EdgeCustomField[] = (data || []).map(f => ({\n        id: f.id,\n        field_name: f.field_name,\n        field_type: f.field_type as 'text' | 'date' | 'number' | 'link',\n        field_value: f.field_value || '',\n        display_order: f.display_order || 0,\n      }));\n\n      setEdgeCustomFields(fields);\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d Å‚adowania customowych pÃ³l dla edge:', error);\n    }\n  }, []);\n\n  // Zapisywanie customowych pÃ³l dla wybranego edge'a\n  const saveEdgeCustomFields = useCallback(async (edgeId: string, funnelId: string, fields: EdgeCustomField[]) => {\n    try {\n      // Najpierw usuÅ„ wszystkie istniejÄ…ce pola dla tego edge'a\n      const { error: deleteError } = await supabase\n        .from('edge_custom_fields')\n        .delete()\n        .eq('funnel_id', funnelId)\n        .eq('edge_id', edgeId);\n\n      if (deleteError) throw deleteError;\n\n      // NastÄ™pnie dodaj nowe pola\n      if (fields.length > 0) {\n        const fieldsToInsert = fields.map((f, index) => ({\n          funnel_id: funnelId,\n          edge_id: edgeId,\n          field_name: f.field_name,\n          field_type: f.field_type,\n          field_value: f.field_value || '',\n          display_order: index,\n        }));\n\n        const { error: insertError } = await supabase\n          .from('edge_custom_fields')\n          .insert(fieldsToInsert);\n\n        if (insertError) throw insertError;\n      }\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d zapisywania customowych pÃ³l dla edge:', error);\n      throw error;\n    }\n  }, []);\n\n  const loadFunnel = async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('funnel_diagrams')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n\n      setFunnel(data);\n      // Inicjalizuj editedTitle i editedSubtitle po zaÅ‚adowaniu lejka\n      setEditedTitle(data.project_name || '');\n      setEditedSubtitle(data.subtitle || '');\n      // JeÅ›li subtitle nie jest jednÄ… z standardowych opcji, ustaw tryb na 'custom'\n      const standardSubtitles = ['stan obecny', 'docelowy', 'Plan 90 dni'];\n      if (data.subtitle && !standardSubtitles.includes(data.subtitle)) {\n        setSubtitleMode('custom');\n      } else {\n        setSubtitleMode('select');\n      }\n\n      // Load diagram data\n      if (data.diagram_data) {\n        const diagramData = data.diagram_data;\n        \n        // ZaÅ‚aduj customowe pola dla wszystkich nodÃ³w\n        let loadedNodes = diagramData.nodes || [];\n        if (loadedNodes.length > 0 && id) {\n          try {\n            const { data: customFieldsData, error: customFieldsError } = await supabase\n              .from('node_custom_fields')\n              .select('*')\n              .eq('funnel_id', id)\n              .order('display_order', { ascending: true });\n\n            if (!customFieldsError && customFieldsData) {\n              // Grupuj customowe pola wedÅ‚ug node_id\n              const customFieldsByNodeId: Record<string, NodeCustomField[]> = {};\n              customFieldsData.forEach((field) => {\n                if (!customFieldsByNodeId[field.node_id]) {\n                  customFieldsByNodeId[field.node_id] = [];\n                }\n                customFieldsByNodeId[field.node_id].push({\n                  id: field.id,\n                  field_name: field.field_name,\n                  field_type: field.field_type as 'text' | 'date' | 'number' | 'link',\n                  field_value: field.field_value || '',\n                  display_order: field.display_order || 0,\n                });\n              });\n\n              // Dodaj customowe pola do danych kaÅ¼dego noda\n              loadedNodes = loadedNodes.map((node: Node) => {\n                if (node.type === 'custom' && customFieldsByNodeId[node.id]) {\n                  return {\n                    ...node,\n                    data: {\n                      ...((node.data as unknown) as CustomNodeData),\n                      customFields: customFieldsByNodeId[node.id],\n                    },\n                  };\n                }\n                return node;\n              });\n            }\n          } catch (error: any) {\n            console.error('BÅ‚Ä…d Å‚adowania customowych pÃ³l:', error);\n          }\n        }\n\n        if (loadedNodes && Array.isArray(loadedNodes)) {\n          setNodes(loadedNodes);\n        }\n        if (diagramData.edges && Array.isArray(diagramData.edges)) {\n          setEdges(diagramData.edges);\n        }\n        // Zapisz viewport z bazy do stanu, Å¼eby uÅ¼yÄ‡ go pÃ³Åºniej w useEffect\n        if (diagramData.viewport) {\n          setViewport(diagramData.viewport);\n        }\n        setUndoHistory([]);\n        hasSetInitialViewportRef.current = false; // Reset flag przy zaÅ‚adowaniu nowego lejka\n        \n        // Zapisz poczÄ…tkowy stan jako \"zapisany\"\n        lastSavedStateRef.current = {\n          nodes: JSON.parse(JSON.stringify(loadedNodes || [])),\n          edges: JSON.parse(JSON.stringify(diagramData.edges || [])),\n        };\n        setHasUnsavedChanges(false);\n      }\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d Å‚adowania lejka:', error);\n      setAlertModal({\n        isOpen: true,\n        title: 'BÅ‚Ä…d',\n        message: 'Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ lejka: ' + (error.message || 'Nieznany bÅ‚Ä…d'),\n        type: 'error',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const saveFunnel = async () => {\n    if (!funnel || !reactFlowInstance) return;\n\n    try {\n      setSaving(true);\n      const viewport = reactFlowInstance.getViewport();\n\n      const diagramData = {\n        nodes,\n        edges,\n        viewport,\n      };\n\n      const { error } = await supabase\n        .from('funnel_diagrams')\n        .update({\n          diagram_data: diagramData,\n          project_name: editedTitle,\n          subtitle: editedSubtitle,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', funnel.id);\n\n      if (error) throw error;\n      \n      // Po udanym zapisie, zaktualizuj ostatnio zapisany stan\n      lastSavedStateRef.current = {\n        nodes: JSON.parse(JSON.stringify(nodes)),\n        edges: JSON.parse(JSON.stringify(edges)),\n      };\n      setHasUnsavedChanges(false);\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d zapisywania lejka:', error);\n      // Don't show error modal for auto-save failures\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const onConnect = useCallback(\n    (params: Connection) => {\n      pushUndoHistory();\n      const newEdge: Edge = {\n        ...params,\n        id: `edge-${params.source}-${params.target}-${Date.now()}`,\n        type: 'custom' as const,\n        animated: false,\n        style: { stroke: '#fee715', strokeWidth: 2 },\n        markerStart: undefined,\n        markerEnd: {\n          type: MarkerType.ArrowClosed,\n          color: '#fee715',\n          orient: 'auto',\n        },\n        data: {\n          notes: '',\n          link: '',\n        },\n      };\n      setEdges((eds) => addEdge(newEdge, eds));\n    },\n    [setEdges, pushUndoHistory]\n  );\n\n  const onDragOver = useCallback((event: React.DragEvent) => {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'move';\n  }, []);\n\n  const onDrop = useCallback(\n    (event: React.DragEvent) => {\n      event.preventDefault();\n\n      if (!reactFlowInstance || !reactFlowWrapper.current) return;\n\n      const reactFlowBounds = reactFlowWrapper.current.getBoundingClientRect();\n      const templateData = event.dataTransfer.getData('application/reactflow');\n\n      if (!templateData) return;\n\n      const template = JSON.parse(templateData);\n      const position = reactFlowInstance.screenToFlowPosition({\n        x: event.clientX - reactFlowBounds.left,\n        y: event.clientY - reactFlowBounds.top,\n      });\n\n      let newNode: Node;\n      \n      if (template.type === 'text') {\n        // Text node\n        newNode = {\n          id: `text-node-${Date.now()}`,\n          type: 'text',\n          position,\n          data: {\n            text: 'Kliknij, aby edytowaÄ‡',\n            fontSize: 18,\n            fontWeight: 'bold' as const,\n            textAlign: 'left' as const,\n            verticalAlign: 'middle' as const,\n            showHandles: false,\n            width: 250,\n            height: 100,\n          },\n          style: {\n            width: 250,\n            height: 100,\n          },\n        };\n      } else {\n        // Custom node\n        newNode = {\n          id: `node-${Date.now()}`,\n          type: template.type || 'custom',\n          position,\n          data: {\n            label: template.isCustom ? 'WÅ‚asny element' : template.label,\n            icon: template.icon,\n            color: template.color || '#fee71520',\n            notes: '',\n            category: template.category, // Zapisz kategoriÄ™ dla wizualnych wskaÅºnikÃ³w\n          },\n        };\n      }\n\n      pushUndoHistory();\n      setNodes((nds) => nds.concat(newNode));\n    },\n    [reactFlowInstance, setNodes, pushUndoHistory]\n  );\n\n  // Ref do Å›ledzenia czy to jest przeciÄ…ganie (drag noda) - box selection dziaÅ‚a tylko na pustym tle\n  const isDraggingNodeRef = useRef(false);\n\n  const onNodeClick = useCallback((event: React.MouseEvent, node: Node) => {\n    // W trybie komentarzy: otwÃ³rz formularz dodawania komentarza\n    if (commentMode) {\n      event.preventDefault();\n      event.stopPropagation();\n      setCommentFormAnchor({ type: 'node', id: node.id });\n      return;\n    }\n    \n    // W trybie zaznaczania: obsÅ‚uguj tylko pojedyncze klikniÄ™cia (nie przeciÄ…ganie noda)\n    // Box selection jest obsÅ‚ugiwane przez React Flow automatycznie poprzez selectionOnDrag\n    // Box selection dziaÅ‚a TYLKO gdy klikasz na pustym tle (pane), wiÄ™c onNodeClick nie jest wywoÅ‚ywane podczas box selection\n    if (interactionMode === 'select') {\n      // JeÅ›li to byÅ‚o przeciÄ…ganie noda (nie box selection), pozwÃ³l React Flow obsÅ‚uÅ¼yÄ‡ to\n      if (isDraggingNodeRef.current) {\n        isDraggingNodeRef.current = false;\n        return;\n      }\n      \n      // Dla pojedynczych klikniÄ™Ä‡: rÄ™cznie zarzÄ…dzaj selekcjÄ… (zachowaj poprzednie selekcje)\n      event.preventDefault();\n      event.stopPropagation();\n      \n      // ZapamiÄ™taj poprzednio zaznaczone nody (przed klikniÄ™ciem)\n      const currentSelectedNodeIds = new Set(\n        nodes.filter(n => n.selected).map(n => n.id)\n      );\n      previousSelectedNodeIdsRef.current = currentSelectedNodeIds;\n      \n      // Ustaw flagÄ™ i intencjÄ™ selekcji\n      isManualSelectionRef.current = true;\n      const wasSelected = node.selected;\n      pendingSelectionRef.current = { nodeId: node.id, shouldSelect: !wasSelected };\n      \n      // Zastosuj selekcjÄ™ natychmiast, zachowujÄ…c inne selekcje\n      setNodes((nds) => {\n        return nds.map((n) => {\n          if (n.id === node.id) {\n            return { ...n, selected: !wasSelected };\n          }\n          // Zachowaj selekcjÄ™ innych nodÃ³w\n          return n;\n        });\n      });\n      \n      // Reset flagi po krÃ³tkim czasie\n      setTimeout(() => {\n        isManualSelectionRef.current = false;\n        pendingSelectionRef.current = null;\n        previousSelectedNodeIdsRef.current = new Set();\n      }, 150);\n      \n      // JeÅ›li odznaczamy node, zamknij panel wÅ‚aÅ›ciwoÅ›ci jeÅ›li byÅ‚ otwarty\n      if (wasSelected && selectedNode?.id === node.id) {\n        setSelectedNode(null);\n        setShowPropertiesPanel(false);\n      }\n      \n      return;\n    }\n    \n    setSelectedNode(node);\n    setSelectedEdge(null);\n    setShowPropertiesPanel(true);\n    \n    if (node.type === 'text') {\n      const props = {\n        text: ((node.data as unknown) as TextNodeData).text || '',\n        fontSize: ((node.data as unknown) as TextNodeData).fontSize || 18,\n        fontWeight: ((node.data as unknown) as TextNodeData).fontWeight || 'bold',\n        textAlign: ((node.data as unknown) as TextNodeData).textAlign || 'left',\n        verticalAlign: ((node.data as unknown) as TextNodeData).verticalAlign || 'middle',\n        showHandles: ((node.data as unknown) as TextNodeData).showHandles ?? false,\n        isPinned: ((node.data as unknown) as TextNodeData).isPinned ?? false,\n      };\n      setTextNodeProperties(props);\n      lastSavedTextNodePropertiesRef.current = JSON.parse(JSON.stringify(props));\n      setHasUnsavedTextNodeChanges(false);\n    } else {\n      const props = {\n        label: ((node.data as unknown) as CustomNodeData).label || '',\n        icon: ((node.data as unknown) as CustomNodeData).icon || 'FileText',\n        notes: ((node.data as unknown) as CustomNodeData).notes || '',\n        link: ((node.data as unknown) as CustomNodeData).link || '',\n        isPinned: ((node.data as unknown) as CustomNodeData).isPinned ?? false,\n        category: ((node.data as unknown) as CustomNodeData).category, // Zachowaj kategoriÄ™\n      };\n      setNodeProperties(props);\n      lastSavedNodePropertiesRef.current = JSON.parse(JSON.stringify(props));\n      setHasUnsavedNodeChanges(false);\n      \n      // ZaÅ‚aduj customowe pola dla tego noda (z danych noda lub z bazy)\n      const customFieldsFromNode = ((node.data as unknown) as CustomNodeData).customFields;\n      if (customFieldsFromNode && customFieldsFromNode.length > 0) {\n        setNodeCustomFields(customFieldsFromNode);\n      } else if (id) {\n        loadNodeCustomFields(node.id, id);\n      } else {\n        setNodeCustomFields([]);\n      }\n    }\n    setShowEdgeProperties(false);\n  }, [interactionMode, selectedNode, setNodes, id, loadNodeCustomFields]);\n\n  const onEdgeClick = useCallback((event: React.MouseEvent, edge: Edge) => {\n    event.stopPropagation();\n    \n    // W trybie komentarzy: otwÃ³rz formularz dodawania komentarza\n    if (commentMode) {\n      setCommentFormAnchor({ type: 'edge', id: edge.id });\n      return;\n    }\n    \n    setSelectedEdge(edge);\n    setSelectedNode(null);\n    const props: { notes: string; link: string } = {\n      notes: (edge.data?.notes as string) || '',\n      link: (edge.data?.link as string) || '',\n    };\n    setEdgeProperties(props);\n    lastSavedEdgePropertiesRef.current = JSON.parse(JSON.stringify(props));\n    setHasUnsavedEdgeChanges(false);\n    setShowEdgeProperties(true);\n    setShowPropertiesPanel(false);\n    // ZaÅ‚aduj customowe pola dla edge'a\n    if (id) {\n      loadEdgeCustomFields(edge.id, id);\n    }\n  }, [commentMode, id, loadEdgeCustomFields]);\n\n  // ObsÅ‚uga klikniÄ™cia w pustÄ… przestrzeÅ„ (pane) - dla komentarzy i deselekcji\n  const onPaneClick = useCallback((event: React.MouseEvent) => {\n    // W trybie komentarzy: otwÃ³rz formularz dodawania komentarza w regionie\n    if (commentMode && reactFlowInstance) {\n      const point = reactFlowInstance.screenToFlowPosition({\n        x: event.clientX,\n        y: event.clientY,\n      });\n      // UtwÃ³rz maÅ‚y region (50x50px) wokÃ³Å‚ klikniÄ™tego punktu\n      setCommentFormAnchor({\n        type: 'region',\n        coords: {\n          x: point.x,\n          y: point.y,\n          width: 50,\n          height: 50,\n        },\n      });\n      return;\n    }\n    \n    // W trybie select: deselekcja wszystkich elementÃ³w przy klikniÄ™ciu w pustÄ… przestrzeÅ„\n    if (interactionMode === 'select') {\n      setNodes((nds) => nds.map((n) => ({ ...n, selected: false })));\n      setEdges((eds) => eds.map((e) => ({ ...e, selected: false })));\n      setSelectedNode(null);\n      setSelectedEdge(null);\n      setShowPropertiesPanel(false);\n      setShowEdgeProperties(false);\n    }\n  }, [commentMode, interactionMode, reactFlowInstance, setNodes, setEdges]);\n\n  const onLongPressDeselect = useCallback((nodeId: string) => {\n    // Nie uÅ¼ywamy juÅ¼ long press - funkcja pozostaje dla kompatybilnoÅ›ci, ale nie jest uÅ¼ywana\n    // Toggle odbywa siÄ™ przez onNodeClick\n  }, []);\n\n  const wrappedOnNodesChange = useCallback(\n    (changes: NodeChange[]) => {\n      if (changes.some((c) => c.type === 'remove')) pushUndoHistory();\n      \n      // W trybie select: obsÅ‚uÅ¼ selekcjÄ™ specjalnie\n      if (interactionMode === 'select') {\n        const selectChanges = changes.filter((c) => c.type === 'select');\n        \n        // JeÅ›li rÄ™cznie zarzÄ…dzamy selekcjÄ… (pojedyncze klikniÄ™cie w onNodeClick), CAÅKOWICIE zablokuj zmiany selekcji z React Flow\n        if (isManualSelectionRef.current && selectChanges.length > 0) {\n          // onNodeClick juÅ¼ obsÅ‚uÅ¼yÅ‚ selekcjÄ™ rÄ™cznie - CAÅKOWICIE zignoruj zmiany selekcji z React Flow\n          const otherChanges = changes.filter((c) => c.type !== 'select');\n          if (otherChanges.length > 0) {\n            onNodesChange(otherChanges);\n          }\n          // Nie pozwalaj React Flow zmieniaÄ‡ selekcji - caÅ‚kowicie zablokuj\n          return;\n        }\n        \n        // Box selection: wiele zmian selekcji jednoczeÅ›nie - rÄ™cznie zastosuj selekcjÄ™\n        // (React Flow nie zastosuje selekcji automatycznie, gdy elementsSelectable=false)\n        if (selectChanges.length > 1) {\n          isManualSelectionRef.current = false; // Box selection nie jest rÄ™cznym zarzÄ…dzaniem\n          pendingSelectionRef.current = null;\n          previousSelectedNodeIdsRef.current = new Set();\n          \n          // Zastosuj inne zmiany (pozycja, rozmiar itp.)\n          const otherChanges = changes.filter((c) => c.type !== 'select');\n          if (otherChanges.length > 0) {\n            onNodesChange(otherChanges);\n          }\n          \n          // RÄ™cznie zastosuj selekcjÄ™ dla wszystkich nodÃ³w w zmianach\n          setNodes((nds) => {\n            return nds.map((n) => {\n              const selectChange = selectChanges.find((c) => 'id' in c && c.id === n.id);\n              if (selectChange && 'selected' in selectChange) {\n                return { ...n, selected: selectChange.selected };\n              }\n              return n;\n            });\n          });\n          return;\n        }\n      }\n      \n      // Dla wszystkich innych przypadkÃ³w: normalne przetwarzanie\n      onNodesChange(changes);\n    },\n    [interactionMode, onNodesChange, pushUndoHistory, setNodes]\n  );\n\n  const wrappedOnEdgesChange = useCallback(\n    (changes: NodeChange[] | EdgeChange[]) => {\n      if (changes.some((c) => c.type === 'remove')) pushUndoHistory();\n      onEdgesChange(changes as EdgeChange[]);\n    },\n    [onEdgesChange, pushUndoHistory]\n  );\n\n  // W trybie select: obserwuj zmiany selekcji i przywracaj poprzednie selekcje, jeÅ›li React Flow je zresetowaÅ‚\n  useEffect(() => {\n    if (interactionMode !== 'select' || isRestoringSelectionRef.current || !isManualSelectionRef.current || !pendingSelectionRef.current) {\n      return;\n    }\n\n    const pending = pendingSelectionRef.current;\n    const previousSelected = previousSelectedNodeIdsRef.current;\n    \n    // SprawdÅº, czy selekcja zostaÅ‚a nieprawidÅ‚owo zresetowana\n    const currentSelectedNodeIds = new Set(nodes.filter(n => n.selected).map(n => n.id));\n    const clickedNode = nodes.find(n => n.id === pending.nodeId);\n    \n    // JeÅ›li klikniÄ™ty node nie ma poprawnej selekcji lub inne nody zostaÅ‚y odznaczone\n    const shouldRestore = \n      (clickedNode && clickedNode.selected !== pending.shouldSelect) ||\n      (previousSelected.size > 0 && Array.from(previousSelected).some(id => id !== pending.nodeId && !currentSelectedNodeIds.has(id)));\n    \n    if (shouldRestore) {\n      isRestoringSelectionRef.current = true;\n      \n      setNodes((nds) => {\n        return nds.map((n) => {\n          // Zastosuj intencjÄ™ dla klikniÄ™tego noda\n          if (n.id === pending.nodeId) {\n            return { ...n, selected: pending.shouldSelect };\n          }\n          // PrzywrÃ³Ä‡ selekcjÄ™ innych nodÃ³w, ktÃ³re byÅ‚y wczeÅ›niej zaznaczone\n          if (previousSelected.has(n.id)) {\n            return { ...n, selected: true };\n          }\n          return n;\n        });\n      });\n      \n      // Reset flagi po krÃ³tkim czasie\n      setTimeout(() => {\n        isRestoringSelectionRef.current = false;\n      }, 50);\n    }\n  }, [nodes, interactionMode, setNodes]);\n\n  // PodglÄ…d dynamiczny: aktualizuj selectedNode na Å¼ywo podczas edycji wÅ‚aÅ›ciwoÅ›ci tekstu\n  useEffect(() => {\n    if (selectedNode && selectedNode.type === 'text' && showPropertiesPanel) {\n      setNodes((nds) =>\n        nds.map((node) => {\n          if (node.id === selectedNode.id) {\n            return {\n              ...node,\n              data: {\n                ...node.data,\n                ...textNodeProperties,\n              },\n            };\n          }\n          return node;\n        })\n      );\n    }\n  }, [textNodeProperties, selectedNode, showPropertiesPanel, setNodes]);\n\n  // Zapisz width i height do data dla text nodes po zmianie rozmiaru (uÅ¼ywamy setTimeout, Å¼eby uniknÄ…Ä‡ pÄ™tli)\n  const prevNodesRef = useRef(nodes);\n  useEffect(() => {\n    const hasChanged = nodes.some((node, idx) => {\n      if (node.type === 'text') {\n        const prevNode = prevNodesRef.current[idx];\n        if (!prevNode || prevNode.id !== node.id) return false;\n        const widthChanged = node.width !== prevNode.width;\n        const heightChanged = node.height !== prevNode.height;\n        if (widthChanged || heightChanged) {\n          return true;\n        }\n      }\n      return false;\n    });\n\n    if (hasChanged) {\n      setNodes((nds) =>\n        nds.map((node) => {\n          if (node.type === 'text' && (node.width || node.height)) {\n            const currentWidth = node.width || node.data.width;\n            const currentHeight = node.height || node.data.height;\n            if (currentWidth !== node.data.width || currentHeight !== node.data.height) {\n              return {\n                ...node,\n                data: {\n                  ...node.data,\n                  width: currentWidth,\n                  height: currentHeight,\n                },\n              };\n            }\n          }\n          return node;\n        })\n      );\n    }\n    prevNodesRef.current = nodes;\n  }, [nodes, setNodes]);\n\n  // SprawdÅº, czy sÄ… niezapisane zmiany w panelach wÅ‚aÅ›ciwoÅ›ci\n  useEffect(() => {\n    if (!selectedNode) {\n      setHasUnsavedNodeChanges(false);\n      setHasUnsavedTextNodeChanges(false);\n      return;\n    }\n    \n    if (selectedNode.type === 'text') {\n      if (!lastSavedTextNodePropertiesRef.current) {\n        setHasUnsavedTextNodeChanges(false);\n        return;\n      }\n      const current = JSON.stringify(textNodeProperties);\n      const saved = JSON.stringify(lastSavedTextNodePropertiesRef.current);\n      setHasUnsavedTextNodeChanges(current !== saved);\n    } else {\n      if (!lastSavedNodePropertiesRef.current) {\n        setHasUnsavedNodeChanges(false);\n        return;\n      }\n      const current = JSON.stringify(nodeProperties);\n      const saved = JSON.stringify(lastSavedNodePropertiesRef.current);\n      setHasUnsavedNodeChanges(current !== saved);\n    }\n  }, [nodeProperties, textNodeProperties, selectedNode]);\n\n  useEffect(() => {\n    if (!selectedEdge) {\n      setHasUnsavedEdgeChanges(false);\n      return;\n    }\n    if (!lastSavedEdgePropertiesRef.current) {\n      setHasUnsavedEdgeChanges(false);\n      return;\n    }\n    const current = JSON.stringify(edgeProperties);\n    const saved = JSON.stringify(lastSavedEdgePropertiesRef.current);\n    setHasUnsavedEdgeChanges(current !== saved);\n  }, [edgeProperties, selectedEdge]);\n\n  const updateNodeProperties = async () => {\n    if (!selectedNode || !id) return;\n    pushUndoHistory();\n    \n    // JeÅ›li zaznaczamy isPinned: true, ustaw isPinned: false dla wszystkich innych nodÃ³w\n    const isPinning = (selectedNode.type === 'text' \n      ? textNodeProperties.isPinned \n      : nodeProperties.isPinned) === true;\n    \n    setNodes((nds) =>\n      nds.map((node) => {\n        if (node.id === selectedNode.id) {\n          if (node.type === 'text') {\n            return {\n              ...node,\n              data: {\n                ...node.data,\n                ...textNodeProperties,\n              },\n            };\n          } else {\n            return {\n              ...node,\n              data: {\n                ...node.data,\n                ...nodeProperties,\n                customFields: nodeCustomFields.length > 0 ? nodeCustomFields : undefined,\n              },\n            };\n          }\n        } else if (isPinning) {\n          // Odznacz wszystkie inne nody, jeÅ›li przypinamy ten\n          return {\n            ...node,\n            data: {\n              ...node.data,\n              isPinned: false,\n            },\n          };\n        }\n        return node;\n      })\n    );\n\n    // Zapisz customowe pola do bazy (tylko dla custom nodes) - zawsze, nawet jeÅ›li puste (Å¼eby usunÄ…Ä‡ stare)\n    if (selectedNode.type === 'custom') {\n      try {\n        await saveNodeCustomFields(selectedNode.id, id, nodeCustomFields);\n      } catch (error: any) {\n        console.error('BÅ‚Ä…d zapisywania customowych pÃ³l:', error);\n      }\n    }\n\n    // Reset dirty state po zapisaniu\n    if (selectedNode.type === 'text') {\n      lastSavedTextNodePropertiesRef.current = JSON.parse(JSON.stringify(textNodeProperties));\n      setHasUnsavedTextNodeChanges(false);\n    } else {\n      lastSavedNodePropertiesRef.current = JSON.parse(JSON.stringify(nodeProperties));\n      setHasUnsavedNodeChanges(false);\n    }\n\n    setSelectedNode(null);\n    setShowPropertiesPanel(false);\n  };\n\n  const deleteSelectedNode = () => {\n    if (!selectedNode) return;\n    pushUndoHistory();\n    setNodes((nds) => nds.filter((node) => node.id !== selectedNode.id));\n    setEdges((eds) => eds.filter((edge) => edge.source !== selectedNode.id && edge.target !== selectedNode.id));\n    setSelectedNode(null);\n    setShowPropertiesPanel(false);\n  };\n\n  const updateEdgeProperties = async () => {\n    if (!selectedEdge || !id) return;\n    pushUndoHistory();\n    \n    // Zapisz customowe pola do bazy - zawsze, nawet jeÅ›li puste (Å¼eby usunÄ…Ä‡ stare)\n    try {\n      await saveEdgeCustomFields(selectedEdge.id, id, edgeCustomFields);\n    } catch (error: any) {\n      console.error('BÅ‚Ä…d zapisywania customowych pÃ³l dla edge:', error);\n    }\n\n    setEdges((eds) =>\n      eds.map((edge) =>\n        edge.id === selectedEdge.id\n          ? {\n              ...edge,\n              data: {\n                ...edge.data,\n                ...edgeProperties,\n                customFields: edgeCustomFields.length > 0 ? edgeCustomFields : undefined,\n              },\n              label: edgeProperties.notes ? edgeProperties.notes : undefined,\n            }\n          : edge\n      )\n    );\n\n    setSelectedEdge(null);\n    setShowEdgeProperties(false);\n  };\n\n  const deleteSelectedEdge = () => {\n    if (!selectedEdge) return;\n    pushUndoHistory();\n    setEdges((eds) => eds.filter((edge) => edge.id !== selectedEdge.id));\n    setSelectedEdge(null);\n    setShowEdgeProperties(false);\n  };\n\n  // Wymiary nodÃ³w (uÅ¼ywane w alignNodes i liniach pomocniczych)\n  const getNodeDimensions = useCallback((node: Node) => {\n    const width = node.width || node.measured?.width || 150;\n    const height = node.height || node.measured?.height || 80;\n    return { width, height };\n  }, []);\n\n  // Funkcje wyrÃ³wnywania â€” np. \"top\" = wszystkie gÃ³rne krawÄ™dzie na tej samej wysokoÅ›ci (min Y)\n  const alignNodes = (direction: 'left' | 'right' | 'top' | 'bottom' | 'center-x' | 'center-y' | 'distribute-x' | 'distribute-y') => {\n    const selectedNodes = nodes.filter((node) => node.selected);\n    if (selectedNodes.length < 2) {\n      setAlertModal({\n        isOpen: true,\n        title: 'Wymagane zaznaczenie',\n        message: 'Zaznacz co najmniej 2 elementy (Ctrl+Click lub przeciÄ…gnij myszkÄ…), aby je wyrÃ³wnaÄ‡.',\n        type: 'info',\n      });\n      return;\n    }\n\n    let updatedNodes = [...nodes];\n\n    if (direction === 'left') {\n      const minX = Math.min(...selectedNodes.map((n) => n.position.x));\n      updatedNodes = updatedNodes.map((node) =>\n        selectedNodes.find((sn) => sn.id === node.id)\n          ? { ...node, position: { ...node.position, x: minX } }\n          : node\n      );\n    } else if (direction === 'right') {\n      const maxX = Math.max(...selectedNodes.map((n) => {\n        const dims = getNodeDimensions(n);\n        return n.position.x + dims.width;\n      }));\n      updatedNodes = updatedNodes.map((node) => {\n        const selected = selectedNodes.find((sn) => sn.id === node.id);\n        if (selected) {\n          const dims = getNodeDimensions(node);\n          return { ...node, position: { ...node.position, x: maxX - dims.width } };\n        }\n        return node;\n      });\n    } else if (direction === 'top') {\n      const minY = Math.min(...selectedNodes.map((n) => n.position.y));\n      updatedNodes = updatedNodes.map((node) =>\n        selectedNodes.find((sn) => sn.id === node.id)\n          ? { ...node, position: { ...node.position, y: minY } }\n          : node\n      );\n    } else if (direction === 'bottom') {\n      const maxY = Math.max(...selectedNodes.map((n) => {\n        const dims = getNodeDimensions(n);\n        return n.position.y + dims.height;\n      }));\n      updatedNodes = updatedNodes.map((node) => {\n        const selected = selectedNodes.find((sn) => sn.id === node.id);\n        if (selected) {\n          const dims = getNodeDimensions(node);\n          return { ...node, position: { ...node.position, y: maxY - dims.height } };\n        }\n        return node;\n      });\n    } else if (direction === 'center-x') {\n      const centerX = selectedNodes.reduce((sum, n) => {\n        const dims = getNodeDimensions(n);\n        return sum + n.position.x + dims.width / 2;\n      }, 0) / selectedNodes.length;\n      updatedNodes = updatedNodes.map((node) => {\n        const selected = selectedNodes.find((sn) => sn.id === node.id);\n        if (selected) {\n          const dims = getNodeDimensions(node);\n          return { ...node, position: { ...node.position, x: centerX - dims.width / 2 } };\n        }\n        return node;\n      });\n    } else if (direction === 'center-y') {\n      const centerY = selectedNodes.reduce((sum, n) => {\n        const dims = getNodeDimensions(n);\n        return sum + n.position.y + dims.height / 2;\n      }, 0) / selectedNodes.length;\n      updatedNodes = updatedNodes.map((node) => {\n        const selected = selectedNodes.find((sn) => sn.id === node.id);\n        if (selected) {\n          const dims = getNodeDimensions(node);\n          return { ...node, position: { ...node.position, y: centerY - dims.height / 2 } };\n        }\n        return node;\n      });\n    } else if (direction === 'distribute-x') {\n      const sorted = [...selectedNodes].sort((a, b) => a.position.x - b.position.x);\n      const firstDims = getNodeDimensions(sorted[0]);\n      const lastDims = getNodeDimensions(sorted[sorted.length - 1]);\n      const totalWidth = (sorted[sorted.length - 1].position.x + lastDims.width) - sorted[0].position.x;\n      const step = totalWidth / (sorted.length - 1);\n      sorted.forEach((node, idx) => {\n        if (idx > 0 && idx < sorted.length - 1) {\n          const nodeIndex = updatedNodes.findIndex((n) => n.id === node.id);\n          if (nodeIndex !== -1) {\n            updatedNodes[nodeIndex] = {\n              ...updatedNodes[nodeIndex],\n              position: { ...updatedNodes[nodeIndex].position, x: sorted[0].position.x + step * idx },\n            };\n          }\n        }\n      });\n    } else if (direction === 'distribute-y') {\n      const sorted = [...selectedNodes].sort((a, b) => a.position.y - b.position.y);\n      const firstDims = getNodeDimensions(sorted[0]);\n      const lastDims = getNodeDimensions(sorted[sorted.length - 1]);\n      const totalHeight = (sorted[sorted.length - 1].position.y + lastDims.height) - sorted[0].position.y;\n      const step = totalHeight / (sorted.length - 1);\n      sorted.forEach((node, idx) => {\n        if (idx > 0 && idx < sorted.length - 1) {\n          const nodeIndex = updatedNodes.findIndex((n) => n.id === node.id);\n          if (nodeIndex !== -1) {\n            updatedNodes[nodeIndex] = {\n              ...updatedNodes[nodeIndex],\n              position: { ...updatedNodes[nodeIndex].position, y: sorted[0].position.y + step * idx },\n            };\n          }\n        }\n      });\n    }\n\n    pushUndoHistory();\n    setNodes(updatedNodes);\n  };\n\n  // PoÅ‚Ä…cz standardowe szablony z wÅ‚asnymi\n  const allTemplates = [...nodeTemplates, ...customTemplates];\n  \n  const groupedTemplates = allTemplates.reduce((acc, template) => {\n    if (!acc[template.category]) {\n      acc[template.category] = [];\n    }\n    acc[template.category].push(template);\n    return acc;\n  }, {} as Record<string, typeof allTemplates>);\n\n  // Sortuj elementy w kaÅ¼dej kategorii - \"Inne\" na koÅ„cu\n  Object.keys(groupedTemplates).forEach((category) => {\n    groupedTemplates[category].sort((a, b) => {\n      if (a.label === 'Inne') return 1;\n      if (b.label === 'Inne') return -1;\n      return 0;\n    });\n  });\n\n  if (loading || !resolvedParams) {\n    return <LoadingState variant=\"fullscreen\" label=\"Åadowanie lejkaâ€¦\" />;\n  }\n\n  if (!funnel) {\n    return (\n      <div className=\"h-screen bg-[#101820] flex items-center justify-center\">\n        <div className=\"text-center text-white\">\n          <p className=\"text-lg mb-4\">Lejek nie zostaÅ‚ znaleziony</p>\n          <button\n            onClick={() => router.push('/panel/marketing')}\n            className=\"px-5 py-2.5 bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715] rounded-lg font-medium hover:bg-[#fee715]/20 hover:border-[#fee715]/70 transition-all duration-200\"\n          >\n            WrÃ³Ä‡ do listy\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-screen bg-[#101820] flex flex-col relative\">\n      {/* Mini-przycisk do przywrÃ³cenia ukrytego headera */}\n      {!showHeader && (\n        <button\n          onClick={() => setShowHeader(true)}\n          className=\"fixed top-2 left-2 z-50 p-2 bg-[#18232F]/95 border border-[#fee715]/30 text-[#fee715] rounded-lg hover:bg-[#fee715]/10 hover:border-[#fee715]/50 transition-all duration-200 shadow-lg backdrop-blur-sm\"\n          title=\"PokaÅ¼ nagÅ‚Ã³wek\"\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n          </svg>\n        </button>\n      )}\n\n      {/* Header */}\n      <div className={`flex items-center justify-between px-6 py-4 border-b border-white/10 bg-[#18232F] transition-all duration-300 ${showHeader ? 'opacity-100' : 'opacity-0 h-0 overflow-hidden border-0'}`}>\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={() => router.push('/panel/marketing')}\n            className=\"p-2 hover:bg-white/10 rounded-lg transition-all\"\n          >\n            <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\n            </svg>\n          </button>\n          <div className=\"flex-1\">\n            {!isEditingTitle ? (\n              <h1 \n                className=\"font-[Montserrat] text-xl font-bold text-white cursor-pointer hover:text-[#fee715] transition-colors\"\n                onClick={() => {\n                  setIsEditingTitle(true);\n                  setEditedTitle(funnel.project_name || '');\n                }}\n                title=\"Kliknij, aby edytowaÄ‡ tytuÅ‚\"\n              >\n                Mapa marketingu - {funnel.project_name || 'Bez nazwy'}\n              </h1>\n            ) : (\n              <input\n                type=\"text\"\n                value={editedTitle}\n                onChange={(e) => setEditedTitle(e.target.value)}\n                onBlur={async () => {\n                  setIsEditingTitle(false);\n                  if (editedTitle !== funnel.project_name && funnel) {\n                    try {\n                      const { error } = await supabase\n                        .from('funnel_diagrams')\n                        .update({ project_name: editedTitle })\n                        .eq('id', funnel.id);\n                      if (error) throw error;\n                      setFunnel({ ...funnel, project_name: editedTitle });\n                    } catch (error: any) {\n                      console.error('BÅ‚Ä…d zapisywania tytuÅ‚u:', error);\n                      setEditedTitle(funnel.project_name || '');\n                    }\n                  }\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') {\n                    e.currentTarget.blur();\n                  }\n                  if (e.key === 'Escape') {\n                    setEditedTitle(funnel.project_name || '');\n                    setIsEditingTitle(false);\n                  }\n                }}\n                className=\"font-[Montserrat] text-xl font-bold text-white bg-white/10 border border-[#fee715]/50 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 w-full max-w-md\"\n                autoFocus\n              />\n            )}\n            {!isEditingSubtitle ? (\n              <div\n                className=\"inline-flex items-center px-3 py-1 rounded-md bg-white/[0.04] border border-white/10 text-xs font-medium text-gray-300 cursor-pointer hover:bg-white/[0.06] hover:border-white/20 hover:text-white transition-all mt-0.5\"\n                onClick={() => {\n                  setIsEditingSubtitle(true);\n                  setEditedSubtitle(funnel.subtitle || '');\n                  // Ustaw tryb na podstawie aktualnego podtytuÅ‚u\n                  const standardSubtitles = ['stan obecny', 'docelowy', 'Plan 90 dni'];\n                  if (funnel.subtitle && standardSubtitles.includes(funnel.subtitle)) {\n                    setSubtitleMode('select');\n                  } else {\n                    setSubtitleMode('custom');\n                  }\n                }}\n                title=\"Kliknij, aby edytowaÄ‡ podtytuÅ‚\"\n              >\n                {funnel.subtitle || 'Kliknij, aby dodaÄ‡ podtytuÅ‚'}\n              </div>\n            ) : (\n              <div className=\"mt-1 flex items-center gap-2\">\n                {subtitleMode === 'select' ? (\n                  <CustomSelect\n                    value={editedSubtitle || ''}\n                    onChange={async (value) => {\n                      if (value === 'custom') {\n                        setSubtitleMode('custom');\n                        setEditedSubtitle('');\n                      } else {\n                        setEditedSubtitle(value);\n                        // Automatycznie zapisz gdy wybierzesz opcjÄ™ z listy\n                        if (funnel && value !== funnel.subtitle) {\n                          try {\n                            const { error } = await supabase\n                              .from('funnel_diagrams')\n                              .update({ subtitle: value })\n                              .eq('id', funnel.id);\n                            if (error) throw error;\n                            setFunnel({ ...funnel, subtitle: value });\n                            setIsEditingSubtitle(false);\n                          } catch (error: any) {\n                            console.error('BÅ‚Ä…d zapisywania podtytuÅ‚u:', error);\n                          }\n                        } else {\n                          setIsEditingSubtitle(false);\n                        }\n                      }\n                    }}\n                    options={[\n                      { value: 'stan obecny', label: 'stan obecny' },\n                      { value: 'docelowy', label: 'docelowy' },\n                      { value: 'Plan 90 dni', label: 'Plan 90 dni' },\n                      { value: 'custom', label: 'WÅ‚asny tekst...' },\n                    ]}\n                    placeholder=\"Wybierz podtytuÅ‚\"\n                    className=\"w-48\"\n                    size=\"sm\"\n                  />\n                ) : (\n                  <input\n                    type=\"text\"\n                    value={editedSubtitle}\n                    onChange={(e) => setEditedSubtitle(e.target.value)}\n                    placeholder=\"Wpisz wÅ‚asny podtytuÅ‚\"\n                    className=\"text-sm bg-white/10 border border-[#fee715]/50 rounded px-2 py-1 text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 w-48\"\n                    autoFocus\n                  />\n                )}\n                <button\n                  onClick={async () => {\n                    if (funnel) {\n                      const subtitleToSave = editedSubtitle.trim() || null;\n                      try {\n                        const { error } = await supabase\n                          .from('funnel_diagrams')\n                          .update({ subtitle: subtitleToSave })\n                          .eq('id', funnel.id);\n                        if (error) throw error;\n                        // Zaktualizuj stan funnel z zapisanym podtytuÅ‚em\n                        setFunnel({ ...funnel, subtitle: subtitleToSave });\n                        // JeÅ›li wpisany tekst jest standardowy, wrÃ³Ä‡ do trybu select\n                        const standardSubtitles = ['stan obecny', 'docelowy', 'Plan 90 dni'];\n                        if (subtitleToSave && standardSubtitles.includes(subtitleToSave)) {\n                          setSubtitleMode('select');\n                        }\n                        setIsEditingSubtitle(false);\n                      } catch (error: any) {\n                        console.error('BÅ‚Ä…d zapisywania podtytuÅ‚u:', error);\n                        // W przypadku bÅ‚Ä™du, przywrÃ³Ä‡ poprzedniÄ… wartoÅ›Ä‡\n                        setEditedSubtitle(funnel.subtitle || '');\n                        setIsEditingSubtitle(false);\n                      }\n                    } else {\n                      setIsEditingSubtitle(false);\n                    }\n                  }}\n                  className=\"px-2 py-1 text-xs bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715] rounded hover:bg-[#fee715]/20 transition-colors\"\n                >\n                  âœ“\n                </button>\n                <button\n                  onClick={() => {\n                    setEditedSubtitle(funnel.subtitle || '');\n                    setIsEditingSubtitle(false);\n                    const standardSubtitles = ['stan obecny', 'docelowy', 'Plan 90 dni'];\n                    if (funnel.subtitle && standardSubtitles.includes(funnel.subtitle)) {\n                      setSubtitleMode('select');\n                    } else if (funnel.subtitle) {\n                      setSubtitleMode('custom');\n                    }\n                  }}\n                  className=\"px-2 py-1 text-xs bg-white/10 border border-white/20 text-white/70 rounded hover:bg-white/20 transition-colors\"\n                  title=\"Anuluj\"\n                >\n                  Ã—\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={() => setShowHeader(false)}\n            className=\"p-1.5 hover:bg-white/10 rounded-lg transition-all text-gray-400 hover:text-white\"\n            title=\"Ukryj nagÅ‚Ã³wek\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </button>\n          {saving && user?.email === 'stanislaw@drozniak.com' && (\n            <span className=\"text-sm text-gray-400 flex items-center gap-2\">\n              <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n              </svg>\n              ZapisujÄ™...\n            </span>\n          )}\n          <button\n            onClick={handleUndo}\n            disabled={undoHistory.length === 0}\n            title=\"Cofnij ostatniÄ… zmianÄ™ (Ctrl+Z)\"\n            className=\"px-4 py-2 bg-white/[0.06] border border-white/20 text-white/90 rounded-lg font-medium hover:bg-white/10 hover:border-white/30 transition-colors disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.06] disabled:hover:border-white/20\"\n          >\n            Wstecz\n          </button>\n          <button\n            onClick={() => {\n              setShowCommentPanel(!showCommentPanel);\n              if (!showCommentPanel) {\n                loadCommentCounts();\n              }\n            }}\n            className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n              showCommentPanel\n                ? 'bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715]'\n                : 'bg-white/[0.06] border border-white/20 text-white/90 hover:bg-white/10'\n            }`}\n            title=\"Komentarze\"\n          >\n            <ChatCircleDots size={18} className=\"inline-block mr-1.5\" />\n            Komentarze\n          </button>\n          <button\n            onClick={saveFunnel}\n            className=\"relative px-5 py-2 bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715] rounded-lg font-medium hover:bg-[#fee715]/20 hover:border-[#fee715]/70 transition-all duration-200\"\n          >\n            <span className=\"flex items-center gap-2\">\n              Zapisz zmiany\n              {hasUnsavedChanges && (\n                <span className=\"w-2 h-2 bg-[#fee715] rounded-full animate-pulse\" title=\"Masz niezapisane zmiany\"></span>\n              )}\n            </span>\n          </button>\n        </div>\n      </div>\n\n      {/* Mini-przycisk do przywrÃ³cenia ukrytego sidebara */}\n      {!showSidebar && (\n        <button\n          onClick={() => setShowSidebar(true)}\n          className={`fixed z-50 p-2 bg-[#0a0f14]/95 border border-[#fee715]/30 text-[#fee715] rounded-lg hover:bg-[#fee715]/10 hover:border-[#fee715]/50 transition-all duration-200 shadow-lg backdrop-blur-sm ${!showHeader ? 'top-14 left-2' : 'top-2 left-2'}`}\n          title=\"PokaÅ¼ panel elementÃ³w\"\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n          </svg>\n        </button>\n      )}\n\n      <div className=\"flex-1 flex overflow-hidden relative\">\n        {/* Sidebar - Node Templates */}\n        <div \n          className={`transition-all duration-300 overflow-hidden funnel-builder-sidebar ${\n            showSidebar ? 'w-64 opacity-100' : 'w-0 opacity-0'\n          }`}\n          style={{ \n            backgroundColor: '#0a0f14',\n            background: '#0a0f14',\n          }}\n        >\n          <div className=\"w-64 h-full border-r-2 border-[#fee715]/30 overflow-y-auto p-4 shadow-2xl\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"font-[Montserrat] font-medium text-[#fee715] text-base tracking-tight border-b border-[#fee715]/20 pb-2.5 flex-1\">Elementy</h3>\n              <button\n                onClick={() => setShowSidebar(false)}\n                className=\"p-1.5 hover:bg-white/10 rounded-lg transition-all text-gray-400 hover:text-white ml-2\"\n                title=\"Ukryj panel elementÃ³w\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n          <div className=\"space-y-6\">\n            {Object.entries(groupedTemplates).map(([category, templates]) => (\n              <div key={category}>\n                <h4 className=\"text-xs font-medium text-[#fee715] uppercase mb-3 tracking-wider px-2\">{category}</h4>\n                <div className=\"space-y-2\">\n                  {templates.map((template, idx) => (\n                    <div\n                      key={idx}\n                      draggable\n                      onDragStart={(event) => {\n                        event.dataTransfer.setData('application/reactflow', JSON.stringify(template));\n                      }}\n                      className=\"p-3 bg-[#18232F]/90 rounded-lg border border-white/10 hover:border-[#fee715]/40 cursor-move transition-all duration-200 shadow-sm hover:shadow-lg hover:shadow-[#fee715]/10 backdrop-blur-sm relative overflow-hidden group\"\n                      style={{\n                        background: 'linear-gradient(to bottom, rgba(24, 35, 47, 0.9), rgba(24, 35, 47, 0.9))',\n                      }}\n                      onMouseEnter={(e) => {\n                        e.currentTarget.style.background = 'linear-gradient(135deg, rgba(254, 231, 21, 0.08) 0%, rgba(24, 35, 47, 0.95) 50%, rgba(254, 231, 21, 0.05) 100%)';\n                      }}\n                      onMouseLeave={(e) => {\n                        e.currentTarget.style.background = 'linear-gradient(to bottom, rgba(24, 35, 47, 0.9), rgba(24, 35, 47, 0.9))';\n                      }}\n                    >\n                      <div className=\"flex items-center gap-2 relative z-10\">\n                        <div className=\"text-white\">\n                          {renderPhosphorIcon(template.icon, 18)}\n                        </div>\n                        <span className=\"text-sm text-white/95 font-medium tracking-tight\">{template.label}</span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n          </div>\n        </div>\n\n        {/* Main Canvas */}\n        <div className=\"flex-1 relative\" ref={reactFlowWrapper}>\n          {/* Legenda */}\n          {showLegend && (\n            <div className=\"absolute top-4 right-4 z-20 bg-[#0a0f14]/98 border border-white/10 rounded-lg shadow-xl backdrop-blur-sm p-4 min-w-[200px]\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xs font-medium text-white/90 tracking-tight\">Legenda</h3>\n                <button\n                  onClick={() => setShowLegend(false)}\n                  className=\"p-1 hover:bg-white/10 rounded transition-all text-gray-400 hover:text-white\"\n                  title=\"Ukryj legendÄ™\"\n                >\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n              <div className=\"space-y-3 text-xs\">\n                <div className=\"flex items-start gap-2.5\">\n                  <div className=\"relative shrink-0 mt-0.5\">\n                    <div className=\"w-6 h-6 rounded-lg flex items-center justify-center text-white\" style={{ backgroundColor: '#4285F420' }}>\n                      {renderPhosphorIcon('MegaphoneSimple', 14)}\n                    </div>\n                    <div className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]\" style={{ backgroundColor: '#4285F4' }}></div>\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"text-white/90 font-medium\">Å¹rÃ³dÅ‚a Ruchu</div>\n                    <div className=\"text-white/50 text-[10px] mt-0.5\">Facebook Ads, Google Ads, Email</div>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-2.5\">\n                  <div className=\"relative shrink-0 mt-0.5\">\n                    <div className=\"w-6 h-6 rounded-lg flex items-center justify-center text-white\" style={{ backgroundColor: '#00C9A720' }}>\n                      {renderPhosphorIcon('Globe', 14)}\n                    </div>\n                    <div className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]\" style={{ backgroundColor: '#00C9A7' }}></div>\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"text-white/90 font-medium\">Typ Strony</div>\n                    <div className=\"text-white/50 text-[10px] mt-0.5\">Landing, SprzedaÅ¼owa, Checkout</div>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-2.5\">\n                  <div className=\"relative shrink-0 mt-0.5\">\n                    <div className=\"w-6 h-6 rounded-lg flex items-center justify-center text-white\" style={{ backgroundColor: '#fee71520' }}>\n                      {renderPhosphorIcon('Notebook', 14)}\n                    </div>\n                    <div className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]\" style={{ backgroundColor: '#fee715' }}></div>\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"text-white/90 font-medium\">DziaÅ‚ania</div>\n                    <div className=\"text-white/50 text-[10px] mt-0.5\">Lead magnet, Webinar, Chatbot</div>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-2.5\">\n                  <div className=\"relative shrink-0 mt-0.5\">\n                    <div className=\"w-6 h-6 rounded-lg flex items-center justify-center text-white\" style={{ backgroundColor: '#10B98120' }}>\n                      {renderPhosphorIcon('CheckCircle', 14)}\n                    </div>\n                    <div className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]\" style={{ backgroundColor: '#10B981' }}></div>\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"text-white/90 font-medium\">Cel/Konwersja</div>\n                    <div className=\"text-white/50 text-[10px] mt-0.5\">Lead, Rezerwacja, Telefon, SprzedaÅ¼</div>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-2.5\">\n                  <div className=\"relative shrink-0 mt-0.5\">\n                    <div className=\"w-6 h-6 rounded-lg flex items-center justify-center text-white bg-white/5 border border-white/10\">\n                      {renderPhosphorIcon('FileText', 14)}\n                    </div>\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"text-white/90 font-medium\">NarzÄ™dzia</div>\n                    <div className=\"text-white/50 text-[10px] mt-0.5\">Pola tekstowe, notatki</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n          {!showLegend && (\n            <button\n              onClick={() => setShowLegend(true)}\n              className=\"absolute top-4 right-4 z-20 p-2 bg-[#0a0f14]/95 border border-white/10 text-white/70 rounded-lg hover:bg-white/10 hover:text-white transition-all duration-200 shadow-lg backdrop-blur-sm\"\n              title=\"PokaÅ¼ legendÄ™\"\n            >\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n            </button>\n          )}\n          <FunnelSelectModeContext.Provider value={{ isSelectMode: interactionMode === 'select', onLongPressDeselect }}>\n          <ReactFlow\n            nodes={nodes.map(node => {\n              const commentInfo = nodeCommentCounts.get(node.id);\n              if (commentInfo && commentInfo.count > 0) {\n                const updatedNode = {\n                  ...node,\n                  data: {\n                    ...node.data,\n                    commentCount: commentInfo.count,\n                    commentStatus: commentInfo.status,\n                  },\n                };\n                // Debug: sprawdÅº czy dane sÄ… poprawnie przypisane\n                if (node.id === nodes[0]?.id) {\n                  console.log('PrzykÅ‚adowy node z komentarzami:', {\n                    nodeId: updatedNode.id,\n                    commentCount: updatedNode.data.commentCount,\n                    commentStatus: updatedNode.data.commentStatus,\n                    hasBadge: updatedNode.data.commentCount !== undefined && updatedNode.data.commentCount > 0\n                  });\n                }\n                return updatedNode;\n              }\n              // Upewnij siÄ™, Å¼e commentCount jest undefined jeÅ›li nie ma komentarzy\n              return {\n                ...node,\n                data: {\n                  ...node.data,\n                  commentCount: undefined,\n                  commentStatus: undefined,\n                },\n              };\n            })}\n            edges={edges.map(edge => {\n              const commentInfo = edgeCommentCounts.get(edge.id);\n              if (commentInfo && commentInfo.count > 0) {\n                return {\n                  ...edge,\n                  data: {\n                    ...edge.data,\n                    commentCount: commentInfo.count,\n                    commentStatus: commentInfo.status,\n                  },\n                };\n              }\n              // Upewnij siÄ™, Å¼e commentCount jest undefined jeÅ›li nie ma komentarzy\n              return {\n                ...edge,\n                data: {\n                  ...edge.data,\n                  commentCount: undefined,\n                  commentStatus: undefined,\n                },\n              };\n            })}\n            onNodesChange={wrappedOnNodesChange}\n            onEdgesChange={wrappedOnEdgesChange}\n            onConnect={onConnect}\n            onNodeDragStart={(_, node) => {\n              isDraggingNodeRef.current = true;\n              pushUndoHistory();\n            }}\n            isValidConnection={() => true}\n            onInit={setReactFlowInstance}\n            onDrop={onDrop}\n            onDragOver={onDragOver}\n            onNodeClick={onNodeClick}\n            onEdgeClick={onEdgeClick}\n            onPaneClick={onPaneClick}\n            onSelectionChange={(params) => {\n              // W trybie select: rÄ™cznie zarzÄ…dzamy selekcjÄ…, wiÄ™c ignorujemy ten callback\n              // Box selection jest obsÅ‚ugiwane przez wrappedOnNodesChange\n              if (interactionMode === 'select' && isManualSelectionRef.current) {\n                return;\n              }\n            }}\n            onViewportChange={(vp) => { setViewport(vp); setCurrentZoom(vp.zoom); }}\n            onNodeDrag={(_, node, allNodes) => {\n              const others = allNodes.filter((n) => n.id !== node.id);\n              if (others.length === 0) { setAlignmentGuides({ vertical: [], horizontal: [] }); return; }\n              const d = getNodeDimensions(node);\n              const left = node.position.x, cX = node.position.x + d.width / 2, right = node.position.x + d.width;\n              const top = node.position.y, cY = node.position.y + d.height / 2, bottom = node.position.y + d.height;\n              const vSet = new Set<number>(), hSet = new Set<number>();\n              const T = 5;\n              others.forEach((o) => {\n                const od = getNodeDimensions(o);\n                const oL = o.position.x, oCX = o.position.x + od.width / 2, oR = o.position.x + od.width;\n                const oT = o.position.y, oCY = o.position.y + od.height / 2, oB = o.position.y + od.height;\n                if (Math.abs(left - oL) <= T || Math.abs(cX - oL) <= T || Math.abs(right - oL) <= T) vSet.add(oL);\n                if (Math.abs(left - oCX) <= T || Math.abs(cX - oCX) <= T || Math.abs(right - oCX) <= T) vSet.add(oCX);\n                if (Math.abs(left - oR) <= T || Math.abs(cX - oR) <= T || Math.abs(right - oR) <= T) vSet.add(oR);\n                if (Math.abs(top - oT) <= T || Math.abs(cY - oT) <= T || Math.abs(bottom - oT) <= T) hSet.add(oT);\n                if (Math.abs(top - oCY) <= T || Math.abs(cY - oCY) <= T || Math.abs(bottom - oCY) <= T) hSet.add(oCY);\n                if (Math.abs(top - oB) <= T || Math.abs(cY - oB) <= T || Math.abs(bottom - oB) <= T) hSet.add(oB);\n              });\n              setAlignmentGuides({ vertical: Array.from(vSet), horizontal: Array.from(hSet) });\n            }}\n            onNodeDragStop={(_, node) => {\n              const d = getNodeDimensions(node);\n              const T = 5;\n              let newX = node.position.x, newY = node.position.y;\n              for (const g of alignmentGuides.vertical) {\n                const dl = Math.abs(node.position.x - g), dc = Math.abs(node.position.x + d.width / 2 - g), dr = Math.abs(node.position.x + d.width - g);\n                if (dl <= T) { newX = g; break; }\n                if (dc <= T) { newX = g - d.width / 2; break; }\n                if (dr <= T) { newX = g - d.width; break; }\n              }\n              for (const g of alignmentGuides.horizontal) {\n                const dt = Math.abs(node.position.y - g), dc = Math.abs(node.position.y + d.height / 2 - g), db = Math.abs(node.position.y + d.height - g);\n                if (dt <= T) { newY = g; break; }\n                if (dc <= T) { newY = g - d.height / 2; break; }\n                if (db <= T) { newY = g - d.height; break; }\n              }\n              if (newX !== node.position.x || newY !== node.position.y) {\n                setNodes((nds) => nds.map((n) => n.id === node.id ? { ...n, position: { x: newX, y: newY } } : n));\n              }\n              setAlignmentGuides({ vertical: [], horizontal: [] });\n            }}\n            nodeTypes={nodeTypes}\n            edgeTypes={edgeTypes}\n            fitView={true}\n            fitViewOptions={{ padding: 0.2, duration: 0 }}\n            className={`bg-[#101820] ${interactionMode === 'select' ? 'funnel-select-mode' : ''}`}\n            connectionLineType={\"smoothstep\" as any}\n            snapToGrid={true}\n            snapGrid={[20, 20]}\n            connectionLineStyle={{ stroke: '#fee715', strokeWidth: 2, strokeDasharray: '5,5' }}\n            defaultEdgeOptions={{\n              type: 'custom',\n              animated: false,\n              style: { stroke: '#fee715', strokeWidth: 2 },\n              markerStart: undefined,\n              markerEnd: {\n                type: MarkerType.ArrowClosed,\n                color: '#fee715',\n                orient: 'auto',\n              },\n            }}\n            nodesDraggable={true}\n            nodesConnectable={true}\n            nodesFocusable={true}\n            elementsSelectable={interactionMode !== 'select'} // W trybie select wyÅ‚Ä…czamy domyÅ›lne zaznaczanie - zarzÄ…dzamy rÄ™cznie\n            selectNodesOnDrag={false}\n            panOnDrag={interactionMode === 'pan' ? true : (isSpacePressed ? [1, 2] : false)}\n            panOnScroll={true}\n            zoomOnScroll={true}\n            zoomOnPinch={true}\n            zoomOnDoubleClick={false}\n            preventScrolling={false}\n            selectionOnDrag={interactionMode === 'select'}\n            selectionMode={\"full\" as any}\n            multiSelectionKeyCode={null} // W trybie select box selection dziaÅ‚a bez Ctrl\n            deleteKeyCode={['Delete', 'Backspace']}\n            connectionMode={\"loose\" as any}\n            connectionRadius={80}\n            minZoom={0.01}\n            maxZoom={10}\n            proOptions={{ hideAttribution: true }}\n          >\n            <Background \n              variant={BackgroundVariant.Dots} \n              gap={20} \n              size={1.5} \n              color=\"#ffffff25\"\n              style={{ opacity: 0.6 }}\n            />\n            {/* Mini-przycisk do przywrÃ³cenia ukrytego dolnego toolbara */}\n            {!showBottomToolbar && (\n              <Panel position=\"bottom-left\">\n                <button\n                  onClick={() => setShowBottomToolbar(true)}\n                  className=\"p-2 bg-[#0a0f14]/95 border border-[#fee715]/30 text-[#fee715] rounded-lg hover:bg-[#fee715]/10 hover:border-[#fee715]/50 transition-all duration-200 shadow-lg backdrop-blur-sm\"\n                  title=\"PokaÅ¼ narzÄ™dzia\"\n                >\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                  </svg>\n                </button>\n              </Panel>\n            )}\n\n            {/* Custom Controls Toolbar */}\n            {showBottomToolbar && (\n              <Panel position=\"bottom-left\" className=\"bg-[#0a0f14]/95 border border-amber-500/20 rounded-lg p-2 shadow-xl backdrop-blur-sm\">\n                <div className=\"flex items-center gap-2\">\n                  {/* Przycisk ukrycia toolbara */}\n                  <button\n                    onClick={() => setShowBottomToolbar(false)}\n                    className=\"p-1.5 hover:bg-white/10 rounded-lg transition-all text-gray-400 hover:text-white\"\n                    title=\"Ukryj narzÄ™dzia\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                  \n                  {/* Tryby interakcji */}\n                  <div className=\"flex items-center gap-1 border-r border-[#fee715]/20 pr-2 mr-2\">\n                    <span className=\"text-xs text-amber-400/90 font-medium mr-1\">Tryb:</span>\n                  <button\n                    onClick={() => setInteractionMode('pan')}\n                    className={`p-2 rounded-lg transition-all duration-200 ${\n                      interactionMode === 'pan'\n                        ? 'bg-gradient-to-r from-amber-600 to-amber-500 text-white shadow-md shadow-amber-900/20'\n                        : 'bg-[#18232F]/80 text-white/80 hover:bg-amber-500/10 hover:text-white border border-white/10 hover:border-amber-500/50 backdrop-blur-sm'\n                    }`}\n                    title=\"Przesuwanie (Space + drag lub Å›rodkowy przycisk myszy)\"\n                  >\n                    <Hand size={16} />\n                  </button>\n                  <button\n                    onClick={() => setInteractionMode('select')}\n                    className={`p-2 rounded-lg transition-all duration-200 ${\n                      interactionMode === 'select'\n                        ? 'bg-gradient-to-r from-amber-600 to-amber-500 text-white shadow-md shadow-amber-900/20'\n                        : 'bg-[#18232F]/80 text-white/80 hover:bg-amber-500/10 hover:text-white border border-white/10 hover:border-amber-500/50 backdrop-blur-sm'\n                    }`}\n                    title=\"Zaznaczanie elementÃ³w: Klikaj elementy lub przeciÄ…gnij po pustym tle (box selection)\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122\" />\n                    </svg>\n                  </button>\n                  <button\n                    onClick={() => {\n                      setCommentMode(!commentMode);\n                      setInteractionMode(commentMode ? 'pan' : 'comment');\n                    }}\n                    className={`p-2 rounded-lg transition-all duration-200 ${\n                      commentMode\n                        ? 'bg-gradient-to-r from-amber-600 to-amber-500 text-white shadow-md shadow-amber-900/20'\n                        : 'bg-[#18232F]/80 text-white/80 hover:bg-amber-500/10 hover:text-white border border-white/10 hover:border-amber-500/50 backdrop-blur-sm'\n                    }`}\n                    title=\"Dodaj komentarz (kliknij na element)\"\n                  >\n                    <ChatCircleDots size={16} />\n                  </button>\n                </div>\n                \n                {/* Kontrolki zoom */}\n                <div className=\"flex items-center gap-1\">\n                  <button\n                    onClick={() => reactFlowInstance?.zoomOut({ duration: 300 })}\n                    className=\"p-2 bg-[#18232F]/80 border border-white/10 hover:border-amber-500/50 hover:bg-amber-500/10 rounded-lg transition-all duration-200 text-white/80 hover:text-white backdrop-blur-sm\"\n                    title=\"Oddal (Zoom Out)\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7\" />\n                    </svg>\n                  </button>\n                  <button\n                    onClick={() => reactFlowInstance?.zoomIn({ duration: 300 })}\n                    className=\"p-2 bg-[#18232F]/80 border border-white/10 hover:border-amber-500/50 hover:bg-amber-500/10 rounded-lg transition-all duration-200 text-white/80 hover:text-white backdrop-blur-sm\"\n                    title=\"PrzybliÅ¼ (Zoom In)\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7\" />\n                    </svg>\n                  </button>\n                  <button\n                    onClick={() => reactFlowInstance?.fitView({ duration: 300, padding: 0.2 })}\n                    className=\"p-2 bg-[#18232F]/80 border border-white/10 hover:border-amber-500/50 hover:bg-amber-500/10 rounded-lg transition-all duration-200 text-white/80 hover:text-white backdrop-blur-sm\"\n                    title=\"Dopasuj do widoku (Fit View)\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\" />\n                    </svg>\n                  </button>\n                  <div className=\"px-2 text-xs text-amber-400/90 font-medium border-l border-amber-500/20 ml-2 pl-2\">\n                    {(currentZoom * 100).toFixed(0)}%\n                  </div>\n                </div>\n              </div>\n            </Panel>\n            )}\n            {showMinimap && (\n              <div className=\"absolute bottom-4 right-4 z-10\">\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setShowMinimap(false)}\n                    className=\"absolute -top-2 -right-2 z-20 w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold shadow-lg transition-all\"\n                    title=\"Zamknij podglÄ…d\"\n                  >\n                    Ã—\n                  </button>\n                  <MiniMap\n                    className=\"bg-[#18232F] border-2 border-[#fee715] rounded-lg shadow-2xl\"\n                    nodeColor=\"#fee715\"\n                    nodeStrokeColor=\"#101820\"\n                    nodeStrokeWidth={2}\n                    maskColor=\"rgba(16, 24, 32, 0.9)\"\n                    style={{\n                      backgroundColor: '#18232F',\n                    }}\n                    pannable\n                    zoomable\n                  />\n                </div>\n              </div>\n            )}\n            {!showMinimap && (\n              <button\n                onClick={() => setShowMinimap(true)}\n                className=\"absolute bottom-4 right-4 z-10 px-4 py-2 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded-lg font-medium hover:bg-[#fee715]/20 hover:border-[#fee715]/60 transition-all duration-200\"\n                title=\"PokaÅ¼ podglÄ…d\"\n              >\n                â†‘ PodglÄ…d\n              </button>\n            )}\n            {/* Toolbar z opcjami wyrÃ³wnywania - kompaktowy, tylko ikony */}\n            {showAlignToolbar && (\n              <Panel position=\"top-center\" className=\"bg-transparent\">\n                <div className=\"flex items-center gap-1.5 bg-[#0a0f14]/95 border border-white/10 rounded-lg p-1.5 shadow-xl backdrop-blur-sm\">\n                  <button\n                    onClick={() => alignNodes('center-y')}\n                    className=\"p-1.5 bg-[#18232F]/80 border border-white/10 hover:border-[#fee715]/50 hover:bg-[#fee715]/10 rounded transition-all duration-200 text-white/80 hover:text-white\"\n                    title=\"WyrÃ³wnaj w pionie (ta sama wysokoÅ›Ä‡ Y)\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 12h16M4 12l4-4m-4 4l4 4m12-4l-4-4m4 4l-4 4\" />\n                    </svg>\n                  </button>\n                  <button\n                    onClick={() => alignNodes('center-x')}\n                    className=\"p-1.5 bg-[#18232F]/80 border border-white/10 hover:border-[#fee715]/50 hover:bg-[#fee715]/10 rounded transition-all duration-200 text-white/80 hover:text-white\"\n                    title=\"WyrÃ³wnaj w poziomie (ta sama pozycja X)\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16M12 4l-4 4m4-4l4 4m-4 12l-4-4m4 4l4-4\" />\n                    </svg>\n                  </button>\n                  <div className=\"w-px h-4 bg-white/10 mx-0.5\"></div>\n                  <button\n                    onClick={() => setShowAlignToolbar(false)}\n                    className=\"p-1.5 bg-[#18232F]/80 border border-white/10 hover:border-white/30 hover:bg-white/10 rounded transition-all duration-200 text-white/60 hover:text-white\"\n                    title=\"Ukryj panel\"\n                  >\n                    <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                </div>\n              </Panel>\n            )}\n\n            {!showAlignToolbar && (\n              <Panel position=\"top-center\" className=\"bg-transparent\">\n                <button\n                  onClick={() => setShowAlignToolbar(true)}\n                  className=\"p-2 bg-[#0a0f14]/95 border border-white/10 text-white/60 rounded-lg hover:bg-white/10 hover:text-white hover:border-white/20 transition-all duration-200 shadow-lg backdrop-blur-sm\"\n                  title=\"PokaÅ¼ wyrÃ³wnywanie\"\n                >\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                  </svg>\n                </button>\n              </Panel>\n            )}\n          </ReactFlow>\n          </FunnelSelectModeContext.Provider>\n          {/* Linie pomocnicze (jak w Photoshopie/Canvie) â€” widaÄ‡ przy przeciÄ…ganiu, gdy element jest na tej samej wysokoÅ›ci/poziomie co inny */}\n          {(alignmentGuides.vertical.length > 0 || alignmentGuides.horizontal.length > 0) && flowContainerSize.w > 0 && flowContainerSize.h > 0 && (\n            <div style={{ position: 'absolute', left: 0, top: 0, width: '100%', height: '100%', pointerEvents: 'none', zIndex: 10 }}>\n              <svg width=\"100%\" height=\"100%\" viewBox={`0 0 ${flowContainerSize.w} ${flowContainerSize.h}`} preserveAspectRatio=\"none\">\n                {alignmentGuides.vertical.map((x) => {\n                  const sx = x * viewport.zoom + viewport.x;\n                  return <line key={`v-${x}`} x1={sx} y1={0} x2={sx} y2={flowContainerSize.h} stroke=\"#fee715\" strokeOpacity={0.8} strokeWidth={1} />;\n                })}\n                {alignmentGuides.horizontal.map((y) => {\n                  const sy = y * viewport.zoom + viewport.y;\n                  return <line key={`h-${y}`} x1={0} y1={sy} x2={flowContainerSize.w} y2={sy} stroke=\"#fee715\" strokeOpacity={0.8} strokeWidth={1} />;\n                })}\n              </svg>\n            </div>\n          )}\n        </div>\n\n        {/* Edge Properties Panel */}\n        {showEdgeProperties && selectedEdge && (\n          <div \n            className=\"w-72 border-l border-white/10 p-4 overflow-y-auto bg-[#0a0f14]/98 nodrag nopan\"\n            onKeyDown={(e) => { if (['INPUT','TEXTAREA','SELECT'].includes((e.target as HTMLElement)?.tagName)) e.stopPropagation(); }}\n            onKeyUp={(e) => { if (['INPUT','TEXTAREA','SELECT'].includes((e.target as HTMLElement)?.tagName)) e.stopPropagation(); }}\n          >\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"font-medium text-white text-sm tracking-tight\">WÅ‚aÅ›ciwoÅ›ci linii</h3>\n              <button\n                onClick={() => {\n                  setShowEdgeProperties(false);\n                  setSelectedEdge(null);\n                }}\n                className=\"p-0.5 hover:bg-white/5 rounded text-gray-500 hover:text-gray-300 transition-colors\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div>\n                <label className=\"block text-xs font-medium text-gray-400 mb-1\">Notatki</label>\n                <textarea\n                  value={edgeProperties.notes}\n                  onChange={(e) => setEdgeProperties({ ...edgeProperties, notes: e.target.value })}\n                  className=\"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 min-h-[72px]\"\n                  placeholder=\"Notatki do linii...\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-xs font-medium text-gray-400 mb-1\">Link (opcjonalnie)</label>\n                <input\n                  type=\"url\"\n                  value={edgeProperties.link}\n                  onChange={(e) => setEdgeProperties({ ...edgeProperties, link: e.target.value })}\n                  className=\"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                  placeholder=\"https://...\"\n                />\n              </div>\n\n              {/* Customowe pola dla edge */}\n              <div className=\"pt-3 mt-3 border-t border-white/10\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <label className=\"block text-xs font-medium text-gray-400\">Dodatkowe pola</label>\n                  <button\n                    onClick={() => {\n                      setEdgeCustomFields([...edgeCustomFields, { field_name: '', field_type: 'text', field_value: '', display_order: edgeCustomFields.length }]);\n                    }}\n                    className=\"px-2 py-1 text-xs bg-white/[0.06] border border-white/20 text-white/90 rounded hover:bg-white/10 hover:border-white/30 transition-colors\"\n                  >\n                    + Dodaj pole\n                  </button>\n                </div>\n                <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                  {edgeCustomFields.map((field, index) => (\n                    <div key={index} className=\"p-2 bg-white/[0.02] border border-white/5 rounded\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <input\n                          type=\"text\"\n                          value={field.field_name}\n                          onChange={(e) => {\n                            const updated = [...edgeCustomFields];\n                            updated[index].field_name = e.target.value;\n                            setEdgeCustomFields(updated);\n                          }}\n                          placeholder=\"Nazwa pola\"\n                          className=\"flex-1 bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                        />\n                        <CustomSelect\n                          size=\"sm\"\n                          value={field.field_type}\n                          onChange={(value) => {\n                            const updated = [...edgeCustomFields];\n                            updated[index].field_type = value as 'text' | 'date' | 'number' | 'link';\n                            updated[index].field_value = ''; // Reset value przy zmianie typu\n                            setEdgeCustomFields(updated);\n                          }}\n                          options={[\n                            { value: 'text', label: 'Tekst' },\n                            { value: 'date', label: 'Data' },\n                            { value: 'number', label: 'Liczba' },\n                            { value: 'link', label: 'Link' },\n                          ]}\n                          className=\"w-24\"\n                        />\n                        <button\n                          onClick={() => {\n                            const updated = edgeCustomFields.filter((_, i) => i !== index);\n                            setEdgeCustomFields(updated);\n                          }}\n                          className=\"p-1 text-gray-400 hover:text-red-400 transition-colors\"\n                          title=\"UsuÅ„ pole\"\n                        >\n                          <Trash size={14} />\n                        </button>\n                      </div>\n                      {field.field_type === 'text' && (\n                        <input\n                          type=\"text\"\n                          value={field.field_value}\n                          onChange={(e) => {\n                            const updated = [...edgeCustomFields];\n                            updated[index].field_value = e.target.value;\n                            setEdgeCustomFields(updated);\n                          }}\n                          placeholder=\"WartoÅ›Ä‡ tekstowa\"\n                          className=\"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                        />\n                      )}\n                      {field.field_type === 'date' && (\n                        <DatePickerField\n                          value={field.field_value}\n                          onChange={(value) => {\n                            const updated = [...edgeCustomFields];\n                            updated[index].field_value = value;\n                            setEdgeCustomFields(updated);\n                          }}\n                        />\n                      )}\n                      {field.field_type === 'number' && (\n                        <div className=\"relative w-full\">\n                          <input\n                            type=\"text\"\n                            inputMode=\"numeric\"\n                            value={field.field_value}\n                            onChange={(e) => {\n                              const value = e.target.value.replace(/[^0-9.-]/g, '');\n                              const updated = [...edgeCustomFields];\n                              updated[index].field_value = value;\n                              setEdgeCustomFields(updated);\n                            }}\n                            placeholder=\"WartoÅ›Ä‡ liczbowa\"\n                            className=\"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 pr-12 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                          />\n                          <div className=\"absolute right-0.5 top-0 bottom-0 w-11 flex flex-col\">\n                            <button\n                              type=\"button\"\n                              onClick={() => {\n                                const current = parseFloat(field.field_value) || 0;\n                                const updated = [...edgeCustomFields];\n                                updated[index].field_value = String(current + 1);\n                                setEdgeCustomFields(updated);\n                              }}\n                              className=\"flex-1 flex items-center justify-center text-gray-400 hover:text-white border-b border-white/10 hover:bg-white/5 rounded-t\"\n                            >\n                              <Plus size={10} />\n                            </button>\n                            <button\n                              type=\"button\"\n                              onClick={() => {\n                                const current = parseFloat(field.field_value) || 0;\n                                const updated = [...edgeCustomFields];\n                                updated[index].field_value = String(Math.max(0, current - 1));\n                                setEdgeCustomFields(updated);\n                              }}\n                              className=\"flex-1 flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/5 rounded-b\"\n                            >\n                              <Minus size={10} />\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                      {field.field_type === 'link' && (\n                        <input\n                          type=\"url\"\n                          value={field.field_value}\n                          onChange={(e) => {\n                            const updated = [...edgeCustomFields];\n                            updated[index].field_value = e.target.value;\n                            setEdgeCustomFields(updated);\n                          }}\n                          placeholder=\"https://example.com\"\n                          className=\"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                        />\n                      )}\n                    </div>\n                  ))}\n                  {edgeCustomFields.length === 0 && (\n                    <div className=\"text-xs text-gray-500 py-2 text-center\">Brak dodatkowych pÃ³l</div>\n                  )}\n                </div>\n              </div>\n\n              <div>\n                <button\n                  onClick={() => {\n                    if (selectedEdge) {\n                      // OdwrÃ³Ä‡ kierunek strzaÅ‚ki\n                      const newSource = selectedEdge.target;\n                      const newTarget = selectedEdge.source;\n                      setEdges((eds) =>\n                        eds.map((edge) =>\n                          edge.id === selectedEdge.id\n                            ? {\n                                ...edge,\n                                source: newSource,\n                                target: newTarget,\n                              }\n                            : edge\n                        )\n                      );\n                      // Zaktualizuj selectedEdge\n                      setSelectedEdge({\n                        ...selectedEdge,\n                        source: newSource,\n                        target: newTarget,\n                      });\n                    }\n                  }}\n                  className=\"w-full px-3 py-1.5 bg-white/[0.04] border border-white/10 text-gray-300 rounded text-sm font-medium hover:bg-white/5 hover:border-[#fee715]/30 hover:text-[#fee715] transition-colors flex items-center justify-center gap-1.5\"\n                  title=\"OdwrÃ³Ä‡ kierunek strzaÅ‚ki\"\n                >\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\" />\n                  </svg>\n                  OdwrÃ³Ä‡ kierunek\n                </button>\n              </div>\n\n              <div className=\"flex gap-2 pt-3 mt-3 border-t border-white/10\">\n                <button\n                  onClick={updateEdgeProperties}\n                  className=\"relative flex-1 px-3 py-1.5 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded text-sm font-medium hover:bg-[#fee715]/15 hover:border-[#fee715]/50 transition-colors\"\n                >\n                  <span className=\"flex items-center justify-center gap-2\">\n                    Zapisz zmiany\n                    {hasUnsavedEdgeChanges && (\n                      <span className=\"w-1.5 h-1.5 bg-[#fee715] rounded-full animate-pulse\" title=\"Masz niezapisane zmiany\"></span>\n                    )}\n                  </span>\n                </button>\n                <button\n                  onClick={deleteSelectedEdge}\n                  title=\"Delete / Backspace\"\n                  className=\"px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors\"\n                >\n                  UsuÅ„\n                </button>\n              </div>\n              <p className=\"text-[11px] text-gray-500 mt-2\">Delete / Backspace â€” usuwa strzaÅ‚kÄ™.</p>\n            </div>\n          </div>\n        )}\n\n        {/* Node Properties Panel */}\n        {showPropertiesPanel && selectedNode && (\n          <div \n            className=\"w-72 border-l border-white/10 p-4 overflow-y-auto overflow-x-visible bg-[#0a0f14]/98 nodrag nopan\"\n            style={{ zIndex: 10 }}\n            onKeyDown={(e) => { if (['INPUT','TEXTAREA','SELECT'].includes((e.target as HTMLElement)?.tagName)) e.stopPropagation(); }}\n            onKeyUp={(e) => { if (['INPUT','TEXTAREA','SELECT'].includes((e.target as HTMLElement)?.tagName)) e.stopPropagation(); }}\n          >\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"font-medium text-white text-sm tracking-tight\">\n                {selectedNode.type === 'text' ? 'WÅ‚aÅ›ciwoÅ›ci tekstu' : 'WÅ‚aÅ›ciwoÅ›ci'}\n              </h3>\n              <button\n                onClick={() => {\n                  setShowPropertiesPanel(false);\n                  setSelectedNode(null);\n                }}\n                className=\"p-0.5 hover:bg-white/5 rounded text-gray-500 hover:text-gray-300 transition-colors\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n\n            {selectedNode.type === 'text' ? (\n              <div className=\"space-y-3\">\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">Tekst</label>\n                  <textarea\n                    value={textNodeProperties.text}\n                    onChange={(e) => setTextNodeProperties({ ...textNodeProperties, text: e.target.value })}\n                    className=\"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 min-h-[72px]\"\n                    placeholder=\"Wpisz tekst...\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">Rozmiar czcionki</label>\n                  <input\n                    type=\"number\"\n                    min=\"10\"\n                    max=\"72\"\n                    value={textNodeProperties.fontSize}\n                    onChange={(e) => setTextNodeProperties({ ...textNodeProperties, fontSize: parseInt(e.target.value) || 18 })}\n                    className=\"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">Waga czcionki</label>\n                  <CustomSelect\n                    size=\"sm\"\n                    value={textNodeProperties.fontWeight || 'bold'}\n                    onChange={(value) => setTextNodeProperties({ ...textNodeProperties, fontWeight: value as 'normal' | 'bold' | 'semibold' })}\n                    options={[\n                      { value: 'normal', label: 'Normal' },\n                      { value: 'semibold', label: 'Semibold' },\n                      { value: 'bold', label: 'Bold' },\n                    ]}\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">WyrÃ³wnanie poziome</label>\n                  <CustomSelect\n                    size=\"sm\"\n                    value={textNodeProperties.textAlign || 'left'}\n                    onChange={(value) => setTextNodeProperties({ ...textNodeProperties, textAlign: value as 'left' | 'center' | 'right' })}\n                    options={[\n                      { value: 'left', label: 'Lewo' },\n                      { value: 'center', label: 'Åšrodek' },\n                      { value: 'right', label: 'Prawo' },\n                    ]}\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">WyrÃ³wnanie pionowe</label>\n                  <CustomSelect\n                    size=\"sm\"\n                    value={textNodeProperties.verticalAlign || 'middle'}\n                    onChange={(value) => setTextNodeProperties({ ...textNodeProperties, verticalAlign: value as 'top' | 'middle' | 'bottom' })}\n                    options={[\n                      { value: 'top', label: 'GÃ³ra' },\n                      { value: 'middle', label: 'Åšrodek' },\n                      { value: 'bottom', label: 'DÃ³Å‚' },\n                    ]}\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div className=\"pt-0.5\">\n                  <CustomCheckbox\n                    id=\"showHandles\"\n                    checked={textNodeProperties.showHandles ?? false}\n                    onChange={(v) => setTextNodeProperties({ ...textNodeProperties, showHandles: v })}\n                    label=\"Punkty poÅ‚Ä…czenia\"\n                    size=\"sm\"\n                    labelClassName=\"text-xs font-medium text-gray-400\"\n                  />\n                </div>\n\n                <div className=\"flex gap-2 pt-3 mt-3 border-t border-white/10\">\n                  <button\n                    onClick={updateNodeProperties}\n                    className=\"relative flex-1 px-3 py-1.5 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded text-sm font-medium hover:bg-[#fee715]/15 hover:border-[#fee715]/50 transition-colors\"\n                  >\n                    <span className=\"flex items-center justify-center gap-2\">\n                      Zapisz zmiany\n                      {hasUnsavedTextNodeChanges && (\n                        <span className=\"w-1.5 h-1.5 bg-[#fee715] rounded-full animate-pulse\" title=\"Masz niezapisane zmiany\"></span>\n                      )}\n                    </span>\n                  </button>\n                  <button\n                    onClick={deleteSelectedNode}\n                    className=\"px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors\"\n                  >\n                    UsuÅ„\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">Nazwa</label>\n                  <input\n                    type=\"text\"\n                    value={nodeProperties.label}\n                    onChange={(e) => setNodeProperties({ ...nodeProperties, label: e.target.value })}\n                    className=\"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                    placeholder=\"Nazwa elementu\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">Ikona</label>\n                  <IconPicker\n                    value={nodeProperties.icon}\n                    onChange={(iconName) => setNodeProperties({ ...nodeProperties, icon: iconName })}\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">Notatki</label>\n                  <textarea\n                    value={nodeProperties.notes}\n                    onChange={(e) => setNodeProperties({ ...nodeProperties, notes: e.target.value })}\n                    className=\"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 min-h-[72px]\"\n                    placeholder=\"Notatki (np. CPC: 2 PLN)\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-400 mb-1\">Link</label>\n                  <input\n                    type=\"url\"\n                    value={nodeProperties.link || ''}\n                    onChange={(e) => setNodeProperties({ ...nodeProperties, link: e.target.value })}\n                    className=\"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                    placeholder=\"https://example.com\"\n                  />\n                </div>\n\n                {/* Customowe pola */}\n                <div className=\"pt-3 mt-3 border-t border-white/10\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <label className=\"block text-xs font-medium text-gray-400\">Dodatkowe pola</label>\n                    <button\n                      onClick={() => {\n                        setNodeCustomFields([...nodeCustomFields, { field_name: '', field_type: 'text', field_value: '', display_order: nodeCustomFields.length }]);\n                      }}\n                      className=\"px-2 py-1 text-xs bg-white/[0.06] border border-white/20 text-white/90 rounded hover:bg-white/10 hover:border-white/30 transition-colors\"\n                    >\n                      + Dodaj pole\n                    </button>\n                  </div>\n                  <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                    {nodeCustomFields.map((field, index) => (\n                      <div key={index} className=\"p-2 bg-white/[0.02] border border-white/5 rounded\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <input\n                            type=\"text\"\n                            value={field.field_name}\n                            onChange={(e) => {\n                              const updated = [...nodeCustomFields];\n                              updated[index].field_name = e.target.value;\n                              setNodeCustomFields(updated);\n                            }}\n                            placeholder=\"Nazwa pola\"\n                            className=\"flex-1 bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                          />\n                          <CustomSelect\n                            size=\"sm\"\n                            value={field.field_type}\n                            onChange={(value) => {\n                              const updated = [...nodeCustomFields];\n                              updated[index].field_type = value as 'text' | 'date' | 'number' | 'link';\n                              updated[index].field_value = ''; // Reset value przy zmianie typu\n                              setNodeCustomFields(updated);\n                            }}\n                            options={[\n                              { value: 'text', label: 'Tekst' },\n                              { value: 'date', label: 'Data' },\n                              { value: 'number', label: 'Liczba' },\n                              { value: 'link', label: 'Link' },\n                            ]}\n                            className=\"w-24\"\n                          />\n                        </div>\n                        {field.field_type === 'text' && (\n                          <input\n                            type=\"text\"\n                            value={field.field_value}\n                            onChange={(e) => {\n                              const updated = [...nodeCustomFields];\n                              updated[index].field_value = e.target.value;\n                              setNodeCustomFields(updated);\n                            }}\n                            placeholder=\"WartoÅ›Ä‡ tekstowa\"\n                            className=\"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                          />\n                        )}\n                        {field.field_type === 'date' && (\n                          <DatePickerField\n                            value={field.field_value}\n                            onChange={(value) => {\n                              const updated = [...nodeCustomFields];\n                              updated[index].field_value = value;\n                              setNodeCustomFields(updated);\n                            }}\n                          />\n                        )}\n                        {field.field_type === 'number' && (\n                          <div className=\"relative w-full\">\n                            <input\n                              type=\"text\"\n                              inputMode=\"numeric\"\n                              value={field.field_value}\n                              onChange={(e) => {\n                                const value = e.target.value.replace(/[^0-9.-]/g, '');\n                                const updated = [...nodeCustomFields];\n                                updated[index].field_value = value;\n                                setNodeCustomFields(updated);\n                              }}\n                              placeholder=\"WartoÅ›Ä‡ liczbowa\"\n                              className=\"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 pr-12 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                            />\n                            <div className=\"absolute right-0.5 top-0 bottom-0 w-11 flex flex-col\">\n                              <button\n                                type=\"button\"\n                                onClick={() => {\n                                  const currentValue = parseFloat(field.field_value) || 0;\n                                  const updated = [...nodeCustomFields];\n                                  updated[index].field_value = String(currentValue + 1);\n                                  setNodeCustomFields(updated);\n                                }}\n                                className=\"flex-1 px-1 bg-white/[0.08] hover:bg-white/[0.15] border-l border-white/20 rounded-tl text-white/70 hover:text-white transition-colors flex items-center justify-center\"\n                                title=\"ZwiÄ™ksz\"\n                              >\n                                <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n                                </svg>\n                              </button>\n                              <div className=\"h-px bg-white/20\"></div>\n                              <button\n                                type=\"button\"\n                                onClick={() => {\n                                  const currentValue = parseFloat(field.field_value) || 0;\n                                  const updated = [...nodeCustomFields];\n                                  updated[index].field_value = String(Math.max(0, currentValue - 1));\n                                  setNodeCustomFields(updated);\n                                }}\n                                className=\"flex-1 px-1 bg-white/[0.08] hover:bg-white/[0.15] border-l border-white/20 rounded-bl text-white/70 hover:text-white transition-colors flex items-center justify-center\"\n                                title=\"Zmniejsz\"\n                              >\n                                <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                                </svg>\n                              </button>\n                            </div>\n                          </div>\n                        )}\n                        {field.field_type === 'link' && (\n                          <input\n                            type=\"url\"\n                            value={field.field_value}\n                            onChange={(e) => {\n                              const updated = [...nodeCustomFields];\n                              updated[index].field_value = e.target.value;\n                              setNodeCustomFields(updated);\n                            }}\n                            placeholder=\"https://example.com\"\n                            className=\"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30\"\n                          />\n                        )}\n                        <div className=\"flex justify-end mt-2\">\n                          <button\n                            onClick={() => {\n                              setNodeCustomFields(nodeCustomFields.filter((_, i) => i !== index));\n                            }}\n                            className=\"px-2 py-1 text-xs text-gray-400 hover:text-red-400 transition-colors flex items-center gap-1\"\n                            title=\"UsuÅ„ pole\"\n                          >\n                            <Trash size={14} weight=\"regular\" />\n                            <span>UsuÅ„</span>\n                          </button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Zapisz jako szablon */}\n                <div className=\"pt-3 mt-3 border-t border-white/10\">\n                  <label className=\"block text-xs font-medium text-gray-400 mb-2\">Zapisz jako wÅ‚asny szablon</label>\n                  <div className=\"space-y-2\">\n                    <CustomSelect\n                      size=\"sm\"\n                      value={nodeProperties.category || 'DziaÅ‚ania'}\n                      onChange={(value) => setNodeProperties({ ...nodeProperties, category: value })}\n                      options={[\n                        { value: 'Å¹rÃ³dÅ‚a Ruchu', label: 'Å¹rÃ³dÅ‚a Ruchu' },\n                        { value: 'Typ Strony', label: 'Typ Strony' },\n                        { value: 'DziaÅ‚ania', label: 'DziaÅ‚ania' },\n                        { value: 'Cel/Konwersja', label: 'Cel/Konwersja' },\n                        { value: 'NarzÄ™dzia', label: 'NarzÄ™dzia' },\n                      ]}\n                      className=\"w-full\"\n                    />\n                    <button\n                      onClick={async () => {\n                        if (!nodeProperties.label || !nodeProperties.icon) {\n                          setAlertModal({\n                            isOpen: true,\n                            title: 'BÅ‚Ä…d',\n                            message: 'WypeÅ‚nij nazwÄ™ i wybierz ikonÄ™ przed zapisaniem szablonu.',\n                            type: 'error',\n                          });\n                          return;\n                        }\n                        const nodeColor = (selectedNode?.data?.color as string) || '#fee715';\n                        await saveCustomTemplate(\n                          nodeProperties.label,\n                          nodeProperties.icon,\n                          nodeColor,\n                          nodeProperties.category || 'DziaÅ‚ania'\n                        );\n                      }}\n                      className=\"w-full px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors\"\n                    >\n                      Zapisz jako szablon\n                    </button>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-2 pt-3 mt-3 border-t border-white/10\">\n                  <button\n                    onClick={updateNodeProperties}\n                    className=\"relative flex-1 px-3 py-1.5 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded text-sm font-medium hover:bg-[#fee715]/15 hover:border-[#fee715]/50 transition-colors\"\n                  >\n                    <span className=\"flex items-center justify-center gap-2\">\n                      Zapisz zmiany\n                      {hasUnsavedNodeChanges && (\n                        <span className=\"w-1.5 h-1.5 bg-[#fee715] rounded-full animate-pulse\" title=\"Masz niezapisane zmiany\"></span>\n                      )}\n                    </span>\n                  </button>\n                  <button\n                    onClick={deleteSelectedNode}\n                    className=\"px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors\"\n                  >\n                    UsuÅ„\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      <AlertModal\n        isOpen={alertModal.isOpen}\n        title={alertModal.title}\n        message={alertModal.message}\n        type={alertModal.type}\n        onClose={() => setAlertModal(prev => ({ ...prev, isOpen: false }))}\n      />\n\n      {/* System komentarzy */}\n      {showCommentPanel && id && (\n        <CommentPanel\n          funnelId={id}\n          isOpen={showCommentPanel}\n          onClose={() => {\n            setShowCommentPanel(false);\n            setSelectedThreadId(null);\n          }}\n          onJumpToAnchor={(anchorType, anchorId, regionCoords) => {\n            if (anchorType === 'node' && anchorId) {\n              const node = nodes.find(n => n.id === anchorId);\n              if (node && reactFlowInstance) {\n                reactFlowInstance.setCenter(node.position.x, node.position.y, { zoom: 1, duration: 500 });\n                setSelectedNode(node);\n                setShowPropertiesPanel(true);\n              }\n            } else if (anchorType === 'edge' && anchorId) {\n              const edge = edges.find(e => e.id === anchorId);\n              if (edge && reactFlowInstance) {\n                const sourceNode = nodes.find(n => n.id === edge.source);\n                if (sourceNode) {\n                  reactFlowInstance.setCenter(sourceNode.position.x, sourceNode.position.y, { zoom: 1, duration: 500 });\n                  setSelectedEdge(edge);\n                  setShowEdgeProperties(true);\n                }\n              }\n            } else if (anchorType === 'region' && regionCoords) {\n              if (reactFlowInstance) {\n                reactFlowInstance.setCenter(regionCoords.x, regionCoords.y, { zoom: 1, duration: 500 });\n              }\n            }\n          }}\n          onThreadClick={(threadId) => {\n            setSelectedThreadId(threadId);\n          }}\n        />\n      )}\n\n      {selectedThreadId && id && (\n        <CommentThread\n          threadId={selectedThreadId}\n          funnelId={id}\n          onClose={() => {\n            setSelectedThreadId(null);\n            loadCommentCounts();\n          }}\n          onUpdate={() => {\n            loadCommentCounts();\n          }}\n        />\n      )}\n\n      {commentFormAnchor && id && (\n        <CommentForm\n          funnelId={id}\n          anchorType={commentFormAnchor.type}\n          anchorId={commentFormAnchor.id}\n          regionCoords={commentFormAnchor.coords}\n          onClose={() => {\n            setCommentFormAnchor(null);\n          }}\n          onSuccess={() => {\n            setCommentFormAnchor(null);\n            loadCommentCounts();\n            // WymuÅ› odÅ›wieÅ¼enie panelu komentarzy\n            setCommentPanelRefreshTrigger(prev => prev + 1);\n            if (!showCommentPanel) {\n              setShowCommentPanel(true);\n            }\n          }}\n        />\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OA2BA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,MAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,MAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAA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"}