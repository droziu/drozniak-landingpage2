(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63790,e=>{"use strict";var t=e.i(29883),r=e.i(45366),o=e.i(20400),i=e.i(94448),a=e.i(16990),n=e.i(23757),s=e.i(7495),l=e.i(55041),d=e.i(23448),c=e.i(49404),u=e.i(60564),h=e.i(50187),m=e.i(43262),p=e.i(59890),x=e.i(14395),f=e.i(30236),g=e.i(17228),b=e.i(46885),w=e.i(50764),y=e.i(40012),v=e.i(99216),j=e.i(65328),k=e.i(34286),N=e.i(94342),C=e.i(72632),z=e.i(52376),S=e.i(33183),_=e.i(21620),M=e.i(79936),L=e.i(84134),P=e.i(24408),T=e.i(36191),D=e.i(13),E=e.i(2870),A=e.i(266),B=e.i(44836),O=e.i(16877),W=e.i(77999),F=e.i(16695),R=e.i(76716),I=e.i(30539),J=e.i(25715),K=e.i(90410),$=e.i(40809),H=e.i(89863),U=e.i(5263),q=e.i(76603),G=e.i(62012),V=e.i(52422),Z=e.i(7500),X=e.i(90094),Y=e.i(52358),Q=e.i(21397),ee=e.i(25267),et=e.i(23866),er=e.i(14428),eo=e.i(96319),ei=e.i(45),ea=e.i(89957),en=e.i(8492),es=e.i(13045),el=e.i(15718),ed=e.i(47140),ec=e.i(64808),eu=e.i(66443),eh=e.i(39025),em=e.i(65788),ep=e.i(56542),ex=e.i(16522),ef=e.i(56800),eg=e.i(93771),eb=e.i(20185),ew=e.i(88478),ey=e.i(86901),ev=e.i(49077),ej=e.i(44772),ek=e.i(66725),eN=e.i(4698),eC=e.i(88324),ez=e.i(46530),eS=e.i(85961),e_=e.i(96888),eM=e.i(75890),eL=e.i(84125);let eP=(0,r.createContext)({isSelectMode:!1,onLongPressDeselect:()=>{}}),eT={"ðŸ“¢":"MegaphoneSimple","ðŸ”":"MagnifyingGlass","ðŸ“§":"Envelope","ðŸ“±":"DeviceMobile","âš™ï¸":"Gear","ðŸŒ":"Globe","ðŸ“„":"FileText","ðŸ’³":"CreditCard","âœ…":"CheckCircle","ðŸ“":"Notebook","ðŸ“Š":"PresentationChart","ðŸ’¬":"ChatCircle","ðŸ“ž":"Phone"},eD=(e,r=24,o="")=>{if(e.startsWith("simple:"))return((e,r=24,o="")=>{try{let i=n[`si${e.charAt(0).toUpperCase()+e.slice(1)}`];if(!i||!i.path)return null;return(0,t.jsx)("svg",{role:"img",viewBox:"0 0 24 24",width:r,height:r,className:o,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{d:i.path})})}catch(e){return null}})(e.replace("simple:",""),r,o);let i={size:r,weight:"regular",className:o,color:"currentColor"};switch(eT[e]||e){case"MegaphoneSimple":return(0,t.jsx)(w.MegaphoneSimple,{...i});case"MagnifyingGlass":return(0,t.jsx)(y.MagnifyingGlass,{...i});case"Envelope":return(0,t.jsx)(v.Envelope,{...i});case"DeviceMobile":return(0,t.jsx)(j.DeviceMobile,{...i});case"Globe":return(0,t.jsx)(k.Globe,{...i});case"FileText":default:return(0,t.jsx)(N.FileText,{...i});case"CreditCard":return(0,t.jsx)(C.CreditCard,{...i});case"CheckCircle":return(0,t.jsx)(z.CheckCircle,{...i});case"Notebook":return(0,t.jsx)(S.Notebook,{...i});case"PresentationChart":return(0,t.jsx)(_.PresentationChart,{...i});case"ChatCircle":return(0,t.jsx)(M.ChatCircle,{...i});case"Phone":return(0,t.jsx)(L.Phone,{...i});case"Gear":return(0,t.jsx)(P.Gear,{...i});case"DotsThree":return(0,t.jsx)(T.DotsThree,{...i});case"Money":return(0,t.jsx)(D.Money,{...i});case"Wallet":return(0,t.jsx)(E.Wallet,{...i});case"ShoppingCart":return(0,t.jsx)(A.ShoppingCart,{...i});case"Tag":return(0,t.jsx)(B.Tag,{...i});case"CurrencyDollar":return(0,t.jsx)(O.CurrencyDollar,{...i});case"Storefront":return(0,t.jsx)(W.Storefront,{...i});case"TrendUp":return(0,t.jsx)(F.TrendUp,{...i});case"TrendDown":return(0,t.jsx)(R.TrendDown,{...i});case"ChartLine":return(0,t.jsx)(I.ChartLine,{...i});case"Users":return(0,t.jsx)(J.Users,{...i});case"User":return(0,t.jsx)(K.User,{...i});case"Calendar":return(0,t.jsx)($.Calendar,{...i});case"Clock":return(0,t.jsx)(H.Clock,{...i});case"PaperPlaneTilt":return(0,t.jsx)(U.PaperPlaneTilt,{...i});case"VideoCamera":return(0,t.jsx)(q.VideoCamera,{...i});case"Camera":return(0,t.jsx)(G.Camera,{...i});case"Image":return(0,t.jsx)(V.Image,{...i});case"Link":return(0,t.jsx)(Z.Link,{...i});case"Share":return(0,t.jsx)(X.Share,{...i});case"Heart":return(0,t.jsx)(Y.Heart,{...i});case"Star":return(0,t.jsx)(Q.Star,{...i});case"Bell":return(0,t.jsx)(ee.Bell,{...i});case"Warning":return(0,t.jsx)(et.Warning,{...i});case"Info":return(0,t.jsx)(er.Info,{...i});case"Question":return(0,t.jsx)(eo.Question,{...i});case"Check":return(0,t.jsx)(ei.Check,{...i});case"X":return(0,t.jsx)(ea.X,{...i});case"Plus":return(0,t.jsx)(en.Plus,{...i});case"Minus":return(0,t.jsx)(es.Minus,{...i});case"ArrowRight":return(0,t.jsx)(el.ArrowRight,{...i});case"ArrowLeft":return(0,t.jsx)(ed.ArrowLeft,{...i});case"ArrowUp":return(0,t.jsx)(ec.ArrowUp,{...i});case"ArrowDown":return(0,t.jsx)(eu.ArrowDown,{...i});case"Download":return(0,t.jsx)(eh.Download,{...i});case"Upload":return(0,t.jsx)(em.Upload,{...i});case"Eye":return(0,t.jsx)(ep.Eye,{...i});case"EyeSlash":return(0,t.jsx)(ex.EyeSlash,{...i});case"Lock":return(0,t.jsx)(ef.Lock,{...i});case"LockOpen":return(0,t.jsx)(eg.LockOpen,{...i});case"Key":return(0,t.jsx)(eb.Key,{...i});case"Shield":return(0,t.jsx)(ew.Shield,{...i});case"Trash":return(0,t.jsx)(ey.Trash,{...i});case"Pencil":return(0,t.jsx)(ev.Pencil,{...i});case"Copy":return(0,t.jsx)(ej.Copy,{...i});case"Clipboard":return(0,t.jsx)(ek.Clipboard,{...i});case"Folder":return(0,t.jsx)(eN.Folder,{...i});case"Database":return(0,t.jsx)(eC.Database,{...i});case"Cloud":return(0,t.jsx)(ez.Cloud,{...i});case"WifiHigh":return(0,t.jsx)(eS.WifiHigh,{...i});case"Broadcast":return(0,t.jsx)(e_.Broadcast,{...i})}},eE={custom:({id:e,data:r,selected:o})=>(0,t.jsxs)("div",{className:`px-5 py-4 rounded-xl border-2 transition-all duration-200 min-w-[120px] relative group ${o?"border-[#fee715] shadow-lg shadow-[#fee715]/30 bg-[#18232F]":"border-[#fee715]/20 bg-[#0a0f14] hover:border-[#fee715]/50 hover:bg-[#18232F]"}`,style:{boxShadow:o?"0 0 20px rgba(254, 231, 21, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.1)"},children:[void 0!==r.commentCount&&r.commentCount>0&&(0,t.jsx)(b.CommentBadge,{count:r.commentCount,status:("closed"===r.commentStatus?"neutral":r.commentStatus)||"neutral",onClick:()=>{}}),(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Top,id:"top",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{top:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"}),(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Bottom,id:"bottom",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{bottom:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"}),(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Left,id:"left",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{left:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"}),(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Right,id:"right",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{right:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{backgroundColor:r.color||"#fee71520",color:"#101820"},children:eD(r.icon,20)}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("div",{className:"text-sm font-medium text-white leading-tight",children:r.label})})]}),r.notes&&(0,t.jsx)("div",{className:"text-xs text-gray-400 mt-1 line-clamp-1",children:r.notes}),r.link&&(0,t.jsxs)("div",{className:"text-xs text-[#fee715] mt-1 line-clamp-1 flex items-center gap-1",children:[(0,t.jsx)(Z.Link,{size:12,weight:"bold"}),(0,t.jsx)("a",{href:r.link,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",onClick:e=>e.stopPropagation(),children:r.link.length>30?r.link.substring(0,30)+"...":r.link})]}),r.customFields&&r.customFields.length>0&&(0,t.jsx)("div",{className:"mt-2 pt-2 border-t border-white/5 space-y-1",children:r.customFields.map((e,r)=>(0,t.jsxs)("div",{className:"text-xs text-gray-400 flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"text-gray-500 font-medium",children:[e.field_name,":"]}),"link"===e.field_type?(0,t.jsx)("a",{href:e.field_value,target:"_blank",rel:"noopener noreferrer",className:"text-[#fee715] hover:underline line-clamp-1",onClick:e=>e.stopPropagation(),children:e.field_value.length>25?e.field_value.substring(0,25)+"...":e.field_value}):"date"===e.field_type?(0,t.jsx)("span",{children:e.field_value?new Date(e.field_value).toLocaleDateString("pl-PL"):"-"}):(0,t.jsx)("span",{className:"line-clamp-1",children:e.field_value||"-"})]},r))})]}),text:({id:e,data:r,selected:o,width:n,height:s})=>{let l=n||r.width||250,d=s||r.height||100;return(0,t.jsxs)("div",{className:`px-8 py-5 rounded-xl border-2 transition-all duration-200 relative group ${o?"border-[#fee715] shadow-lg shadow-[#fee715]/30 bg-[#18232F]":"border-[#fee715]/20 bg-[#0a0f14] hover:border-[#fee715]/50 hover:bg-[#18232F]"}`,style:{boxShadow:o?"0 0 20px rgba(254, 231, 21, 0.3)":"0 4px 6px rgba(0, 0, 0, 0.1)",width:l,height:d,minWidth:150,minHeight:60},children:[void 0!==r.commentCount&&r.commentCount>0&&(0,t.jsx)(b.CommentBadge,{count:r.commentCount,status:("closed"===r.commentStatus?"neutral":r.commentStatus)||"neutral",onClick:()=>{}}),r.showHandles&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Top,id:"top",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{top:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"}),(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Bottom,id:"bottom",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{bottom:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"}),(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Left,id:"left",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{left:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"}),(0,t.jsx)(i.Handle,{type:"source",position:a.Position.Right,id:"right",className:"!w-5 !h-5 !min-w-5 !min-h-5 bg-[#fee715] border-2 border-[#101820] hover:!w-6 hover:!h-6 transition-all cursor-crosshair z-10 opacity-0 group-hover:opacity-100",style:{right:-10},title:"PrzeciÄ…gnij do kropki na drugim panelu"})]}),(0,t.jsx)(i.NodeResizer,{color:"#fee715",isVisible:o,minWidth:150,minHeight:60,handleStyle:{backgroundColor:"#fee715",border:"2px solid #101820",borderRadius:"4px",width:"10px",height:"10px"}}),(0,t.jsx)("div",{className:"text-white break-words h-full w-full flex",style:{fontSize:r.fontSize||16,fontWeight:r.fontWeight||"normal",textAlign:r.textAlign||"left",justifyContent:"center"===r.textAlign?"center":"right"===r.textAlign?"flex-end":"flex-start",alignItems:"top"===r.verticalAlign?"flex-start":"bottom"===r.verticalAlign?"flex-end":"center",padding:"8px"},children:r.text||"Kliknij, aby edytowaÄ‡"})]})}},eA={custom:({id:e,sourceX:o,sourceY:n,targetX:s,targetY:l,sourcePosition:d,targetPosition:c,data:u,style:h,markerEnd:m})=>{let[p,x,f]=(0,a.getSmoothStepPath)({sourceX:o,sourceY:n,sourcePosition:d,targetX:s,targetY:l,targetPosition:c,borderRadius:20}),g=r.default.useRef(null);r.default.useEffect(()=>{if(g.current)return;let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d",p),g.current=e},[p]);let[w,y]=r.default.useState(0),v=r.default.useRef(null);r.default.useEffect(()=>{if(!u?.notes||!v.current||!g.current)return;let e=setTimeout(()=>{let e=v.current;if(!e)return;let t=e.getBoundingClientRect(),r=document.querySelectorAll("[data-edge-label]"),o=!1;for(let i of r){if(i===e)continue;let r=i.getBoundingClientRect(),a=!(t.right+15<r.left||t.left-15>r.right),n=!(t.bottom+15<r.top||t.top-15>r.bottom);if(a&&n){o=!0;break}}if(o&&g.current)try{let o=g.current.getTotalLength(),i=o/2,a=.25*o,n=0;for(let o=30;o<=a;o+=30){let a=g.current.getPointAtLength(i-o),s={left:a.x-t.width/2,right:a.x+t.width/2,top:a.y-t.height/2,bottom:a.y+t.height/2},l=!1;for(let t of r){if(t===e)continue;let r=t.getBoundingClientRect(),o=!(s.right+15<r.left||s.left-15>r.right),i=!(s.bottom+15<r.top||s.top-15>r.bottom);if(o&&i){l=!0;break}}if(!l){n=-o;break}let d=g.current.getPointAtLength(i+o),c={left:d.x-t.width/2,right:d.x+t.width/2,top:d.y-t.height/2,bottom:d.y+t.height/2},u=!1;for(let t of r){if(t===e)continue;let r=t.getBoundingClientRect(),o=!(c.right+15<r.left||c.left-15>r.right),i=!(c.bottom+15<r.top||c.top-15>r.bottom);if(o&&i){u=!0;break}}if(!u){n=o;break}}y(n)}catch(e){}else y(0)},150);return()=>clearTimeout(e)},[u?.notes,p,x,f]);let j=r.default.useMemo(()=>{if(0===w||!g.current)return{x:x,y:f};try{let e=g.current.getTotalLength(),t=g.current.getPointAtLength(e/2+w);return{x:t.x,y:t.y}}catch(e){return{x:x,y:f}}},[x,f,w]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.BaseEdge,{id:e,path:p,style:h,markerEnd:m,markerStart:void 0}),u?.commentCount!==void 0&&u.commentCount>0&&(0,t.jsx)(i.EdgeLabelRenderer,{children:(0,t.jsx)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${x}px,${f-20}px)`},className:"nodrag nopan",children:(0,t.jsx)(b.CommentBadge,{count:u.commentCount,status:("closed"===u.commentStatus?"neutral":u.commentStatus)||"neutral",onClick:()=>{}})})}),u?.notes&&(0,t.jsx)(i.EdgeLabelRenderer,{children:(0,t.jsx)("div",{ref:v,"data-edge-label":e,style:{position:"absolute",transform:`translate(-50%, -50%) translate(${j.x}px,${j.y}px)`},className:"nodrag nopan",children:(0,t.jsxs)("div",{className:"px-2 py-1 bg-[#fee715] text-[#101820] text-xs font-semibold rounded shadow-lg border-2 border-[#101820] max-w-[200px] break-words whitespace-normal leading-tight",children:[u.notes,u?.link&&(0,t.jsx)("a",{href:u.link,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"block mt-1 text-[#101820] underline hover:text-blue-600",children:"ðŸ”— Link"})]})})})]})}},eB=[{type:"text",icon:"FileText",label:"Tekst",category:"NarzÄ™dzia"},{type:"custom",icon:"simple:facebook",label:"Facebook Ads",color:"#1877F2",category:"Å¹rÃ³dÅ‚a Ruchu"},{type:"custom",icon:"simple:google",label:"Google Ads",color:"#4285F4",category:"Å¹rÃ³dÅ‚a Ruchu"},{type:"custom",icon:"Envelope",label:"Email",color:"#EA4335",category:"Å¹rÃ³dÅ‚a Ruchu"},{type:"custom",icon:"simple:instagram",label:"Instagram",color:"#E4405F",category:"Å¹rÃ³dÅ‚a Ruchu"},{type:"custom",icon:"simple:youtube",label:"Youtube",color:"#FF0000",category:"Å¹rÃ³dÅ‚a Ruchu"},{type:"custom",icon:"Gear",label:"Inne",color:"#fee715",category:"Å¹rÃ³dÅ‚a Ruchu",isCustom:!0},{type:"custom",icon:"Globe",label:"Landing",color:"#00C9A7",category:"Typ Strony"},{type:"custom",icon:"FileText",label:"Sales page",color:"#00C9A7",category:"Typ Strony"},{type:"custom",icon:"CreditCard",label:"Checkout",color:"#00C9A7",category:"Typ Strony"},{type:"custom",icon:"CheckCircle",label:"Thank you",color:"#00C9A7",category:"Typ Strony"},{type:"custom",icon:"Gear",label:"Inne",color:"#00C9A7",category:"Typ Strony",isCustom:!0},{type:"custom",icon:"Notebook",label:"Ebook",color:"#fee715",category:"DziaÅ‚ania"},{type:"custom",icon:"Phone",label:"Rozmowa",color:"#fee715",category:"DziaÅ‚ania"},{type:"custom",icon:"FileText",label:"Formularz",color:"#fee715",category:"DziaÅ‚ania"},{type:"custom",icon:"PresentationChart",label:"Webinar",color:"#fee715",category:"DziaÅ‚ania"},{type:"custom",icon:"Gear",label:"Inne",color:"#fee715",category:"DziaÅ‚ania",isCustom:!0},{type:"custom",icon:"CheckCircle",label:"Lead",color:"#10B981",category:"Cel/Konwersja"},{type:"custom",icon:"Calendar",label:"Rezerwacja",color:"#10B981",category:"Cel/Konwersja"},{type:"custom",icon:"Phone",label:"Telefon",color:"#10B981",category:"Cel/Konwersja"},{type:"custom",icon:"CurrencyDollar",label:"SprzedaÅ¼",color:"#10B981",category:"Cel/Konwersja"},{type:"custom",icon:"Gear",label:"Inne",color:"#10B981",category:"Cel/Konwersja",isCustom:!0}],eO=({value:e,onChange:i})=>{let[a,n]=(0,r.useState)(!1),s=(0,r.useRef)(null),l=(0,r.useRef)(null),[d,c]=(0,r.useState)({}),u=e=>{let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${o}`},h=(()=>{let t=e?new Date(e+"T00:00:00"):new Date,r=t.getFullYear(),o=t.getMonth(),i=new Date(r,o,1),a=new Date(r,o+1,0).getDate(),n=0===i.getDay()?6:i.getDay()-1,s=[],l=new Date(r,o,0).getDate();for(let e=n-1;e>=0;e--)s.push({day:l-e,isCurrentMonth:!1,date:new Date(r,o-1,l-e)});for(let e=1;e<=a;e++)s.push({day:e,isCurrentMonth:!0,date:new Date(r,o,e)});let d=42-s.length;for(let e=1;e<=d;e++)s.push({day:e,isCurrentMonth:!1,date:new Date(r,o+1,e)});return{days:s,year:r,month:o}})(),m=e=>{i(u(e)),n(!1)},p=t=>{let r=e?new Date(e+"T00:00:00"):new Date;i(u(new Date(r.getFullYear(),r.getMonth()+t,1)))};return(0,r.useEffect)(()=>{if(!a)return;let e=()=>{let e=s.current,t=l.current;if(!e||!t)return;let r=e.getBoundingClientRect(),o=t.getBoundingClientRect(),i=r.bottom+8;i+o.height>window.innerHeight-12&&(i=r.top-o.height-8),i=Math.max(12,Math.min(i,window.innerHeight-o.height-12));let a=r.left;a+280>window.innerWidth-12&&(a=window.innerWidth-280-12),a<12&&(a=12),c({position:"fixed",zIndex:99999,top:`${i}px`,left:`${a}px`,width:"280px"})},t=requestAnimationFrame(e);return window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),()=>{cancelAnimationFrame(t),window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",e)}},[a]),(0,r.useEffect)(()=>{let e=e=>{let t=e.target;a&&t&&s.current&&!s.current.contains(t)&&l.current&&!l.current.contains(t)&&n(!1)};return a&&(document.addEventListener("mousedown",e),document.addEventListener("keydown",e=>{"Escape"===e.key&&n(!1)})),()=>{document.removeEventListener("mousedown",e)}},[a]),(0,t.jsxs)("div",{className:"relative",ref:s,children:[(0,t.jsxs)("button",{type:"button",onClick:()=>n(!a),className:"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 flex items-center justify-between",children:[(0,t.jsx)("span",{className:e?"text-white":"text-gray-500",children:e?new Date(e+"T00:00:00").toLocaleDateString("pl-PL",{day:"2-digit",month:"2-digit",year:"numeric"}):"dd.mm.rrrr"}),(0,t.jsx)("svg",{className:"w-4 h-4 text-white flex-shrink-0 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})]}),a&&(0,o.createPortal)((0,t.jsxs)("div",{ref:l,className:"fixed bg-[#18232F] border border-white/15 rounded-lg shadow-xl p-4",style:Object.keys(d).length?d:{zIndex:99999},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>p(-1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,t.jsxs)("h3",{className:"text-white text-sm font-medium",children:[["StyczeÅ„","Luty","Marzec","KwiecieÅ„","Maj","Czerwiec","Lipiec","SierpieÅ„","WrzesieÅ„","PaÅºdziernik","Listopad","GrudzieÅ„"][h.month]," ",h.year]}),(0,t.jsx)("button",{type:"button",onClick:()=>p(1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Pon","Wt","Åšr","Czw","Pt","Sob","Nie"].map((e,r)=>(0,t.jsx)("div",{className:"text-center text-[10px] text-gray-400 py-1",children:e},r))}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-1",children:h.days.map((r,o)=>{let i=e&&u(r.date)===e,a=u(r.date)===u(new Date);return(0,t.jsx)("button",{type:"button",onClick:()=>r.isCurrentMonth&&m(r.date),disabled:!r.isCurrentMonth,className:`aspect-square rounded text-[11px] font-medium transition-all ${!r.isCurrentMonth?"text-gray-600 cursor-not-allowed":i?"bg-[#fee715] text-[#101820] font-bold":a?"bg-white/10 text-[#fee715] border border-[#fee715]/50":"text-white hover:bg-white/10"}`,children:r.day},o)})}),(0,t.jsxs)("div",{className:"flex gap-2 mt-3 pt-3 border-t border-white/10",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{i(""),n(!1)},className:"flex-1 px-2 py-1.5 bg-white/5 hover:bg-white/10 border border-white/20 rounded text-white text-[10px] transition-colors",children:"WyczyÅ›Ä‡"}),(0,t.jsx)("button",{type:"button",onClick:()=>{m(new Date)},className:"flex-1 px-2 py-1.5 bg-[#fee715] text-[#101820] rounded text-[10px] font-bold transition-colors hover:bg-[#fee715]/90",children:"Dzisiaj"})]})]}),document.body)]})};function eW({params:e}){let[o,n]=(0,r.useState)(null),[b,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{e.then(e=>{n(e),w(e.id)})},[e]);let{user:y}=(0,l.useAuth)(),v=(0,s.useRouter)(),[j,k]=(0,r.useState)(null),[N,C]=(0,r.useState)(!0),[z,S]=(0,r.useState)(!1),[_,M]=(0,r.useState)(!1),[L,P]=(0,r.useState)(!1),[T,D]=(0,r.useState)(""),[E,A]=(0,r.useState)(""),[B,O]=(0,r.useState)("select"),[W,F]=(0,r.useState)(null),[R,I]=(0,r.useState)(!1),[J,K]=(0,r.useState)([]),[$,H]=(0,r.useState)({label:"",icon:"FileText",notes:"",link:"",isPinned:!1}),[U,q]=(0,r.useState)([]),[G,V]=(0,r.useState)({text:"",fontSize:18,fontWeight:"bold",textAlign:"left",verticalAlign:"middle",showHandles:!1,isPinned:!1}),[Z,X]=(0,r.useState)(null),[Y,Q]=(0,r.useState)({notes:"",link:""}),[ee,et]=(0,r.useState)([]),[er,eo]=(0,r.useState)(!1),[ei,ea]=(0,r.useState)(!1),[el,ed]=(0,r.useState)(!1),[ec,eu]=(0,r.useState)(!0),[eh,em]=(0,r.useState)(!0),[ep,ex]=(0,r.useState)(!0),[ef,eg]=(0,r.useState)(!1),[eb,ew]=(0,r.useState)("pan"),[ev,ej]=(0,r.useState)({isOpen:!1,title:"",message:"",type:"info"}),[ek,eN]=(0,r.useState)(!1),[eC,ez]=(0,r.useState)(!1),[eS,e_]=(0,r.useState)(null),[eT,eW]=(0,r.useState)(null),[eF,eR]=(0,r.useState)(new Map),[eI,eJ]=(0,r.useState)(new Map),[eK,e$]=(0,r.useState)(0),[eH,eU,eq]=(0,i.useNodesState)([]),[eG,eV,eZ]=(0,i.useEdgesState)([]),eX=(0,r.useRef)([]);(0,r.useEffect)(()=>{eX.current=eH},[eH]);let[eY,eQ]=(0,r.useState)([]),e0=(0,r.useRef)(null),e1=(0,r.useRef)(!1),e2=(0,r.useRef)(!1),e5=(0,r.useRef)(null),[e4,e7]=(0,r.useState)(!1),e3=(0,r.useRef)(null),e6=(0,r.useRef)(null),e8=(0,r.useRef)(null),[e9,te]=(0,r.useState)(!1),[tt,tr]=(0,r.useState)(!1),[to,ti]=(0,r.useState)(!1),[ta,tn]=(0,r.useState)(null),[ts,tl]=(0,r.useState)([]),[td,tc]=(0,r.useState)([]),[tu,th]=(0,r.useState)(!1),[tm,tp]=(0,r.useState)(1),[tx,tf]=(0,r.useState)({vertical:[],horizontal:[]}),[tg,tb]=(0,r.useState)({x:0,y:0,zoom:1}),[tw,ty]=(0,r.useState)({w:0,h:0}),tv=(0,r.useRef)(!1),tj=(0,r.useRef)(null),tk=(0,r.useRef)(new Set),tN=(0,r.useRef)(!1),tC=(0,r.useCallback)(()=>{let e={nodes:JSON.parse(JSON.stringify(eH)),edges:JSON.parse(JSON.stringify(eG))};eQ(t=>{let r=[...t,e];return r.length>50?r.slice(1):r})},[eH,eG]),tz=(0,r.useCallback)(()=>{if(0===eY.length)return;let e=eY[eY.length-1];eU(e.nodes),eV(e.edges),eQ(e=>e.slice(0,-1)),F(null),X(null),I(!1),eo(!1)},[eY,eU,eV]);(0,r.useEffect)(()=>{let e=e0.current;if(!e)return;let t=()=>{e&&ty({w:e.offsetWidth,h:e.offsetHeight})};t();let r=new ResizeObserver(t);return r.observe(e),()=>r.disconnect()},[]);let tS=(0,r.useCallback)(async()=>{if(y)try{let{data:e,error:t}=await d.supabase.from("custom_node_templates").select("*").eq("created_by",y.id).order("created_at",{ascending:!1});if(t)throw t;let r=(e||[]).map(e=>({type:"custom",icon:e.icon,label:e.label,color:e.color,category:e.category,isCustom:!0}));K(r)}catch(e){console.error("BÅ‚Ä…d Å‚adowania wÅ‚asnych szablonÃ³w:",e)}},[y]),t_=(0,r.useCallback)(async()=>{if(b)try{let{data:e,error:t}=await d.supabase.from("comment_threads").select(`
          id,
          status,
          comment_anchors (
            anchor_type,
            anchor_id,
            region_x,
            region_y,
            region_width,
            region_height
          )
        `).eq("funnel_id",b);if(t)throw console.error("BÅ‚Ä…d pobierania wÄ…tkÃ³w:",t),t;e&&e.length;let r=new Map,o=new Map;(e||[]).forEach(e=>{let t=e.comment_anchors,i=Array.isArray(t)?t[0]:t;if(!i||!i.anchor_type||"Zatwierdzone"===e.status||"Odrzucone"===e.status)return;let a="neutral";if("Otwarte"===e.status?a="warning":"Do akceptacji"===e.status?a="pending":"W toku"===e.status&&(a="neutral"),"node"===i.anchor_type&&i.anchor_id){let e=r.get(i.anchor_id)||{count:0,status:"neutral"};r.set(i.anchor_id,{count:e.count+1,status:"warning"===a||"warning"===e.status?"warning":"pending"===a||"pending"===e.status?"pending":"neutral"})}else if("edge"===i.anchor_type&&i.anchor_id){let e=o.get(i.anchor_id)||{count:0,status:"neutral"};o.set(i.anchor_id,{count:e.count+1,status:"warning"===a||"warning"===e.status?"warning":"pending"===a||"pending"===e.status?"pending":"neutral"})}}),eR(r),eJ(o),(e||[]).map(e=>{let t=e.comment_anchors,r=Array.isArray(t)?t[0]:t;return{threadId:e.id,anchorType:r?.anchor_type,anchorId:r?.anchor_id,anchorIdType:typeof r?.anchor_id,anchorIdValue:r?.anchor_id,status:e.status,isOpen:"Zatwierdzone"!==e.status&&"Odrzucone"!==e.status,fullAnchor:r}}),(e||[]).forEach(e=>{let t=e.comment_anchors,r=Array.isArray(t)?t[0]:t;r&&r.anchor_type?"region"===r.anchor_type||("node"!==r.anchor_type||r.anchor_id?"edge"!==r.anchor_type||r.anchor_id?"Zatwierdzone"===e.status||e.status:console.warn("âš ï¸ Thread dla edge bez anchor_id:",e.id,r):console.warn("âš ï¸ Thread dla node bez anchor_id:",e.id,r)):console.warn("âš ï¸ Thread bez anchor:",e.id)})}catch(e){console.error("BÅ‚Ä…d Å‚adowania liczby wÄ…tkÃ³w:",e)}},[b]);(0,r.useEffect)(()=>{b&&y&&(tB(),tS(),t_())},[b,y,tS,t_]),(0,r.useEffect)(()=>{if(!ta||!j||0===eH.length||e2.current)return;let e=eH.find(e=>(e.type,!0===e.data.isPinned));if(e2.current=!0,e){e1.current=!0;let t=()=>{if(!ta||!e0.current)return void requestAnimationFrame(t);let r=eH.find(t=>t.id===e.id);if(!r){console.warn("PrzypiÄ™ty node nie zostaÅ‚ znaleziony:",e.id),ta.setViewport({x:0,y:0,zoom:.48},{duration:0});return}let o=r.width||r.measured?.width||("text"===r.type?250:150),i=r.height||r.measured?.height||("text"===r.type?100:80),a=r.position.x+o/2,n=r.position.y+i/2,s=e0.current.offsetWidth,l=e0.current.offsetHeight;ta.setViewport({x:s/2-.48*a,y:l/2-.48*n,zoom:.48},{duration:200})};requestAnimationFrame(()=>{requestAnimationFrame(t)})}else{let e=()=>{ta?ta.fitView({padding:.2,duration:200}):requestAnimationFrame(e)};requestAnimationFrame(()=>{requestAnimationFrame(e)})}},[ta,j,eH,tg]),(0,r.useEffect)(()=>{b&&(e1.current=!1,e2.current=!1)},[b]),(0,r.useEffect)(()=>{if(!e5.current){e5.current={nodes:JSON.parse(JSON.stringify(eH)),edges:JSON.parse(JSON.stringify(eG))},e7(!1);return}e7(JSON.stringify({nodes:eH,edges:eG})!==JSON.stringify(e5.current))},[eH,eG]),(0,r.useEffect)(()=>{if(j&&eH.length>=0&&!R&&!er){let e=setTimeout(()=>{tO()},2e3);return()=>clearTimeout(e)}},[eH,eG,j,R,er]);let tM=(0,r.useCallback)(()=>{let e=eH.filter(e=>e.selected);if(0===e.length)return;let t=new Set(e.map(e=>e.id)),r=eG.filter(e=>t.has(e.source)&&t.has(e.target));tl(JSON.parse(JSON.stringify(e))),tc(JSON.parse(JSON.stringify(r)))},[eH,eG]),tL=(0,r.useCallback)(()=>{if(0===ts.length||!ta)return;tC();let e=ts.map(e=>{let t=`${"text"===e.type?"text-node":"node"}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return{...e,id:t,selected:!1,position:{x:e.position.x+50,y:e.position.y+50}}}),t=new Map;ts.forEach((r,o)=>{t.set(r.id,e[o].id)});let r=td.map(e=>{let r=`edge-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return{...e,id:r,source:t.get(e.source)||e.source,target:t.get(e.target)||e.target,selected:!1}});eU(t=>[...t,...e]),eV(e=>[...e,...r])},[ts,td,ta,eU,eV,tC]);(0,r.useEffect)(()=>{let e=e=>!!e&&e instanceof HTMLElement&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||!0===e.isContentEditable),t=t=>{if(!(e(t.target)||e(document.activeElement))){if((t.metaKey||t.ctrlKey)&&"z"===t.key&&!t.shiftKey){t.preventDefault(),tz();return}if((t.metaKey||t.ctrlKey)&&"c"===t.key){t.preventDefault(),tM();return}if((t.metaKey||t.ctrlKey)&&"v"===t.key){t.preventDefault(),tL();return}"Space"!==t.code||t.repeat||(t.preventDefault(),th(!0))}},r=t=>{e(t.target)||e(document.activeElement)||"Space"===t.code&&(t.preventDefault(),th(!1))};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r)}},[tz,tM,tL]);let tP=(0,r.useCallback)(async(e,t,r,o)=>{if(y)try{let{error:i}=await d.supabase.from("custom_node_templates").insert({created_by:y.id,label:e,icon:t,color:r,category:o});if(i)throw i;await tS(),ej({isOpen:!0,title:"Sukces",message:"Szablon zostaÅ‚ zapisany i dodany do sidebaru!",type:"success"})}catch(e){console.error("BÅ‚Ä…d zapisywania szablonu:",e),ej({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zapisaÄ‡ szablonu: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}},[y,tS]),tT=(0,r.useCallback)(async(e,t)=>{try{let{data:r,error:o}=await d.supabase.from("node_custom_fields").select("*").eq("funnel_id",t).eq("node_id",e).order("display_order",{ascending:!0});if(o)throw o;let i=(r||[]).map(e=>({id:e.id,field_name:e.field_name,field_type:e.field_type,field_value:e.field_value||"",display_order:e.display_order||0}));q(i)}catch(e){console.error("BÅ‚Ä…d Å‚adowania customowych pÃ³l:",e)}},[]),tD=(0,r.useCallback)(async(e,t,r)=>{try{let{error:o}=await d.supabase.from("node_custom_fields").delete().eq("funnel_id",t).eq("node_id",e);if(o)throw o;if(r.length>0){let o=r.map((r,o)=>({funnel_id:t,node_id:e,field_name:r.field_name,field_type:r.field_type,field_value:r.field_value||"",display_order:o})),{error:i}=await d.supabase.from("node_custom_fields").insert(o);if(i)throw i}}catch(e){throw console.error("BÅ‚Ä…d zapisywania customowych pÃ³l:",e),e}},[]),tE=(0,r.useCallback)(async(e,t)=>{try{let{data:r,error:o}=await d.supabase.from("edge_custom_fields").select("*").eq("funnel_id",t).eq("edge_id",e).order("display_order",{ascending:!0});if(o)throw o;let i=(r||[]).map(e=>({id:e.id,field_name:e.field_name,field_type:e.field_type,field_value:e.field_value||"",display_order:e.display_order||0}));et(i)}catch(e){console.error("BÅ‚Ä…d Å‚adowania customowych pÃ³l dla edge:",e)}},[]),tA=(0,r.useCallback)(async(e,t,r)=>{try{let{error:o}=await d.supabase.from("edge_custom_fields").delete().eq("funnel_id",t).eq("edge_id",e);if(o)throw o;if(r.length>0){let o=r.map((r,o)=>({funnel_id:t,edge_id:e,field_name:r.field_name,field_type:r.field_type,field_value:r.field_value||"",display_order:o})),{error:i}=await d.supabase.from("edge_custom_fields").insert(o);if(i)throw i}}catch(e){throw console.error("BÅ‚Ä…d zapisywania customowych pÃ³l dla edge:",e),e}},[]),tB=async()=>{try{C(!0);let{data:e,error:t}=await d.supabase.from("funnel_diagrams").select("*").eq("id",b).single();if(t)throw t;if(k(e),D(e.project_name||""),A(e.subtitle||""),e.subtitle&&!["stan obecny","docelowy","Plan 90 dni"].includes(e.subtitle)?O("custom"):O("select"),e.diagram_data){let t=e.diagram_data,r=t.nodes||[];if(r.length>0&&b)try{let{data:e,error:t}=await d.supabase.from("node_custom_fields").select("*").eq("funnel_id",b).order("display_order",{ascending:!0});if(!t&&e){let t={};e.forEach(e=>{t[e.node_id]||(t[e.node_id]=[]),t[e.node_id].push({id:e.id,field_name:e.field_name,field_type:e.field_type,field_value:e.field_value||"",display_order:e.display_order||0})}),r=r.map(e=>"custom"===e.type&&t[e.id]?{...e,data:{...e.data,customFields:t[e.id]}}:e)}}catch(e){console.error("BÅ‚Ä…d Å‚adowania customowych pÃ³l:",e)}r&&Array.isArray(r)&&eU(r),t.edges&&Array.isArray(t.edges)&&eV(t.edges),t.viewport&&tb(t.viewport),eQ([]),e2.current=!1,e5.current={nodes:JSON.parse(JSON.stringify(r||[])),edges:JSON.parse(JSON.stringify(t.edges||[]))},e7(!1)}}catch(e){console.error("BÅ‚Ä…d Å‚adowania lejka:",e),ej({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ lejka: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}finally{C(!1)}},tO=async()=>{if(j&&ta)try{S(!0);let e=ta.getViewport(),{error:t}=await d.supabase.from("funnel_diagrams").update({diagram_data:{nodes:eH,edges:eG,viewport:e},project_name:T,subtitle:E,updated_at:new Date().toISOString()}).eq("id",j.id);if(t)throw t;e5.current={nodes:JSON.parse(JSON.stringify(eH)),edges:JSON.parse(JSON.stringify(eG))},e7(!1)}catch(e){console.error("BÅ‚Ä…d zapisywania lejka:",e)}finally{S(!1)}},tW=(0,r.useCallback)(e=>{tC();let t={...e,id:`edge-${e.source}-${e.target}-${Date.now()}`,type:"custom",animated:!1,style:{stroke:"#fee715",strokeWidth:2},markerStart:void 0,markerEnd:{type:a.MarkerType.ArrowClosed,color:"#fee715",orient:"auto"},data:{notes:"",link:""}};eV(e=>(0,a.addEdge)(t,e))},[eV,tC]),tF=(0,r.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),tR=(0,r.useCallback)(e=>{let t;if(e.preventDefault(),!ta||!e0.current)return;let r=e0.current.getBoundingClientRect(),o=e.dataTransfer.getData("application/reactflow");if(!o)return;let i=JSON.parse(o),a=ta.screenToFlowPosition({x:e.clientX-r.left,y:e.clientY-r.top});t="text"===i.type?{id:`text-node-${Date.now()}`,type:"text",position:a,data:{text:"Kliknij, aby edytowaÄ‡",fontSize:18,fontWeight:"bold",textAlign:"left",verticalAlign:"middle",showHandles:!1,width:250,height:100},style:{width:250,height:100}}:{id:`node-${Date.now()}`,type:i.type||"custom",position:a,data:{label:i.isCustom?"WÅ‚asny element":i.label,icon:i.icon,color:i.color||"#fee71520",notes:"",category:i.category}},tC(),eU(e=>e.concat(t))},[ta,eU,tC]),tI=(0,r.useRef)(!1),tJ=(0,r.useCallback)((e,t)=>{if(ek){e.preventDefault(),e.stopPropagation(),eW({type:"node",id:t.id});return}if("select"===eb){if(tI.current){tI.current=!1;return}e.preventDefault(),e.stopPropagation(),tk.current=new Set(eH.filter(e=>e.selected).map(e=>e.id)),tv.current=!0;let r=t.selected;tj.current={nodeId:t.id,shouldSelect:!r},eU(e=>e.map(e=>e.id===t.id?{...e,selected:!r}:e)),setTimeout(()=>{tv.current=!1,tj.current=null,tk.current=new Set},150),r&&W?.id===t.id&&(F(null),I(!1));return}if(F(t),X(null),I(!0),"text"===t.type){let e={text:t.data.text||"",fontSize:t.data.fontSize||18,fontWeight:t.data.fontWeight||"bold",textAlign:t.data.textAlign||"left",verticalAlign:t.data.verticalAlign||"middle",showHandles:t.data.showHandles??!1,isPinned:t.data.isPinned??!1};V(e),e6.current=JSON.parse(JSON.stringify(e)),tr(!1)}else{let e={label:t.data.label||"",icon:t.data.icon||"FileText",notes:t.data.notes||"",link:t.data.link||"",isPinned:t.data.isPinned??!1,category:t.data.category};H(e),e3.current=JSON.parse(JSON.stringify(e)),te(!1);let r=t.data.customFields;r&&r.length>0?q(r):b?tT(t.id,b):q([])}eo(!1)},[eb,W,eU,b,tT]),tK=(0,r.useCallback)((e,t)=>{if(e.stopPropagation(),ek)return void eW({type:"edge",id:t.id});X(t),F(null);let r={notes:t.data?.notes||"",link:t.data?.link||""};Q(r),e8.current=JSON.parse(JSON.stringify(r)),ti(!1),eo(!0),I(!1),b&&tE(t.id,b)},[ek,b,tE]),t$=(0,r.useCallback)(e=>{if(ek&&ta){let t=ta.screenToFlowPosition({x:e.clientX,y:e.clientY});eW({type:"region",coords:{x:t.x,y:t.y,width:50,height:50}});return}"select"===eb&&(eU(e=>e.map(e=>({...e,selected:!1}))),eV(e=>e.map(e=>({...e,selected:!1}))),F(null),X(null),I(!1),eo(!1))},[ek,eb,ta,eU,eV]),tH=(0,r.useCallback)(e=>{},[]),tU=(0,r.useCallback)(e=>{if(e.some(e=>"remove"===e.type)&&tC(),"select"===eb){let t=e.filter(e=>"select"===e.type);if(tv.current&&t.length>0){let t=e.filter(e=>"select"!==e.type);t.length>0&&eq(t);return}if(t.length>1){tv.current=!1,tj.current=null,tk.current=new Set;let r=e.filter(e=>"select"!==e.type);r.length>0&&eq(r),eU(e=>e.map(e=>{let r=t.find(t=>"id"in t&&t.id===e.id);return r&&"selected"in r?{...e,selected:r.selected}:e}));return}}eq(e)},[eb,eq,tC,eU]),tq=(0,r.useCallback)(e=>{e.some(e=>"remove"===e.type)&&tC(),eZ(e)},[eZ,tC]);(0,r.useEffect)(()=>{if("select"!==eb||tN.current||!tv.current||!tj.current)return;let e=tj.current,t=tk.current,r=new Set(eH.filter(e=>e.selected).map(e=>e.id)),o=eH.find(t=>t.id===e.nodeId);(o&&o.selected!==e.shouldSelect||t.size>0&&Array.from(t).some(t=>t!==e.nodeId&&!r.has(t)))&&(tN.current=!0,eU(r=>r.map(r=>r.id===e.nodeId?{...r,selected:e.shouldSelect}:t.has(r.id)?{...r,selected:!0}:r)),setTimeout(()=>{tN.current=!1},50))},[eH,eb,eU]),(0,r.useEffect)(()=>{W&&"text"===W.type&&R&&eU(e=>e.map(e=>e.id===W.id?{...e,data:{...e.data,...G}}:e))},[G,W,R,eU]);let tG=(0,r.useRef)(eH);(0,r.useEffect)(()=>{eH.some((e,t)=>{if("text"===e.type){let r=tG.current[t];if(!r||r.id!==e.id)return!1;let o=e.width!==r.width,i=e.height!==r.height;if(o||i)return!0}return!1})&&eU(e=>e.map(e=>{if("text"===e.type&&(e.width||e.height)){let t=e.width||e.data.width,r=e.height||e.data.height;if(t!==e.data.width||r!==e.data.height)return{...e,data:{...e.data,width:t,height:r}}}return e})),tG.current=eH},[eH,eU]),(0,r.useEffect)(()=>{if(!W){te(!1),tr(!1);return}if("text"===W.type){if(!e6.current)return void tr(!1);tr(JSON.stringify(G)!==JSON.stringify(e6.current))}else{if(!e3.current)return void te(!1);te(JSON.stringify($)!==JSON.stringify(e3.current))}},[$,G,W]),(0,r.useEffect)(()=>{Z&&e8.current?ti(JSON.stringify(Y)!==JSON.stringify(e8.current)):ti(!1)},[Y,Z]);let tV=async()=>{if(!W||!b)return;tC();let e=("text"===W.type?G.isPinned:$.isPinned)===!0;if(eU(t=>t.map(t=>{if(t.id===W.id)if("text"===t.type)return{...t,data:{...t.data,...G}};else return{...t,data:{...t.data,...$,customFields:U.length>0?U:void 0}};return e?{...t,data:{...t.data,isPinned:!1}}:t})),"custom"===W.type)try{await tD(W.id,b,U)}catch(e){console.error("BÅ‚Ä…d zapisywania customowych pÃ³l:",e)}"text"===W.type?(e6.current=JSON.parse(JSON.stringify(G)),tr(!1)):(e3.current=JSON.parse(JSON.stringify($)),te(!1)),F(null),I(!1)},tZ=()=>{W&&(tC(),eU(e=>e.filter(e=>e.id!==W.id)),eV(e=>e.filter(e=>e.source!==W.id&&e.target!==W.id)),F(null),I(!1))},tX=async()=>{if(Z&&b){tC();try{await tA(Z.id,b,ee)}catch(e){console.error("BÅ‚Ä…d zapisywania customowych pÃ³l dla edge:",e)}eV(e=>e.map(e=>e.id===Z.id?{...e,data:{...e.data,...Y,customFields:ee.length>0?ee:void 0},label:Y.notes?Y.notes:void 0}:e)),X(null),eo(!1)}},tY=(0,r.useCallback)(e=>({width:e.width||e.measured?.width||150,height:e.height||e.measured?.height||80}),[]),tQ=e=>{let t=eH.filter(e=>e.selected);if(t.length<2)return void ej({isOpen:!0,title:"Wymagane zaznaczenie",message:"Zaznacz co najmniej 2 elementy (Ctrl+Click lub przeciÄ…gnij myszkÄ…), aby je wyrÃ³wnaÄ‡.",type:"info"});let r=[...eH];if("left"===e){let e=Math.min(...t.map(e=>e.position.x));r=r.map(r=>t.find(e=>e.id===r.id)?{...r,position:{...r.position,x:e}}:r)}else if("right"===e){let e=Math.max(...t.map(e=>{let t=tY(e);return e.position.x+t.width}));r=r.map(r=>{if(t.find(e=>e.id===r.id)){let t=tY(r);return{...r,position:{...r.position,x:e-t.width}}}return r})}else if("top"===e){let e=Math.min(...t.map(e=>e.position.y));r=r.map(r=>t.find(e=>e.id===r.id)?{...r,position:{...r.position,y:e}}:r)}else if("bottom"===e){let e=Math.max(...t.map(e=>{let t=tY(e);return e.position.y+t.height}));r=r.map(r=>{if(t.find(e=>e.id===r.id)){let t=tY(r);return{...r,position:{...r.position,y:e-t.height}}}return r})}else if("center-x"===e){let e=t.reduce((e,t)=>{let r=tY(t);return e+t.position.x+r.width/2},0)/t.length;r=r.map(r=>{if(t.find(e=>e.id===r.id)){let t=tY(r);return{...r,position:{...r.position,x:e-t.width/2}}}return r})}else if("center-y"===e){let e=t.reduce((e,t)=>{let r=tY(t);return e+t.position.y+r.height/2},0)/t.length;r=r.map(r=>{if(t.find(e=>e.id===r.id)){let t=tY(r);return{...r,position:{...r.position,y:e-t.height/2}}}return r})}else if("distribute-x"===e){let e=[...t].sort((e,t)=>e.position.x-t.position.x);tY(e[0]);let o=tY(e[e.length-1]),i=(e[e.length-1].position.x+o.width-e[0].position.x)/(e.length-1);e.forEach((t,o)=>{if(o>0&&o<e.length-1){let a=r.findIndex(e=>e.id===t.id);-1!==a&&(r[a]={...r[a],position:{...r[a].position,x:e[0].position.x+i*o}})}})}else if("distribute-y"===e){let e=[...t].sort((e,t)=>e.position.y-t.position.y);tY(e[0]);let o=tY(e[e.length-1]),i=(e[e.length-1].position.y+o.height-e[0].position.y)/(e.length-1);e.forEach((t,o)=>{if(o>0&&o<e.length-1){let a=r.findIndex(e=>e.id===t.id);-1!==a&&(r[a]={...r[a],position:{...r[a].position,y:e[0].position.y+i*o}})}})}tC(),eU(r)},t0=[...eB,...J].reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});return(Object.keys(t0).forEach(e=>{t0[e].sort((e,t)=>"Inne"===e.label?1:"Inne"===t.label?-1:0)}),N||!o)?(0,t.jsx)(u.LoadingState,{variant:"fullscreen",label:"Åadowanie lejkaâ€¦"}):j?(0,t.jsxs)("div",{className:"h-screen bg-[#101820] flex flex-col relative",children:[!ec&&(0,t.jsx)("button",{onClick:()=>eu(!0),className:"fixed top-2 left-2 z-50 p-2 bg-[#18232F]/95 border border-[#fee715]/30 text-[#fee715] rounded-lg hover:bg-[#fee715]/10 hover:border-[#fee715]/50 transition-all duration-200 shadow-lg backdrop-blur-sm",title:"PokaÅ¼ nagÅ‚Ã³wek",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,t.jsxs)("div",{className:`flex items-center justify-between px-6 py-4 border-b border-white/10 bg-[#18232F] transition-all duration-300 ${ec?"opacity-100":"opacity-0 h-0 overflow-hidden border-0"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>v.push("/panel/marketing"),className:"p-2 hover:bg-white/10 rounded-lg transition-all",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[_?(0,t.jsx)("input",{type:"text",value:T,onChange:e=>D(e.target.value),onBlur:async()=>{if(M(!1),T!==j.project_name&&j)try{let{error:e}=await d.supabase.from("funnel_diagrams").update({project_name:T}).eq("id",j.id);if(e)throw e;k({...j,project_name:T})}catch(e){console.error("BÅ‚Ä…d zapisywania tytuÅ‚u:",e),D(j.project_name||"")}},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur(),"Escape"===e.key&&(D(j.project_name||""),M(!1))},className:"font-[Montserrat] text-xl font-bold text-white bg-white/10 border border-[#fee715]/50 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 w-full max-w-md",autoFocus:!0}):(0,t.jsxs)("h1",{className:"font-[Montserrat] text-xl font-bold text-white cursor-pointer hover:text-[#fee715] transition-colors",onClick:()=>{M(!0),D(j.project_name||"")},title:"Kliknij, aby edytowaÄ‡ tytuÅ‚",children:["Mapa marketingu - ",j.project_name||"Bez nazwy"]}),L?(0,t.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:["select"===B?(0,t.jsx)(h.CustomSelect,{value:E||"",onChange:async e=>{if("custom"===e)O("custom"),A("");else if(A(e),j&&e!==j.subtitle)try{let{error:t}=await d.supabase.from("funnel_diagrams").update({subtitle:e}).eq("id",j.id);if(t)throw t;k({...j,subtitle:e}),P(!1)}catch(e){console.error("BÅ‚Ä…d zapisywania podtytuÅ‚u:",e)}else P(!1)},options:[{value:"stan obecny",label:"stan obecny"},{value:"docelowy",label:"docelowy"},{value:"Plan 90 dni",label:"Plan 90 dni"},{value:"custom",label:"WÅ‚asny tekst..."}],placeholder:"Wybierz podtytuÅ‚",className:"w-48",size:"sm"}):(0,t.jsx)("input",{type:"text",value:E,onChange:e=>A(e.target.value),placeholder:"Wpisz wÅ‚asny podtytuÅ‚",className:"text-sm bg-white/10 border border-[#fee715]/50 rounded px-2 py-1 text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 w-48",autoFocus:!0}),(0,t.jsx)("button",{onClick:async()=>{if(j){let e=E.trim()||null;try{let{error:t}=await d.supabase.from("funnel_diagrams").update({subtitle:e}).eq("id",j.id);if(t)throw t;k({...j,subtitle:e}),e&&["stan obecny","docelowy","Plan 90 dni"].includes(e)&&O("select"),P(!1)}catch(e){console.error("BÅ‚Ä…d zapisywania podtytuÅ‚u:",e),A(j.subtitle||""),P(!1)}}else P(!1)},className:"px-2 py-1 text-xs bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715] rounded hover:bg-[#fee715]/20 transition-colors",children:"âœ“"}),(0,t.jsx)("button",{onClick:()=>{A(j.subtitle||""),P(!1),j.subtitle&&["stan obecny","docelowy","Plan 90 dni"].includes(j.subtitle)?O("select"):j.subtitle&&O("custom")},className:"px-2 py-1 text-xs bg-white/10 border border-white/20 text-white/70 rounded hover:bg-white/20 transition-colors",title:"Anuluj",children:"Ã—"})]}):(0,t.jsx)("div",{className:"inline-flex items-center px-3 py-1 rounded-md bg-white/[0.04] border border-white/10 text-xs font-medium text-gray-300 cursor-pointer hover:bg-white/[0.06] hover:border-white/20 hover:text-white transition-all mt-0.5",onClick:()=>{P(!0),A(j.subtitle||""),j.subtitle&&["stan obecny","docelowy","Plan 90 dni"].includes(j.subtitle)?O("select"):O("custom")},title:"Kliknij, aby edytowaÄ‡ podtytuÅ‚",children:j.subtitle||"Kliknij, aby dodaÄ‡ podtytuÅ‚"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>eu(!1),className:"p-1.5 hover:bg-white/10 rounded-lg transition-all text-gray-400 hover:text-white",title:"Ukryj nagÅ‚Ã³wek",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),z&&y?.email==="stanislaw@drozniak.com"&&(0,t.jsxs)("span",{className:"text-sm text-gray-400 flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"ZapisujÄ™..."]}),(0,t.jsx)("button",{onClick:tz,disabled:0===eY.length,title:"Cofnij ostatniÄ… zmianÄ™ (Ctrl+Z)",className:"px-4 py-2 bg-white/[0.06] border border-white/20 text-white/90 rounded-lg font-medium hover:bg-white/10 hover:border-white/30 transition-colors disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.06] disabled:hover:border-white/20",children:"Wstecz"}),(0,t.jsxs)("button",{onClick:()=>{ez(!eC),eC||t_()},className:`px-4 py-2 rounded-lg font-medium transition-colors ${eC?"bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715]":"bg-white/[0.06] border border-white/20 text-white/90 hover:bg-white/10"}`,title:"Komentarze",children:[(0,t.jsx)(eM.ChatCircleDots,{size:18,className:"inline-block mr-1.5"}),"Komentarze"]}),(0,t.jsx)("button",{onClick:tO,className:"relative px-5 py-2 bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715] rounded-lg font-medium hover:bg-[#fee715]/20 hover:border-[#fee715]/70 transition-all duration-200",children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:["Zapisz zmiany",e4&&(0,t.jsx)("span",{className:"w-2 h-2 bg-[#fee715] rounded-full animate-pulse",title:"Masz niezapisane zmiany"})]})})]})]}),!eh&&(0,t.jsx)("button",{onClick:()=>em(!0),className:`fixed z-50 p-2 bg-[#0a0f14]/95 border border-[#fee715]/30 text-[#fee715] rounded-lg hover:bg-[#fee715]/10 hover:border-[#fee715]/50 transition-all duration-200 shadow-lg backdrop-blur-sm ${!ec?"top-14 left-2":"top-2 left-2"}`,title:"PokaÅ¼ panel elementÃ³w",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden relative",children:[(0,t.jsx)("div",{className:`transition-all duration-300 overflow-hidden funnel-builder-sidebar ${eh?"w-64 opacity-100":"w-0 opacity-0"}`,style:{backgroundColor:"#0a0f14",background:"#0a0f14"},children:(0,t.jsxs)("div",{className:"w-64 h-full border-r-2 border-[#fee715]/30 overflow-y-auto p-4 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] font-medium text-[#fee715] text-base tracking-tight border-b border-[#fee715]/20 pb-2.5 flex-1",children:"Elementy"}),(0,t.jsx)("button",{onClick:()=>em(!1),className:"p-1.5 hover:bg-white/10 rounded-lg transition-all text-gray-400 hover:text-white ml-2",title:"Ukryj panel elementÃ³w",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"space-y-6",children:Object.entries(t0).map(([e,r])=>(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-[#fee715] uppercase mb-3 tracking-wider px-2",children:e}),(0,t.jsx)("div",{className:"space-y-2",children:r.map((e,r)=>(0,t.jsx)("div",{draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow",JSON.stringify(e))},className:"p-3 bg-[#18232F]/90 rounded-lg border border-white/10 hover:border-[#fee715]/40 cursor-move transition-all duration-200 shadow-sm hover:shadow-lg hover:shadow-[#fee715]/10 backdrop-blur-sm relative overflow-hidden group",style:{background:"linear-gradient(to bottom, rgba(24, 35, 47, 0.9), rgba(24, 35, 47, 0.9))"},onMouseEnter:e=>{e.currentTarget.style.background="linear-gradient(135deg, rgba(254, 231, 21, 0.08) 0%, rgba(24, 35, 47, 0.95) 50%, rgba(254, 231, 21, 0.05) 100%)"},onMouseLeave:e=>{e.currentTarget.style.background="linear-gradient(to bottom, rgba(24, 35, 47, 0.9), rgba(24, 35, 47, 0.9))"},children:(0,t.jsxs)("div",{className:"flex items-center gap-2 relative z-10",children:[(0,t.jsx)("div",{className:"text-white",children:eD(e.icon,18)}),(0,t.jsx)("span",{className:"text-sm text-white/95 font-medium tracking-tight",children:e.label})]})},r))})]},e))})]})}),(0,t.jsxs)("div",{className:"flex-1 relative",ref:e0,children:[ef&&(0,t.jsxs)("div",{className:"absolute top-4 right-4 z-20 bg-[#0a0f14]/98 border border-white/10 rounded-lg shadow-xl backdrop-blur-sm p-4 min-w-[200px]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"text-xs font-medium text-white/90 tracking-tight",children:"Legenda"}),(0,t.jsx)("button",{onClick:()=>eg(!1),className:"p-1 hover:bg-white/10 rounded transition-all text-gray-400 hover:text-white",title:"Ukryj legendÄ™",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"space-y-3 text-xs",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsxs)("div",{className:"relative shrink-0 mt-0.5",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center text-white",style:{backgroundColor:"#4285F420"},children:eD("MegaphoneSimple",14)}),(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]",style:{backgroundColor:"#4285F4"}})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-white/90 font-medium",children:"Å¹rÃ³dÅ‚a Ruchu"}),(0,t.jsx)("div",{className:"text-white/50 text-[10px] mt-0.5",children:"Facebook Ads, Google Ads, Email"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsxs)("div",{className:"relative shrink-0 mt-0.5",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center text-white",style:{backgroundColor:"#00C9A720"},children:eD("Globe",14)}),(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]",style:{backgroundColor:"#00C9A7"}})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-white/90 font-medium",children:"Typ Strony"}),(0,t.jsx)("div",{className:"text-white/50 text-[10px] mt-0.5",children:"Landing, SprzedaÅ¼owa, Checkout"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsxs)("div",{className:"relative shrink-0 mt-0.5",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center text-white",style:{backgroundColor:"#fee71520"},children:eD("Notebook",14)}),(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]",style:{backgroundColor:"#fee715"}})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-white/90 font-medium",children:"DziaÅ‚ania"}),(0,t.jsx)("div",{className:"text-white/50 text-[10px] mt-0.5",children:"Lead magnet, Webinar, Chatbot"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsxs)("div",{className:"relative shrink-0 mt-0.5",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center text-white",style:{backgroundColor:"#10B98120"},children:eD("CheckCircle",14)}),(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-[#0a0f14]",style:{backgroundColor:"#10B981"}})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-white/90 font-medium",children:"Cel/Konwersja"}),(0,t.jsx)("div",{className:"text-white/50 text-[10px] mt-0.5",children:"Lead, Rezerwacja, Telefon, SprzedaÅ¼"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,t.jsx)("div",{className:"relative shrink-0 mt-0.5",children:(0,t.jsx)("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center text-white bg-white/5 border border-white/10",children:eD("FileText",14)})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-white/90 font-medium",children:"NarzÄ™dzia"}),(0,t.jsx)("div",{className:"text-white/50 text-[10px] mt-0.5",children:"Pola tekstowe, notatki"})]})]})]})]}),!ef&&(0,t.jsx)("button",{onClick:()=>eg(!0),className:"absolute top-4 right-4 z-20 p-2 bg-[#0a0f14]/95 border border-white/10 text-white/70 rounded-lg hover:bg-white/10 hover:text-white transition-all duration-200 shadow-lg backdrop-blur-sm",title:"PokaÅ¼ legendÄ™",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,t.jsx)(eP.Provider,{value:{isSelectMode:"select"===eb,onLongPressDeselect:tH},children:(0,t.jsxs)(i.ReactFlow,{nodes:eH.map(e=>{let t=eF.get(e.id);if(t&&t.count>0){let r={...e,data:{...e.data,commentCount:t.count,commentStatus:t.status}};return e.id===eH[0]?.id,r}return{...e,data:{...e.data,commentCount:void 0,commentStatus:void 0}}}),edges:eG.map(e=>{let t=eI.get(e.id);return t&&t.count>0?{...e,data:{...e.data,commentCount:t.count,commentStatus:t.status}}:{...e,data:{...e.data,commentCount:void 0,commentStatus:void 0}}}),onNodesChange:tU,onEdgesChange:tq,onConnect:tW,onNodeDragStart:(e,t)=>{tI.current=!0,tC()},isValidConnection:()=>!0,onInit:tn,onDrop:tR,onDragOver:tF,onNodeClick:tJ,onEdgeClick:tK,onPaneClick:t$,onSelectionChange:e=>{if("select"===eb&&tv.current)return},onViewportChange:e=>{tb(e),tp(e.zoom)},onNodeDrag:(e,t,r)=>{let o=r.filter(e=>e.id!==t.id);if(0===o.length)return void tf({vertical:[],horizontal:[]});let i=tY(t),a=t.position.x,n=t.position.x+i.width/2,s=t.position.x+i.width,l=t.position.y,d=t.position.y+i.height/2,c=t.position.y+i.height,u=new Set,h=new Set;o.forEach(e=>{let t=tY(e),r=e.position.x,o=e.position.x+t.width/2,i=e.position.x+t.width,m=e.position.y,p=e.position.y+t.height/2,x=e.position.y+t.height;(5>=Math.abs(a-r)||5>=Math.abs(n-r)||5>=Math.abs(s-r))&&u.add(r),(5>=Math.abs(a-o)||5>=Math.abs(n-o)||5>=Math.abs(s-o))&&u.add(o),(5>=Math.abs(a-i)||5>=Math.abs(n-i)||5>=Math.abs(s-i))&&u.add(i),(5>=Math.abs(l-m)||5>=Math.abs(d-m)||5>=Math.abs(c-m))&&h.add(m),(5>=Math.abs(l-p)||5>=Math.abs(d-p)||5>=Math.abs(c-p))&&h.add(p),(5>=Math.abs(l-x)||5>=Math.abs(d-x)||5>=Math.abs(c-x))&&h.add(x)}),tf({vertical:Array.from(u),horizontal:Array.from(h)})},onNodeDragStop:(e,t)=>{let r=tY(t),o=t.position.x,i=t.position.y;for(let e of tx.vertical){let i=Math.abs(t.position.x-e),a=Math.abs(t.position.x+r.width/2-e),n=Math.abs(t.position.x+r.width-e);if(i<=5){o=e;break}if(a<=5){o=e-r.width/2;break}if(n<=5){o=e-r.width;break}}for(let e of tx.horizontal){let o=Math.abs(t.position.y-e),a=Math.abs(t.position.y+r.height/2-e),n=Math.abs(t.position.y+r.height-e);if(o<=5){i=e;break}if(a<=5){i=e-r.height/2;break}if(n<=5){i=e-r.height;break}}(o!==t.position.x||i!==t.position.y)&&eU(e=>e.map(e=>e.id===t.id?{...e,position:{x:o,y:i}}:e)),tf({vertical:[],horizontal:[]})},nodeTypes:eE,edgeTypes:eA,fitView:!0,fitViewOptions:{padding:.2,duration:0},className:`bg-[#101820] ${"select"===eb?"funnel-select-mode":""}`,connectionLineType:"smoothstep",snapToGrid:!0,snapGrid:[20,20],connectionLineStyle:{stroke:"#fee715",strokeWidth:2,strokeDasharray:"5,5"},defaultEdgeOptions:{type:"custom",animated:!1,style:{stroke:"#fee715",strokeWidth:2},markerStart:void 0,markerEnd:{type:a.MarkerType.ArrowClosed,color:"#fee715",orient:"auto"}},nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,elementsSelectable:"select"!==eb,selectNodesOnDrag:!1,panOnDrag:"pan"===eb||!!tu&&[1,2],panOnScroll:!0,zoomOnScroll:!0,zoomOnPinch:!0,zoomOnDoubleClick:!1,preventScrolling:!1,selectionOnDrag:"select"===eb,selectionMode:"full",multiSelectionKeyCode:null,deleteKeyCode:["Delete","Backspace"],connectionMode:"loose",connectionRadius:80,minZoom:.01,maxZoom:10,proOptions:{hideAttribution:!0},children:[(0,t.jsx)(i.Background,{variant:i.BackgroundVariant.Dots,gap:20,size:1.5,color:"#ffffff25",style:{opacity:.6}}),!ep&&(0,t.jsx)(i.Panel,{position:"bottom-left",children:(0,t.jsx)("button",{onClick:()=>ex(!0),className:"p-2 bg-[#0a0f14]/95 border border-[#fee715]/30 text-[#fee715] rounded-lg hover:bg-[#fee715]/10 hover:border-[#fee715]/50 transition-all duration-200 shadow-lg backdrop-blur-sm",title:"PokaÅ¼ narzÄ™dzia",children:(0,t.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})}),ep&&(0,t.jsx)(i.Panel,{position:"bottom-left",className:"bg-[#0a0f14]/95 border border-amber-500/20 rounded-lg p-2 shadow-xl backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>ex(!1),className:"p-1.5 hover:bg-white/10 rounded-lg transition-all text-gray-400 hover:text-white",title:"Ukryj narzÄ™dzia",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsxs)("div",{className:"flex items-center gap-1 border-r border-[#fee715]/20 pr-2 mr-2",children:[(0,t.jsx)("span",{className:"text-xs text-amber-400/90 font-medium mr-1",children:"Tryb:"}),(0,t.jsx)("button",{onClick:()=>ew("pan"),className:`p-2 rounded-lg transition-all duration-200 ${"pan"===eb?"bg-gradient-to-r from-amber-600 to-amber-500 text-white shadow-md shadow-amber-900/20":"bg-[#18232F]/80 text-white/80 hover:bg-amber-500/10 hover:text-white border border-white/10 hover:border-amber-500/50 backdrop-blur-sm"}`,title:"Przesuwanie (Space + drag lub Å›rodkowy przycisk myszy)",children:(0,t.jsx)(eL.Hand,{size:16})}),(0,t.jsx)("button",{onClick:()=>ew("select"),className:`p-2 rounded-lg transition-all duration-200 ${"select"===eb?"bg-gradient-to-r from-amber-600 to-amber-500 text-white shadow-md shadow-amber-900/20":"bg-[#18232F]/80 text-white/80 hover:bg-amber-500/10 hover:text-white border border-white/10 hover:border-amber-500/50 backdrop-blur-sm"}`,title:"Zaznaczanie elementÃ³w: Klikaj elementy lub przeciÄ…gnij po pustym tle (box selection)",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"})})}),(0,t.jsx)("button",{onClick:()=>{eN(!ek),ew(ek?"pan":"comment")},className:`p-2 rounded-lg transition-all duration-200 ${ek?"bg-gradient-to-r from-amber-600 to-amber-500 text-white shadow-md shadow-amber-900/20":"bg-[#18232F]/80 text-white/80 hover:bg-amber-500/10 hover:text-white border border-white/10 hover:border-amber-500/50 backdrop-blur-sm"}`,title:"Dodaj komentarz (kliknij na element)",children:(0,t.jsx)(eM.ChatCircleDots,{size:16})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:()=>ta?.zoomOut({duration:300}),className:"p-2 bg-[#18232F]/80 border border-white/10 hover:border-amber-500/50 hover:bg-amber-500/10 rounded-lg transition-all duration-200 text-white/80 hover:text-white backdrop-blur-sm",title:"Oddal (Zoom Out)",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})})}),(0,t.jsx)("button",{onClick:()=>ta?.zoomIn({duration:300}),className:"p-2 bg-[#18232F]/80 border border-white/10 hover:border-amber-500/50 hover:bg-amber-500/10 rounded-lg transition-all duration-200 text-white/80 hover:text-white backdrop-blur-sm",title:"PrzybliÅ¼ (Zoom In)",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})}),(0,t.jsx)("button",{onClick:()=>ta?.fitView({duration:300,padding:.2}),className:"p-2 bg-[#18232F]/80 border border-white/10 hover:border-amber-500/50 hover:bg-amber-500/10 rounded-lg transition-all duration-200 text-white/80 hover:text-white backdrop-blur-sm",title:"Dopasuj do widoku (Fit View)",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),(0,t.jsxs)("div",{className:"px-2 text-xs text-amber-400/90 font-medium border-l border-amber-500/20 ml-2 pl-2",children:[(100*tm).toFixed(0),"%"]})]})]})}),ei&&(0,t.jsx)("div",{className:"absolute bottom-4 right-4 z-10",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{onClick:()=>ea(!1),className:"absolute -top-2 -right-2 z-20 w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold shadow-lg transition-all",title:"Zamknij podglÄ…d",children:"Ã—"}),(0,t.jsx)(i.MiniMap,{className:"bg-[#18232F] border-2 border-[#fee715] rounded-lg shadow-2xl",nodeColor:"#fee715",nodeStrokeColor:"#101820",nodeStrokeWidth:2,maskColor:"rgba(16, 24, 32, 0.9)",style:{backgroundColor:"#18232F"},pannable:!0,zoomable:!0})]})}),!ei&&(0,t.jsx)("button",{onClick:()=>ea(!0),className:"absolute bottom-4 right-4 z-10 px-4 py-2 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded-lg font-medium hover:bg-[#fee715]/20 hover:border-[#fee715]/60 transition-all duration-200",title:"PokaÅ¼ podglÄ…d",children:"â†‘ PodglÄ…d"}),el&&(0,t.jsx)(i.Panel,{position:"top-center",className:"bg-transparent",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 bg-[#0a0f14]/95 border border-white/10 rounded-lg p-1.5 shadow-xl backdrop-blur-sm",children:[(0,t.jsx)("button",{onClick:()=>tQ("center-y"),className:"p-1.5 bg-[#18232F]/80 border border-white/10 hover:border-[#fee715]/50 hover:bg-[#fee715]/10 rounded transition-all duration-200 text-white/80 hover:text-white",title:"WyrÃ³wnaj w pionie (ta sama wysokoÅ›Ä‡ Y)",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 12h16M4 12l4-4m-4 4l4 4m12-4l-4-4m4 4l-4 4"})})}),(0,t.jsx)("button",{onClick:()=>tQ("center-x"),className:"p-1.5 bg-[#18232F]/80 border border-white/10 hover:border-[#fee715]/50 hover:bg-[#fee715]/10 rounded transition-all duration-200 text-white/80 hover:text-white",title:"WyrÃ³wnaj w poziomie (ta sama pozycja X)",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16M12 4l-4 4m4-4l4 4m-4 12l-4-4m4 4l4-4"})})}),(0,t.jsx)("div",{className:"w-px h-4 bg-white/10 mx-0.5"}),(0,t.jsx)("button",{onClick:()=>ed(!1),className:"p-1.5 bg-[#18232F]/80 border border-white/10 hover:border-white/30 hover:bg-white/10 rounded transition-all duration-200 text-white/60 hover:text-white",title:"Ukryj panel",children:(0,t.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),!el&&(0,t.jsx)(i.Panel,{position:"top-center",className:"bg-transparent",children:(0,t.jsx)("button",{onClick:()=>ed(!0),className:"p-2 bg-[#0a0f14]/95 border border-white/10 text-white/60 rounded-lg hover:bg-white/10 hover:text-white hover:border-white/20 transition-all duration-200 shadow-lg backdrop-blur-sm",title:"PokaÅ¼ wyrÃ³wnywanie",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]})}),(tx.vertical.length>0||tx.horizontal.length>0)&&tw.w>0&&tw.h>0&&(0,t.jsx)("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:10},children:(0,t.jsxs)("svg",{width:"100%",height:"100%",viewBox:`0 0 ${tw.w} ${tw.h}`,preserveAspectRatio:"none",children:[tx.vertical.map(e=>{let r=e*tg.zoom+tg.x;return(0,t.jsx)("line",{x1:r,y1:0,x2:r,y2:tw.h,stroke:"#fee715",strokeOpacity:.8,strokeWidth:1},`v-${e}`)}),tx.horizontal.map(e=>{let r=e*tg.zoom+tg.y;return(0,t.jsx)("line",{x1:0,y1:r,x2:tw.w,y2:r,stroke:"#fee715",strokeOpacity:.8,strokeWidth:1},`h-${e}`)})]})})]}),er&&Z&&(0,t.jsxs)("div",{className:"w-72 border-l border-white/10 p-4 overflow-y-auto bg-[#0a0f14]/98 nodrag nopan",onKeyDown:e=>{["INPUT","TEXTAREA","SELECT"].includes(e.target?.tagName)&&e.stopPropagation()},onKeyUp:e=>{["INPUT","TEXTAREA","SELECT"].includes(e.target?.tagName)&&e.stopPropagation()},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"font-medium text-white text-sm tracking-tight",children:"WÅ‚aÅ›ciwoÅ›ci linii"}),(0,t.jsx)("button",{onClick:()=>{eo(!1),X(null)},className:"p-0.5 hover:bg-white/5 rounded text-gray-500 hover:text-gray-300 transition-colors",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Notatki"}),(0,t.jsx)("textarea",{value:Y.notes,onChange:e=>Q({...Y,notes:e.target.value}),className:"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 min-h-[72px]",placeholder:"Notatki do linii..."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Link (opcjonalnie)"}),(0,t.jsx)("input",{type:"url",value:Y.link,onChange:e=>Q({...Y,link:e.target.value}),className:"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30",placeholder:"https://..."})]}),(0,t.jsxs)("div",{className:"pt-3 mt-3 border-t border-white/10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400",children:"Dodatkowe pola"}),(0,t.jsx)("button",{onClick:()=>{et([...ee,{field_name:"",field_type:"text",field_value:"",display_order:ee.length}])},className:"px-2 py-1 text-xs bg-white/[0.06] border border-white/20 text-white/90 rounded hover:bg-white/10 hover:border-white/30 transition-colors",children:"+ Dodaj pole"})]}),(0,t.jsxs)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[ee.map((e,r)=>(0,t.jsxs)("div",{className:"p-2 bg-white/[0.02] border border-white/5 rounded",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("input",{type:"text",value:e.field_name,onChange:e=>{let t=[...ee];t[r].field_name=e.target.value,et(t)},placeholder:"Nazwa pola",className:"flex-1 bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"}),(0,t.jsx)(h.CustomSelect,{size:"sm",value:e.field_type,onChange:e=>{let t=[...ee];t[r].field_type=e,t[r].field_value="",et(t)},options:[{value:"text",label:"Tekst"},{value:"date",label:"Data"},{value:"number",label:"Liczba"},{value:"link",label:"Link"}],className:"w-24"}),(0,t.jsx)("button",{onClick:()=>{et(ee.filter((e,t)=>t!==r))},className:"p-1 text-gray-400 hover:text-red-400 transition-colors",title:"UsuÅ„ pole",children:(0,t.jsx)(ey.Trash,{size:14})})]}),"text"===e.field_type&&(0,t.jsx)("input",{type:"text",value:e.field_value,onChange:e=>{let t=[...ee];t[r].field_value=e.target.value,et(t)},placeholder:"WartoÅ›Ä‡ tekstowa",className:"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"}),"date"===e.field_type&&(0,t.jsx)(eO,{value:e.field_value,onChange:e=>{let t=[...ee];t[r].field_value=e,et(t)}}),"number"===e.field_type&&(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("input",{type:"text",inputMode:"numeric",value:e.field_value,onChange:e=>{let t=e.target.value.replace(/[^0-9.-]/g,""),o=[...ee];o[r].field_value=t,et(o)},placeholder:"WartoÅ›Ä‡ liczbowa",className:"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 pr-12 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"}),(0,t.jsxs)("div",{className:"absolute right-0.5 top-0 bottom-0 w-11 flex flex-col",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{let t=parseFloat(e.field_value)||0,o=[...ee];o[r].field_value=String(t+1),et(o)},className:"flex-1 flex items-center justify-center text-gray-400 hover:text-white border-b border-white/10 hover:bg-white/5 rounded-t",children:(0,t.jsx)(en.Plus,{size:10})}),(0,t.jsx)("button",{type:"button",onClick:()=>{let t=parseFloat(e.field_value)||0,o=[...ee];o[r].field_value=String(Math.max(0,t-1)),et(o)},className:"flex-1 flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/5 rounded-b",children:(0,t.jsx)(es.Minus,{size:10})})]})]}),"link"===e.field_type&&(0,t.jsx)("input",{type:"url",value:e.field_value,onChange:e=>{let t=[...ee];t[r].field_value=e.target.value,et(t)},placeholder:"https://example.com",className:"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"})]},r)),0===ee.length&&(0,t.jsx)("div",{className:"text-xs text-gray-500 py-2 text-center",children:"Brak dodatkowych pÃ³l"})]})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("button",{onClick:()=>{if(Z){let e=Z.target,t=Z.source;eV(r=>r.map(r=>r.id===Z.id?{...r,source:e,target:t}:r)),X({...Z,source:e,target:t})}},className:"w-full px-3 py-1.5 bg-white/[0.04] border border-white/10 text-gray-300 rounded text-sm font-medium hover:bg-white/5 hover:border-[#fee715]/30 hover:text-[#fee715] transition-colors flex items-center justify-center gap-1.5",title:"OdwrÃ³Ä‡ kierunek strzaÅ‚ki",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"OdwrÃ³Ä‡ kierunek"]})}),(0,t.jsxs)("div",{className:"flex gap-2 pt-3 mt-3 border-t border-white/10",children:[(0,t.jsx)("button",{onClick:tX,className:"relative flex-1 px-3 py-1.5 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded text-sm font-medium hover:bg-[#fee715]/15 hover:border-[#fee715]/50 transition-colors",children:(0,t.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Zapisz zmiany",to&&(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-[#fee715] rounded-full animate-pulse",title:"Masz niezapisane zmiany"})]})}),(0,t.jsx)("button",{onClick:()=>{Z&&(tC(),eV(e=>e.filter(e=>e.id!==Z.id)),X(null),eo(!1))},title:"Delete / Backspace",className:"px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors",children:"UsuÅ„"})]}),(0,t.jsx)("p",{className:"text-[11px] text-gray-500 mt-2",children:"Delete / Backspace â€” usuwa strzaÅ‚kÄ™."})]})]}),R&&W&&(0,t.jsxs)("div",{className:"w-72 border-l border-white/10 p-4 overflow-y-auto overflow-x-visible bg-[#0a0f14]/98 nodrag nopan",style:{zIndex:10},onKeyDown:e=>{["INPUT","TEXTAREA","SELECT"].includes(e.target?.tagName)&&e.stopPropagation()},onKeyUp:e=>{["INPUT","TEXTAREA","SELECT"].includes(e.target?.tagName)&&e.stopPropagation()},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"font-medium text-white text-sm tracking-tight",children:"text"===W.type?"WÅ‚aÅ›ciwoÅ›ci tekstu":"WÅ‚aÅ›ciwoÅ›ci"}),(0,t.jsx)("button",{onClick:()=>{I(!1),F(null)},className:"p-0.5 hover:bg-white/5 rounded text-gray-500 hover:text-gray-300 transition-colors",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),"text"===W.type?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Tekst"}),(0,t.jsx)("textarea",{value:G.text,onChange:e=>V({...G,text:e.target.value}),className:"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 min-h-[72px]",placeholder:"Wpisz tekst..."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Rozmiar czcionki"}),(0,t.jsx)("input",{type:"number",min:"10",max:"72",value:G.fontSize,onChange:e=>V({...G,fontSize:parseInt(e.target.value)||18}),className:"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Waga czcionki"}),(0,t.jsx)(h.CustomSelect,{size:"sm",value:G.fontWeight||"bold",onChange:e=>V({...G,fontWeight:e}),options:[{value:"normal",label:"Normal"},{value:"semibold",label:"Semibold"},{value:"bold",label:"Bold"}],className:"w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"WyrÃ³wnanie poziome"}),(0,t.jsx)(h.CustomSelect,{size:"sm",value:G.textAlign||"left",onChange:e=>V({...G,textAlign:e}),options:[{value:"left",label:"Lewo"},{value:"center",label:"Åšrodek"},{value:"right",label:"Prawo"}],className:"w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"WyrÃ³wnanie pionowe"}),(0,t.jsx)(h.CustomSelect,{size:"sm",value:G.verticalAlign||"middle",onChange:e=>V({...G,verticalAlign:e}),options:[{value:"top",label:"GÃ³ra"},{value:"middle",label:"Åšrodek"},{value:"bottom",label:"DÃ³Å‚"}],className:"w-full"})]}),(0,t.jsx)("div",{className:"pt-0.5",children:(0,t.jsx)(m.CustomCheckbox,{id:"showHandles",checked:G.showHandles??!1,onChange:e=>V({...G,showHandles:e}),label:"Punkty poÅ‚Ä…czenia",size:"sm",labelClassName:"text-xs font-medium text-gray-400"})}),(0,t.jsxs)("div",{className:"flex gap-2 pt-3 mt-3 border-t border-white/10",children:[(0,t.jsx)("button",{onClick:tV,className:"relative flex-1 px-3 py-1.5 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded text-sm font-medium hover:bg-[#fee715]/15 hover:border-[#fee715]/50 transition-colors",children:(0,t.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Zapisz zmiany",tt&&(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-[#fee715] rounded-full animate-pulse",title:"Masz niezapisane zmiany"})]})}),(0,t.jsx)("button",{onClick:tZ,className:"px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors",children:"UsuÅ„"})]})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Nazwa"}),(0,t.jsx)("input",{type:"text",value:$.label,onChange:e=>H({...$,label:e.target.value}),className:"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30",placeholder:"Nazwa elementu"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Ikona"}),(0,t.jsx)(p.IconPicker,{value:$.icon,onChange:e=>H({...$,icon:e}),className:"w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Notatki"}),(0,t.jsx)("textarea",{value:$.notes,onChange:e=>H({...$,notes:e.target.value}),className:"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30 min-h-[72px]",placeholder:"Notatki (np. CPC: 2 PLN)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Link"}),(0,t.jsx)("input",{type:"url",value:$.link||"",onChange:e=>H({...$,link:e.target.value}),className:"w-full bg-white/[0.04] border border-white/10 rounded px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30",placeholder:"https://example.com"})]}),(0,t.jsxs)("div",{className:"pt-3 mt-3 border-t border-white/10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400",children:"Dodatkowe pola"}),(0,t.jsx)("button",{onClick:()=>{q([...U,{field_name:"",field_type:"text",field_value:"",display_order:U.length}])},className:"px-2 py-1 text-xs bg-white/[0.06] border border-white/20 text-white/90 rounded hover:bg-white/10 hover:border-white/30 transition-colors",children:"+ Dodaj pole"})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:U.map((e,r)=>(0,t.jsxs)("div",{className:"p-2 bg-white/[0.02] border border-white/5 rounded",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("input",{type:"text",value:e.field_name,onChange:e=>{let t=[...U];t[r].field_name=e.target.value,q(t)},placeholder:"Nazwa pola",className:"flex-1 bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"}),(0,t.jsx)(h.CustomSelect,{size:"sm",value:e.field_type,onChange:e=>{let t=[...U];t[r].field_type=e,t[r].field_value="",q(t)},options:[{value:"text",label:"Tekst"},{value:"date",label:"Data"},{value:"number",label:"Liczba"},{value:"link",label:"Link"}],className:"w-24"})]}),"text"===e.field_type&&(0,t.jsx)("input",{type:"text",value:e.field_value,onChange:e=>{let t=[...U];t[r].field_value=e.target.value,q(t)},placeholder:"WartoÅ›Ä‡ tekstowa",className:"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"}),"date"===e.field_type&&(0,t.jsx)(eO,{value:e.field_value,onChange:e=>{let t=[...U];t[r].field_value=e,q(t)}}),"number"===e.field_type&&(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("input",{type:"text",inputMode:"numeric",value:e.field_value,onChange:e=>{let t=e.target.value.replace(/[^0-9.-]/g,""),o=[...U];o[r].field_value=t,q(o)},placeholder:"WartoÅ›Ä‡ liczbowa",className:"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 pr-12 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"}),(0,t.jsxs)("div",{className:"absolute right-0.5 top-0 bottom-0 w-11 flex flex-col",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{let t=parseFloat(e.field_value)||0,o=[...U];o[r].field_value=String(t+1),q(o)},className:"flex-1 px-1 bg-white/[0.08] hover:bg-white/[0.15] border-l border-white/20 rounded-tl text-white/70 hover:text-white transition-colors flex items-center justify-center",title:"ZwiÄ™ksz",children:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),(0,t.jsx)("div",{className:"h-px bg-white/20"}),(0,t.jsx)("button",{type:"button",onClick:()=>{let t=parseFloat(e.field_value)||0,o=[...U];o[r].field_value=String(Math.max(0,t-1)),q(o)},className:"flex-1 px-1 bg-white/[0.08] hover:bg-white/[0.15] border-l border-white/20 rounded-bl text-white/70 hover:text-white transition-colors flex items-center justify-center",title:"Zmniejsz",children:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),"link"===e.field_type&&(0,t.jsx)("input",{type:"url",value:e.field_value,onChange:e=>{let t=[...U];t[r].field_value=e.target.value,q(t)},placeholder:"https://example.com",className:"w-full bg-white/[0.04] border border-white/10 rounded px-2 py-1 text-xs text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-[#fee715]/40 focus:border-[#fee715]/30"}),(0,t.jsx)("div",{className:"flex justify-end mt-2",children:(0,t.jsxs)("button",{onClick:()=>{q(U.filter((e,t)=>t!==r))},className:"px-2 py-1 text-xs text-gray-400 hover:text-red-400 transition-colors flex items-center gap-1",title:"UsuÅ„ pole",children:[(0,t.jsx)(ey.Trash,{size:14,weight:"regular"}),(0,t.jsx)("span",{children:"UsuÅ„"})]})})]},r))})]}),(0,t.jsxs)("div",{className:"pt-3 mt-3 border-t border-white/10",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-400 mb-2",children:"Zapisz jako wÅ‚asny szablon"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.CustomSelect,{size:"sm",value:$.category||"DziaÅ‚ania",onChange:e=>H({...$,category:e}),options:[{value:"Å¹rÃ³dÅ‚a Ruchu",label:"Å¹rÃ³dÅ‚a Ruchu"},{value:"Typ Strony",label:"Typ Strony"},{value:"DziaÅ‚ania",label:"DziaÅ‚ania"},{value:"Cel/Konwersja",label:"Cel/Konwersja"},{value:"NarzÄ™dzia",label:"NarzÄ™dzia"}],className:"w-full"}),(0,t.jsx)("button",{onClick:async()=>{if(!$.label||!$.icon)return void ej({isOpen:!0,title:"BÅ‚Ä…d",message:"WypeÅ‚nij nazwÄ™ i wybierz ikonÄ™ przed zapisaniem szablonu.",type:"error"});let e=W?.data?.color||"#fee715";await tP($.label,$.icon,e,$.category||"DziaÅ‚ania")},className:"w-full px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors",children:"Zapisz jako szablon"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-3 mt-3 border-t border-white/10",children:[(0,t.jsx)("button",{onClick:tV,className:"relative flex-1 px-3 py-1.5 bg-[#fee715]/10 border border-[#fee715]/40 text-[#fee715] rounded text-sm font-medium hover:bg-[#fee715]/15 hover:border-[#fee715]/50 transition-colors",children:(0,t.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Zapisz zmiany",e9&&(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-[#fee715] rounded-full animate-pulse",title:"Masz niezapisane zmiany"})]})}),(0,t.jsx)("button",{onClick:tZ,className:"px-3 py-1.5 bg-white/[0.06] border border-white/20 text-white/90 rounded text-sm font-medium hover:bg-white/10 hover:border-white/30 transition-colors",children:"UsuÅ„"})]})]})]})]}),(0,t.jsx)(c.AlertModal,{isOpen:ev.isOpen,title:ev.title,message:ev.message,type:ev.type,onClose:()=>ej(e=>({...e,isOpen:!1}))}),eC&&b&&(0,t.jsx)(x.CommentPanel,{funnelId:b,isOpen:eC,onClose:()=>{ez(!1),e_(null)},onJumpToAnchor:(e,t,r)=>{if("node"===e&&t){let e=eH.find(e=>e.id===t);e&&ta&&(ta.setCenter(e.position.x,e.position.y,{zoom:1,duration:500}),F(e),I(!0))}else if("edge"===e&&t){let e=eG.find(e=>e.id===t);if(e&&ta){let t=eH.find(t=>t.id===e.source);t&&(ta.setCenter(t.position.x,t.position.y,{zoom:1,duration:500}),X(e),eo(!0))}}else"region"===e&&r&&ta&&ta.setCenter(r.x,r.y,{zoom:1,duration:500})},onThreadClick:e=>{e_(e)}}),eS&&b&&(0,t.jsx)(f.CommentThread,{threadId:eS,funnelId:b,onClose:()=>{e_(null),t_()},onUpdate:()=>{t_()}}),eT&&b&&(0,t.jsx)(g.CommentForm,{funnelId:b,anchorType:eT.type,anchorId:eT.id,regionCoords:eT.coords,onClose:()=>{eW(null)},onSuccess:()=>{eW(null),t_(),e$(e=>e+1),eC||ez(!0)}})]}):(0,t.jsx)("div",{className:"h-screen bg-[#101820] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-white",children:[(0,t.jsx)("p",{className:"text-lg mb-4",children:"Lejek nie zostaÅ‚ znaleziony"}),(0,t.jsx)("button",{onClick:()=>v.push("/panel/marketing"),className:"px-5 py-2.5 bg-[#fee715]/10 border border-[#fee715]/50 text-[#fee715] rounded-lg font-medium hover:bg-[#fee715]/20 hover:border-[#fee715]/70 transition-all duration-200",children:"WrÃ³Ä‡ do listy"})]})})}e.s(["DatePickerField",0,eO,"default",()=>eW])}]);