(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16020,15420,70920,60754,46986,84279,e=>{"use strict";var t=e.i(29883),a=e.i(45366),s=e.i(55041),r=e.i(23448),i=e.i(87423),n=e.i(49404),l=e.i(60564),o=e.i(84134),d=e.i(90410);e.s(["AdminCoursesTab",0,()=>{let e,{user:c}=(0,s.useAuth)(),[m,u]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[p,g]=(0,a.useState)(null),[b,f]=(0,a.useState)([]),[w,y]=(0,a.useState)(null),[j,k]=(0,a.useState)(""),[v,N]=(0,a.useState)(!1),[_,z]=(0,a.useState)(!0),[C,L]=(0,a.useState)(!1),[M,O]=(0,a.useState)(null),[S,B]=(0,a.useState)({isOpen:!1,title:"",message:"",type:"info"});(0,a.useEffect)(()=>{c&&A()},[c]),(0,a.useEffect)(()=>{p&&W(p)},[p]);let A=async()=>{if(c)try{let{data:e,error:t}=await r.supabase.from("profiles").select("id, full_name, company_name, first_name, last_name, phone, notes, created_at").order("created_at",{ascending:!1});if(t)throw console.error("AdminPanel - bÅ‚Ä…d pobierania profiles:",t),t;let a=await Promise.all((e||[]).map(async e=>{try{let{data:t,error:a}=await r.supabase.rpc("get_user_email",{user_id:e.id});return{...e,email:a?null:t||null}}catch(t){return{...e,email:null}}}));u(a);let s=[];for(let e of a){let t=i.trainingModules.reduce((e,t)=>e+t.lessons.length,0),{data:a}=await r.supabase.from("course_certificates").select("course_completed, course_ready_to_complete").eq("user_id",e.id).maybeSingle(),n=a?.course_completed||!1,l=a?.course_ready_to_complete||!1,o=n||l,{data:d}=await r.supabase.from("training_progress").select("*").eq("user_id",e.id),{data:c}=await r.supabase.from("training_responses").select("*").eq("user_id",e.id),m=0,u=[];i.trainingModules.forEach(e=>{let t=d?.find(t=>t.module_code===`modul_${e.id}`),a=c?.filter(t=>t.module_code===`modul_${e.id}`)||[],s=e.lessons.filter(t=>!!o||(0===t.quiz.length?d?.some(a=>a.module_code===`modul_${e.id}`&&a.last_step_code===t.id)||!1:t.quiz.every(e=>{let s=a.find(a=>a.step_code===t.id&&a.question_code===e.id);return!!s&&("choice"===e.type?Number(s.answer_text)===e.correctAnswer:"approved"===s.status)}))).length;m+=s,u.push({moduleId:e.id,moduleTitle:e.title,completed:t?.module_completed||!1,percentage:e.lessons.length>0?Math.round(s/e.lessons.length*100):0})});let x=t>0?Math.round(m/t*100):0,h=c?.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())[0],p=h?.created_at||e.created_at;s.push({userId:e.id,userName:e.full_name||e.email?.split("@")[0]||"UÅ¼ytkownik",userEmail:e.email||"",totalLessons:t,completedLessons:m,percentage:x,lastActivity:p,modules:u})}h(s),z(!1)}catch(e){console.error("BÅ‚Ä…d Å‚adowania uÅ¼ytkownikÃ³w:",e),z(!1)}},W=async e=>{try{let{data:t,error:a}=await r.supabase.from("training_responses").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;f(t||[])}catch(e){console.error("BÅ‚Ä…d Å‚adowania odpowiedzi:",e)}},$=async()=>{if(p){L(!0);try{await W(p),B({isOpen:!0,title:"OdÅ›wieÅ¼ono",message:"Lista odpowiedzi zostaÅ‚a zaktualizowana.",type:"success"})}catch(e){console.error("BÅ‚Ä…d odÅ›wieÅ¼ania odpowiedzi:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ odÅ›wieÅ¼yÄ‡ odpowiedzi.",type:"error"})}finally{L(!1)}}},E=async(e,t)=>{t.stopPropagation(),O(e);try{let{error:t}=await r.supabase.from("training_responses").update({status:"approved",admin_feedback:null,reviewed_by:c?.id,reviewed_at:new Date().toISOString()}).eq("id",e);if(t)throw t;f(t=>t.map(t=>t.id===e?{...t,status:"approved",admin_feedback:null}:t)),p&&await A(),B({isOpen:!0,title:"Zatwierdzono",message:"OdpowiedÅº zostaÅ‚a szybko zatwierdzona.",type:"success"})}catch(e){console.error("BÅ‚Ä…d szybkiego zatwierdzenia:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zatwierdziÄ‡ odpowiedzi.",type:"error"})}finally{O(null)}},H=async(e,t)=>{if(c){N(!0);try{let{error:a}=await r.supabase.from("training_responses").update({status:t,admin_feedback:j||null,reviewed_by:c.id,reviewed_at:new Date().toISOString()}).eq("id",e);if(a)throw a;await W(p),await A(),y(null),k(""),B({isOpen:!0,title:"Sukces",message:"approved"===t?"OdpowiedÅº zostaÅ‚a zatwierdzona.":"OdpowiedÅº zostaÅ‚a odrzucona.",type:"success"})}catch(e){console.error("BÅ‚Ä…d weryfikacji odpowiedzi:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"WystÄ…piÅ‚ bÅ‚Ä…d podczas weryfikacji odpowiedzi. SprÃ³buj ponownie.",type:"error"})}finally{N(!1)}}};if(_)return(0,t.jsx)(l.LoadingState,{variant:"block",skeleton:"rows",label:"Åadowanie kursantÃ³wâ€¦"});let q=x.find(e=>e.userId===p),P=b.filter(e=>"pending"===e.status),Z=w?(0,i.findLesson)(w.step_code):null,D=Z?.quiz.find(e=>e.id===w?.question_code);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,t.jsx)("h2",{className:"font-[Montserrat] text-2xl font-bold mb-4",children:"Kursanci"}),0===x.length?(0,t.jsx)("div",{className:"text-center text-gray-400 py-8 bg-white/5 rounded-xl",children:"Brak kursantÃ³w"}):x.map(e=>{let a;return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{onClick:()=>g(p===e.userId?null:e.userId),className:`bg-gradient-to-br from-white/5 to-white/3 rounded-xl p-4 border-2 cursor-pointer transition-all duration-300 ${p===e.userId?"border-[#fee715] shadow-lg shadow-[#fee715]/20":"border-white/10 hover:border-white/20"}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("p",{className:"text-sm text-gray-300 truncate font-medium",children:e.userEmail})}),(0,t.jsxs)("div",{className:"flex items-center gap-3 ml-4",children:[(0,t.jsx)("div",{className:"w-20 bg-white/10 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-gradient-to-r from-[#fee715] to-[#00C9A7] h-2 rounded-full transition-all duration-300",style:{width:`${e.percentage}%`}})}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("div",{className:"text-lg font-bold text-[#fee715]",children:[e.percentage,"%"]})}),(0,t.jsx)("svg",{className:`w-5 h-5 text-gray-400 transition-transform duration-300 ${p===e.userId?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),p===e.userId&&(0,t.jsxs)("div",{className:"mt-3 bg-gradient-to-br from-white/5 to-white/3 rounded-xl p-6 border border-white/10 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-[Montserrat] font-bold text-white mb-3 text-lg",children:e.userName}),(a=m.find(t=>t.id===e.userId))&&(0,t.jsxs)("div",{className:"space-y-2 text-sm text-gray-300",children:[a.company_name&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"ðŸ¢"}),(0,t.jsx)("span",{children:a.company_name})]}),a.phone&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Phone,{size:16,weight:"regular",className:"text-gray-500"}),(0,t.jsx)("span",{children:a.phone})]}),(a.first_name||a.last_name)&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.User,{size:16,weight:"regular",className:"text-gray-500"}),(0,t.jsx)("span",{children:[a.first_name,a.last_name].filter(Boolean).join(" ")})]})]})]}),(0,t.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("span",{className:"text-sm text-gray-400",children:"PostÄ™p ogÃ³lny"}),(0,t.jsxs)("span",{className:"text-sm font-semibold text-white",children:[e.completedLessons,"/",e.totalLessons," lekcji"]})]}),(0,t.jsx)("div",{className:"w-full bg-white/10 rounded-full h-3 mb-4",children:(0,t.jsx)("div",{className:"bg-gradient-to-r from-[#fee715] to-[#00C9A7] h-3 rounded-full transition-all duration-300",style:{width:`${e.percentage}%`}})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"PostÄ™p w moduÅ‚ach:"}),e.modules.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-gray-400",children:["ModuÅ‚ ",e.moduleId]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-24 bg-white/10 rounded-full h-2",children:(0,t.jsx)("div",{className:`h-2 rounded-full transition-all duration-300 ${e.completed?"bg-gradient-to-r from-green-400 to-green-500":"bg-gradient-to-r from-[#fee715] to-[#00C9A7]"}`,style:{width:`${e.percentage}%`}})}),(0,t.jsxs)("span",{className:`font-semibold text-xs w-12 text-right ${e.completed?"text-green-400":"text-gray-400"}`,children:[e.percentage,"%"]})]})]},e.moduleId))]})]}),P.length>0&&(0,t.jsx)("div",{className:"pt-3 border-t border-white/10",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400 text-sm font-semibold",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),P.length," ",1===P.length?"odpowiedÅº oczekuje":"odpowiedzi oczekuje"," na weryfikacjÄ™"]})})]})]},e.userId)})]}),(0,t.jsx)("div",{className:"lg:col-span-2 space-y-6",children:p?(0,t.jsxs)(t.Fragment,{children:[q&&(e=m.find(e=>e.id===q.userId),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-white/5 to-white/3 rounded-xl p-6 border-2 border-white/10",children:[(0,t.jsxs)("h3",{className:"font-[Montserrat] text-xl font-bold text-white mb-4",children:["PostÄ™p: ",q.userName]}),e&&(0,t.jsxs)("div",{className:"mb-6 p-4 bg-white/5 rounded-lg border border-white/10",children:[(0,t.jsx)("h4",{className:"font-[Montserrat] font-semibold text-white mb-3",children:"Dane kontaktowe"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[e.company_name&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Firma:"}),(0,t.jsx)("span",{children:e.company_name})]}),(e.first_name||e.last_name)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"ImiÄ™ i nazwisko:"}),(0,t.jsx)("span",{children:[e.first_name,e.last_name].filter(Boolean).join(" ")})]}),e.phone&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Telefon:"}),(0,t.jsx)("span",{children:e.phone})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Email:"}),(0,t.jsx)("span",{children:q.userEmail})]}),e.notes&&(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/10",children:[(0,t.jsx)("p",{className:"text-gray-500 mb-1",children:"Notatki/Cele biznesowe:"}),(0,t.jsx)("p",{className:"text-gray-300 whitespace-pre-wrap",children:e.notes})]})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"UkoÅ„czone lekcje"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-white",children:[q.completedLessons,"/",q.totalLessons]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"PostÄ™p ogÃ³lny"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-[#fee715]",children:[q.percentage,"%"]})]})]}),100===q.percentage&&(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,t.jsxs)("button",{onClick:async()=>{if(p&&confirm("Czy na pewno chcesz oznaczyÄ‡ kurs jako gotowy do zakoÅ„czenia? UÅ¼ytkownik zobaczy ekran koÅ„cowy z formularzem certyfikatu."))try{N(!0);let{data:e}=await r.supabase.from("course_certificates").select("id").eq("user_id",p).maybeSingle();if(e){let{error:e}=await r.supabase.from("course_certificates").update({course_ready_to_complete:!0}).eq("user_id",p);if(e)throw e}else{let{error:e}=await r.supabase.from("course_certificates").insert({user_id:p,full_name:"",company_name:"",email:q.userEmail,course_ready_to_complete:!0});if(e)throw e}B({isOpen:!0,title:"Sukces",message:"Kurs zostaÅ‚ oznaczony jako gotowy do zakoÅ„czenia. UÅ¼ytkownik zobaczy ekran koÅ„cowy z formularzem certyfikatu.",type:"success"})}catch(e){console.error("BÅ‚Ä…d oznaczania kursu:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"WystÄ…piÅ‚ bÅ‚Ä…d podczas oznaczania kursu: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}finally{N(!1)}},disabled:v,className:"w-full bg-gradient-to-r from-[#fee715] to-[#00C9A7] text-[#101820] font-[Montserrat] font-bold py-3 px-6 rounded-xl hover:shadow-2xl hover:shadow-[#fee715]/40 transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-3",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})}),v?"Oznaczanie...":"ZakoÅ„cz Szkolenie"]}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-2 text-center",children:"Oznaczy kurs jako gotowy do zakoÅ„czenia. UÅ¼ytkownik zobaczy ekran koÅ„cowy z formularzem certyfikatu."})]})]})),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h3",{className:"font-[Montserrat] text-xl font-bold text-white",children:["Odpowiedzi (",b.length,")"]}),(0,t.jsxs)("button",{onClick:$,disabled:C,className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-gray-300 hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-semibold",children:[(0,t.jsx)("svg",{className:`w-4 h-4 ${C?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),C?"OdÅ›wieÅ¼anie...":"OdÅ›wieÅ¼"]})]}),(0,t.jsx)("div",{className:"space-y-4",children:0===b.length?(0,t.jsx)("div",{className:"bg-white/5 rounded-xl p-8 text-center text-gray-400",children:"Brak odpowiedzi"}):b.map(e=>{let a=(0,i.findLesson)(e.step_code),s=a?.quiz.find(t=>t.id===e.question_code);return(0,t.jsxs)("div",{onClick:()=>y(e),className:`bg-gradient-to-br from-white/5 to-white/3 rounded-xl p-6 border-2 cursor-pointer transition-all duration-300 relative ${w?.id===e.id?"border-[#fee715] shadow-lg shadow-[#fee715]/20":"border-white/10 hover:border-white/20"}`,children:["pending"===e.status&&(0,t.jsx)("button",{onClick:t=>E(e.id,t),disabled:M===e.id,className:"absolute top-4 right-4 p-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 border border-green-500/50 text-green-300 hover:text-green-200 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed z-10",title:"Szybkie zatwierdzenie",children:M===e.id?(0,t.jsx)("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("div",{className:"flex items-start justify-between mb-3 pr-12",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsxs)("span",{className:"px-3 py-1 rounded-lg bg-white/10 text-xs font-semibold",children:[e.module_code.replace("modul_","ModuÅ‚ ")," â€¢ ",e.step_code]}),(0,t.jsx)("span",{className:`px-3 py-1 rounded-lg text-xs font-semibold ${"pending"===e.status?"bg-yellow-500/20 text-yellow-300 border border-yellow-500/50":"approved"===e.status?"bg-green-500/20 text-green-300 border border-green-500/50":"bg-red-500/20 text-red-300 border border-red-500/50"}`,children:"pending"===e.status?"Oczekuje":"approved"===e.status?"Zatwierdzona":"Odrzucona"})]}),(0,t.jsx)("h4",{className:"font-[Montserrat] font-bold text-white mb-2",children:s?.question||"Pytanie"}),(0,t.jsx)("div",{className:"bg-white/5 rounded-lg p-3",children:(0,t.jsx)("p",{className:"text-gray-300 text-sm line-clamp-2",children:e.answer_text})})]})}),e.admin_feedback&&(0,t.jsx)("div",{className:"mt-3 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-blue-200",children:["Feedback: ",e.admin_feedback]})})]},e.id)})})]})]}):(0,t.jsx)("div",{className:"bg-white/5 rounded-xl p-12 text-center text-gray-400",children:"Wybierz kursanta, aby zobaczyÄ‡ szczegÃ³Å‚y"})})]}),w&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>y(null)}),(0,t.jsxs)("div",{className:"relative bg-gradient-to-br from-[#18232F] to-[#101820] rounded-2xl p-6 border-2 border-white/10 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] text-2xl font-bold text-white mb-6",children:"Weryfikacja odpowiedzi"}),(0,t.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Pytanie"}),(0,t.jsx)("p",{className:"text-white bg-white/5 rounded-lg p-3",children:D?.question||"Brak pytania"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"OdpowiedÅº"}),(0,t.jsx)("div",{className:"bg-white/5 rounded-lg p-4 max-h-48 overflow-y-auto",children:(0,t.jsx)("p",{className:"text-gray-200 whitespace-pre-wrap",children:w.answer_text})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Feedback (opcjonalnie)"}),(0,t.jsx)("textarea",{value:j,onChange:e=>k(e.target.value),placeholder:"Dodaj komentarz dla kursanta...",className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715] min-h-[100px]"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>H(w.id,"approved"),disabled:v,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white font-[Montserrat] font-bold py-3 px-4 rounded-xl hover:shadow-lg hover:shadow-green-500/40 transition-all duration-300 disabled:opacity-50",children:"ZatwierdÅº"}),(0,t.jsx)("button",{onClick:()=>H(w.id,"rejected"),disabled:v,className:"flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white font-[Montserrat] font-bold py-3 px-4 rounded-xl hover:shadow-lg hover:shadow-red-500/40 transition-all duration-300 disabled:opacity-50",children:"OdrzuÄ‡"}),(0,t.jsx)("button",{onClick:()=>{y(null),k("")},className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white font-[Montserrat] font-semibold rounded-xl transition-all duration-300",children:"Zamknij"})]})]})]}),(0,t.jsx)(n.AlertModal,{isOpen:S.isOpen,title:S.title,message:S.message,type:S.type,onClose:()=>B(e=>({...e,isOpen:!1}))})]})}],16020);var c=e.i(7495);let m=({isOpen:e,title:a,message:s,confirmText:r="PotwierdÅº",cancelText:i="Anuluj",onConfirm:n,onCancel:l,type:o="warning"})=>{if(!e)return null;let d={warning:{icon:(0,t.jsx)("svg",{className:"w-8 h-8 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),confirmBg:"bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700"},danger:{icon:(0,t.jsx)("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),confirmBg:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700"},info:{icon:(0,t.jsx)("svg",{className:"w-8 h-8 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),confirmBg:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700"}}[o];return(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:l}),(0,t.jsxs)("div",{className:"relative bg-gradient-to-br from-[#18232F] to-[#101820] rounded-2xl border-2 border-white/10 shadow-2xl max-w-md w-full p-6 md:p-8 transform transition-all",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4 mb-6",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:d.icon}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] text-2xl font-bold text-white mb-2",children:a}),(0,t.jsx)("p",{className:"text-gray-300 leading-relaxed",children:s})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)("button",{onClick:l,className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white font-[Montserrat] font-semibold rounded-xl transition-all duration-300 border border-white/20",children:i}),(0,t.jsx)("button",{onClick:n,className:`px-6 py-3 text-white font-[Montserrat] font-bold rounded-xl transition-all duration-300 shadow-lg ${d.confirmBg}`,children:r})]})]})]})};var u=e.i(50187);e.s(["FunnelList",0,()=>{let{user:e}=(0,s.useAuth)(),i=(0,c.useRouter)(),[o,d]=(0,a.useState)([]),[x,h]=(0,a.useState)(!0),[p,g]=(0,a.useState)(!1),[b,f]=(0,a.useState)(!1),[w,y]=(0,a.useState)(null),[j,k]=(0,a.useState)(""),[v,N]=(0,a.useState)(null),[_,z]=(0,a.useState)("draft"),[C,L]=(0,a.useState)([]),[M,O]=(0,a.useState)("all"),[S,B]=(0,a.useState)({isOpen:!1,title:"",message:"",type:"info"}),[A,W]=(0,a.useState)({isOpen:!1,title:"",message:"",onConfirm:()=>{}});(0,a.useEffect)(()=>{e&&(E(),$())},[e,M]);let $=async()=>{try{let{data:e,error:t}=await r.supabase.from("marketing_clients").select("id, name, company_name").eq("status","active").order("name",{ascending:!0});if(t)throw t;L(e||[])}catch(e){console.error("BÅ‚Ä…d Å‚adowania klientÃ³w:",e)}},E=async()=>{try{h(!0);let e=r.supabase.from("funnel_diagrams").select(`
          *,
          client:marketing_clients(id, name, company_name)
        `).order("updated_at",{ascending:!1});"all"!==M&&(e=e.eq("status",M));let{data:t,error:a}=await e;if(a)throw a;d((t||[]).map(e=>({...e,client:Array.isArray(e.client)?e.client[0]:e.client})))}catch(e){console.error("BÅ‚Ä…d Å‚adowania lejkÃ³w:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ lejkÃ³w: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}finally{h(!1)}},H=async()=>{if(!e||!j.trim())return void B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nazwa projektu jest wymagana.",type:"error"});try{let{data:t,error:a}=await r.supabase.from("funnel_diagrams").insert({project_name:j.trim(),client_id:v||null,created_by:e.id,diagram_data:{nodes:[],edges:[],viewport:{x:0,y:0,zoom:1}},status:"draft"}).select().single();if(a)throw a;if(v&&e){let{error:a}=await r.supabase.from("funnel_access").insert({funnel_id:t.id,client_id:v,access_level:"view",granted_by:e.id});a&&console.warn("BÅ‚Ä…d tworzenia wpisu w funnel_access:",a)}B({isOpen:!0,title:"Sukces",message:"Lejek zostaÅ‚ utworzony.",type:"success"}),g(!1),k(""),N(null),i.push(`/admin/marketing/${t.id}`)}catch(e){console.error("BÅ‚Ä…d tworzenia lejka:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ utworzyÄ‡ lejka: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}},q=async()=>{if(!w||!j.trim()||!e)return void B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nazwa projektu jest wymagana.",type:"error"});try{let{error:t}=await r.supabase.from("funnel_diagrams").update({project_name:j.trim(),client_id:v||null,status:_}).eq("id",w.id);if(t)throw t;if(v){let{data:t}=await r.supabase.from("funnel_access").select("id").eq("funnel_id",w.id).eq("client_id",v).single();if(!t){let{error:t}=await r.supabase.from("funnel_access").insert({funnel_id:w.id,client_id:v,access_level:"view",granted_by:e.id});t&&console.warn("BÅ‚Ä…d tworzenia wpisu w funnel_access:",t)}}B({isOpen:!0,title:"Sukces",message:"Lejek zostaÅ‚ zaktualizowany.",type:"success"}),f(!1),y(null),k(""),N(null),z("draft"),await E()}catch(e){console.error("BÅ‚Ä…d aktualizacji lejka:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zaktualizowaÄ‡ lejka: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}},P=async t=>{try{let{data:a,error:s}=await r.supabase.from("funnel_diagrams").insert({project_name:`${t.project_name} (Kopia)`,client_id:t.client_id,created_by:e?.id,diagram_data:t.diagram_data,status:"draft"}).select().single();if(s)throw s;B({isOpen:!0,title:"Sukces",message:"Lejek zostaÅ‚ skopiowany.",type:"success"}),await E()}catch(e){console.error("BÅ‚Ä…d kopiowania lejka:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ skopiowaÄ‡ lejka: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}},Z="all"===M?o:o.filter(e=>e.status===M);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-[Montserrat] text-2xl font-bold text-white mb-2",children:"Lejki Marketingowe"}),(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"TwÃ³rz i zarzÄ…dzaj lejkami marketingowymi dla swoich klientÃ³w"})]}),(0,t.jsxs)("button",{onClick:()=>g(!0),className:"px-6 py-3 bg-gradient-to-r from-[#fee715] to-[#00C9A7] text-[#101820] font-[Montserrat] font-bold rounded-xl hover:shadow-2xl hover:shadow-[#fee715]/40 transform hover:scale-105 transition-all duration-300 flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nowy Lejek"]})]}),(0,t.jsxs)("div",{className:"mb-6 flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>O("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"all"===M?"bg-[#fee715] text-[#101820]":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Wszystkie"}),(0,t.jsx)("button",{onClick:()=>O("draft"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"draft"===M?"bg-yellow-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Szkice"}),(0,t.jsx)("button",{onClick:()=>O("active"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"active"===M?"bg-green-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Aktywne"}),(0,t.jsx)("button",{onClick:()=>O("archived"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"archived"===M?"bg-gray-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Zarchiwizowane"})]}),x?(0,t.jsx)(l.LoadingState,{variant:"block",skeleton:"cards",label:"Åadowanie lejkÃ³wâ€¦"}):0===Z.length?(0,t.jsxs)("div",{className:"bg-white/5 rounded-xl p-12 text-center text-gray-400",children:[(0,t.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),(0,t.jsx)("p",{className:"text-lg mb-2",children:"Brak lejkÃ³w"}),(0,t.jsx)("p",{className:"text-sm",children:'Kliknij "Nowy Lejek", aby rozpoczÄ…Ä‡'})]}):(0,t.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Z.map(e=>{let a=e.diagram_data?.nodes?.length||0,s=e.diagram_data?.edges?.length||0;return(0,t.jsxs)("div",{className:"bg-gradient-to-br from-white/5 to-white/3 rounded-xl p-6 border-2 border-white/10 hover:border-[#fee715]/50 transition-all duration-300 cursor-pointer",onClick:()=>i.push(`/admin/marketing/${e.id}`),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] font-bold text-white text-lg mb-1",children:e.project_name}),e.client&&(0,t.jsxs)("p",{className:"text-gray-400 text-sm",children:[e.client.name,e.client.company_name&&` â€¢ ${e.client.company_name}`]})]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${"active"===e.status?"bg-green-500/20 text-green-300 border border-green-500/50":"draft"===e.status?"bg-yellow-500/20 text-yellow-300 border border-yellow-500/50":"bg-gray-500/20 text-gray-300 border border-gray-500/50"}`,children:"active"===e.status?"Aktywny":"draft"===e.status?"Szkic":"Zarchiwizowany"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-400 mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsxs)("span",{children:[a," elementÃ³w"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})}),(0,t.jsxs)("span",{children:[s," poÅ‚Ä…czeÅ„"]})]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mb-4",children:["Ostatnia aktualizacja: ",new Date(e.updated_at).toLocaleDateString("pl-PL")]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-white/10",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("button",{onClick:()=>i.push(`/admin/marketing/${e.id}`),className:"flex-1 px-4 py-2 bg-[#fee715] text-[#101820] rounded-lg transition-all text-sm font-semibold hover:bg-[#fee715]/90",children:"OtwÃ³rz"}),(0,t.jsx)("button",{onClick:()=>{y(e),k(e.project_name),N(e.client_id||null),z(e.status),f(!0)},className:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all text-sm font-semibold",title:"Edytuj",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,t.jsx)("button",{onClick:()=>P(e),className:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all text-sm font-semibold",title:"Duplikuj",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void W({isOpen:!0,title:"PotwierdÅº usuniÄ™cie",message:"Czy na pewno chcesz usunÄ…Ä‡ ten lejek? Ta operacja jest nieodwracalna.",onConfirm:async()=>{W({...A,isOpen:!1});try{let{error:e}=await r.supabase.from("funnel_diagrams").delete().eq("id",t);if(e)throw e;B({isOpen:!0,title:"Sukces",message:"Lejek zostaÅ‚ usuniÄ™ty.",type:"success"}),await E()}catch(e){console.error("BÅ‚Ä…d usuwania lejka:",e),B({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ usunÄ…Ä‡ lejka: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}}})},className:"px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg transition-all text-sm font-semibold",title:"UsuÅ„",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.id)})}),b&&w&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>{f(!1),y(null)}}),(0,t.jsxs)("div",{className:"relative bg-gradient-to-br from-[#18232F] to-[#101820] rounded-2xl p-6 border-2 border-white/10 max-w-md w-full",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] text-2xl font-bold text-white mb-6",children:"Edytuj Lejek Marketingowy"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Nazwa Projektu ",(0,t.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:j,onChange:e=>k(e.target.value),className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715]",placeholder:"np. Lejek sprzedaÅ¼owy Q1 2024",autoFocus:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Przypisz do Klienta (opcjonalnie)"}),(0,t.jsx)(u.CustomSelect,{value:v||"",onChange:e=>N(e||null),placeholder:"Brak przypisania",options:[{value:"",label:"âœ“ Brak przypisania"},...C.map(e=>({value:e.id,label:`${e.name}${e.company_name?` â€¢ ${e.company_name}`:""}`}))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Status"}),(0,t.jsx)(u.CustomSelect,{value:_,onChange:e=>z(e),placeholder:"Wybierz status",options:[{value:"draft",label:"Szkic"},{value:"active",label:"Aktywny"},{value:"archived",label:"Zarchiwizowany"}]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,t.jsx)("button",{onClick:q,className:"flex-1 bg-gradient-to-r from-[#fee715] to-[#00C9A7] text-[#101820] font-[Montserrat] font-bold py-3 px-4 rounded-xl hover:shadow-lg hover:shadow-[#fee715]/40 transition-all duration-300",children:"Zapisz Zmiany"}),(0,t.jsx)("button",{onClick:()=>{f(!1),y(null)},className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white font-[Montserrat] font-semibold rounded-xl transition-all duration-300",children:"Anuluj"})]})]})]}),p&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>g(!1)}),(0,t.jsxs)("div",{className:"relative bg-gradient-to-br from-[#18232F] to-[#101820] rounded-2xl p-6 border-2 border-white/10 max-w-md w-full",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] text-2xl font-bold text-white mb-6",children:"Nowy Lejek Marketingowy"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Nazwa Projektu ",(0,t.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:j,onChange:e=>k(e.target.value),className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715]",placeholder:"np. Lejek sprzedaÅ¼owy Q1 2024",autoFocus:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Przypisz do Klienta (opcjonalnie)"}),(0,t.jsx)(u.CustomSelect,{value:v||"",onChange:e=>N(e||null),placeholder:"Brak przypisania",options:[{value:"",label:"âœ“ Brak przypisania"},...C.map(e=>({value:e.id,label:`${e.name}${e.company_name?` â€¢ ${e.company_name}`:""}`}))]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,t.jsx)("button",{onClick:H,className:"flex-1 bg-gradient-to-r from-[#fee715] to-[#00C9A7] text-[#101820] font-[Montserrat] font-bold py-3 px-4 rounded-xl hover:shadow-lg hover:shadow-[#fee715]/40 transition-all duration-300",children:"UtwÃ³rz Lejek"}),(0,t.jsx)("button",{onClick:()=>g(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white font-[Montserrat] font-semibold rounded-xl transition-all duration-300",children:"Anuluj"})]})]})]}),(0,t.jsx)(n.AlertModal,{isOpen:S.isOpen,title:S.title,message:S.message,type:S.type,onClose:()=>B(e=>({...e,isOpen:!1}))}),(0,t.jsx)(m,{isOpen:A.isOpen,title:A.title,message:A.message,confirmText:"UsuÅ„",cancelText:"Anuluj",type:"danger",onConfirm:A.onConfirm,onCancel:()=>W(e=>({...e,isOpen:!1}))})]})}],15420),e.s(["ClientManagement",0,()=>{let{user:e}=(0,s.useAuth)(),[i,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(!0),[x,h]=(0,a.useState)(!1),[p,g]=(0,a.useState)(null),[b,f]=(0,a.useState)({name:"",email:"",company_name:"",phone:"",notes:"",status:"active"}),[w,y]=(0,a.useState)({isOpen:!1,title:"",message:"",type:"info"}),[j,k]=(0,a.useState)({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[v,N]=(0,a.useState)("all");(0,a.useEffect)(()=>{e&&_()},[e,v]);let _=async()=>{try{c(!0);let e=r.supabase.from("marketing_clients").select("*").order("created_at",{ascending:!1});"all"!==v&&(e=e.eq("status",v));let{data:t,error:a}=await e;if(a)throw a;o(t||[])}catch(e){console.error("BÅ‚Ä…d Å‚adowania klientÃ³w:",e),y({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ klientÃ³w: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}finally{c(!1)}},z=async()=>{if(!e||!b.name.trim())return void y({isOpen:!0,title:"BÅ‚Ä…d",message:"Nazwa klienta jest wymagana.",type:"error"});try{if(p){let{error:e}=await r.supabase.from("marketing_clients").update({name:b.name.trim(),email:b.email.trim()||null,company_name:b.company_name.trim()||null,phone:b.phone.trim()||null,notes:b.notes.trim()||null,status:b.status}).eq("id",p.id);if(e)throw e;y({isOpen:!0,title:"Sukces",message:"Klient zostaÅ‚ zaktualizowany.",type:"success"})}else{let{error:t}=await r.supabase.from("marketing_clients").insert({name:b.name.trim(),email:b.email.trim()||null,company_name:b.company_name.trim()||null,phone:b.phone.trim()||null,notes:b.notes.trim()||null,status:b.status,created_by:e.id});if(t)throw t;y({isOpen:!0,title:"Sukces",message:"Klient zostaÅ‚ dodany.",type:"success"})}h(!1),await _()}catch(e){console.error("BÅ‚Ä…d zapisywania klienta:",e),y({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zapisaÄ‡ klienta: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}},C="all"===v?i:i.filter(e=>e.status===v);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-[Montserrat] text-2xl font-bold text-white mb-2",children:"ZarzÄ…dzanie Klientami"}),(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"Dodawaj i zarzÄ…dzaj klientami marketingowymi"})]}),(0,t.jsxs)("button",{onClick:()=>{g(null),f({name:"",email:"",company_name:"",phone:"",notes:"",status:"active"}),h(!0)},className:"px-6 py-3 bg-gradient-to-r from-[#fee715] to-[#00C9A7] text-[#101820] font-[Montserrat] font-bold rounded-xl hover:shadow-2xl hover:shadow-[#fee715]/40 transform hover:scale-105 transition-all duration-300 flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Dodaj Klienta"]})]}),(0,t.jsxs)("div",{className:"mb-6 flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>N("all"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"all"===v?"bg-[#fee715] text-[#101820]":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Wszyscy"}),(0,t.jsx)("button",{onClick:()=>N("active"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"active"===v?"bg-green-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Aktywni"}),(0,t.jsx)("button",{onClick:()=>N("inactive"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"inactive"===v?"bg-yellow-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Nieaktywni"}),(0,t.jsx)("button",{onClick:()=>N("archived"),className:`px-4 py-2 rounded-lg font-semibold transition-all ${"archived"===v?"bg-gray-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"Zarchiwizowani"})]}),d?(0,t.jsx)(l.LoadingState,{variant:"block",skeleton:"cards",label:"Åadowanie klientÃ³wâ€¦"}):0===C.length?(0,t.jsxs)("div",{className:"bg-white/5 rounded-xl p-12 text-center text-gray-400",children:[(0,t.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,t.jsx)("p",{className:"text-lg mb-2",children:"Brak klientÃ³w"}),(0,t.jsx)("p",{className:"text-sm",children:'Kliknij "Dodaj Klienta", aby rozpoczÄ…Ä‡'})]}):(0,t.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(e=>(0,t.jsxs)("div",{className:"bg-gradient-to-br from-white/5 to-white/3 rounded-xl p-6 border-2 border-white/10 hover:border-[#fee715]/50 transition-all duration-300",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] font-bold text-white text-lg mb-1",children:e.name}),e.company_name&&(0,t.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:e.company_name})]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold ${"active"===e.status?"bg-green-500/20 text-green-300 border border-green-500/50":"inactive"===e.status?"bg-yellow-500/20 text-yellow-300 border border-yellow-500/50":"bg-gray-500/20 text-gray-300 border border-gray-500/50"}`,children:"active"===e.status?"Aktywny":"inactive"===e.status?"Nieaktywny":"Zarchiwizowany"})]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm text-gray-300 mb-4",children:[e.email&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),(0,t.jsx)("span",{className:"truncate",children:e.email})]}),e.phone&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),(0,t.jsx)("span",{children:e.phone})]})]}),e.notes&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-white/5 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:"Notatki:"}),(0,t.jsx)("p",{className:"text-sm text-gray-300 line-clamp-2",children:e.notes})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-white/10",children:[(0,t.jsx)("button",{onClick:()=>{g(e),f({name:e.name,email:e.email||"",company_name:e.company_name||"",phone:e.phone||"",notes:e.notes||"",status:e.status}),h(!0)},className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all text-sm font-semibold",children:"Edytuj"}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void k({isOpen:!0,title:"PotwierdÅº usuniÄ™cie",message:"Czy na pewno chcesz usunÄ…Ä‡ tego klienta? Ta operacja jest nieodwracalna.",onConfirm:async()=>{k({...j,isOpen:!1});try{let{error:e}=await r.supabase.from("marketing_clients").delete().eq("id",t);if(e)throw e;y({isOpen:!0,title:"Sukces",message:"Klient zostaÅ‚ usuniÄ™ty.",type:"success"}),await _()}catch(e){console.error("BÅ‚Ä…d usuwania klienta:",e),y({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ usunÄ…Ä‡ klienta: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}}})},className:"px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg transition-all text-sm font-semibold",children:"UsuÅ„"})]})]},e.id))}),x&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>h(!1)}),(0,t.jsxs)("div",{className:"relative bg-gradient-to-br from-[#18232F] to-[#101820] rounded-2xl p-6 border-2 border-white/10 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] text-2xl font-bold text-white mb-6",children:p?"Edytuj Klienta":"Dodaj Nowego Klienta"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Nazwa * ",(0,t.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:b.name,onChange:e=>f({...b,name:e.target.value}),className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715]",placeholder:"Nazwa klienta",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),(0,t.jsx)("input",{type:"email",value:b.email,onChange:e=>f({...b,email:e.target.value}),className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715]",placeholder:"email@example.com"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Nazwa Firmy"}),(0,t.jsx)("input",{type:"text",value:b.company_name,onChange:e=>f({...b,company_name:e.target.value}),className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715]",placeholder:"Nazwa firmy"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Telefon"}),(0,t.jsx)("input",{type:"tel",value:b.phone,onChange:e=>f({...b,phone:e.target.value}),className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715]",placeholder:"+48 123 456 789"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Status"}),(0,t.jsx)(u.CustomSelect,{value:b.status,onChange:e=>f({...b,status:e}),placeholder:"Wybierz status",options:[{value:"active",label:"Aktywny"},{value:"inactive",label:"Nieaktywny"},{value:"archived",label:"Zarchiwizowany"}]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Notatki"}),(0,t.jsx)("textarea",{value:b.notes,onChange:e=>f({...b,notes:e.target.value}),className:"w-full bg-white/5 border-2 border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#fee715] focus:border-[#fee715] min-h-[100px]",placeholder:"Dodatkowe notatki o kliencie..."})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,t.jsx)("button",{onClick:z,className:"flex-1 bg-gradient-to-r from-[#fee715] to-[#00C9A7] text-[#101820] font-[Montserrat] font-bold py-3 px-4 rounded-xl hover:shadow-lg hover:shadow-[#fee715]/40 transition-all duration-300",children:p?"Zaktualizuj":"Dodaj"}),(0,t.jsx)("button",{onClick:()=>h(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white font-[Montserrat] font-semibold rounded-xl transition-all duration-300",children:"Anuluj"})]})]})]}),(0,t.jsx)(n.AlertModal,{isOpen:w.isOpen,title:w.title,message:w.message,type:w.type,onClose:()=>y(e=>({...e,isOpen:!1}))}),(0,t.jsx)(m,{isOpen:j.isOpen,title:j.title,message:j.message,confirmText:"UsuÅ„",cancelText:"Anuluj",type:"danger",onConfirm:j.onConfirm,onCancel:()=>k(e=>({...e,isOpen:!1}))})]})}],70920);var x=e.i(43262);let h=[{value:"documents",label:"Umowy i dokumenty"},{value:"courses",label:"Kursy"},{value:"marketing",label:"Marketing"},{value:"data",label:"Dane"},{value:"projects",label:"Projekty"}];e.s(["PanelClientsManagement",0,()=>{let{user:e}=(0,s.useAuth)(),[i,o]=(0,a.useState)([]),[d,c]=(0,a.useState)([]),[m,p]=(0,a.useState)(!0),[g,b]=(0,a.useState)(null),[f,w]=(0,a.useState)(null),[y,j]=(0,a.useState)({email:"",name:"",company_name:"",marketing_client_id:"",view_tags:[]}),[k,v]=(0,a.useState)(!1),[N,_]=(0,a.useState)({isOpen:!1,title:"",message:"",type:"info"}),z=async()=>{p(!0);try{let[e,t]=await Promise.all([r.supabase.rpc("get_panel_clients_for_admin"),r.supabase.from("marketing_clients").select("id, name, company_name").eq("status","active").order("name")]);if(e.error)throw e.error;o(e.data||[]),c(t.data||[])}catch(e){_({isOpen:!0,title:"BÅ‚Ä…d",message:e?.message||"Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ listy.",type:"error"})}finally{p(!1)}};(0,a.useEffect)(()=>{e&&z()},[e?.id]);let C=async()=>{if(e){if(0===y.view_tags.length)return void _({isOpen:!0,title:"BÅ‚Ä…d",message:"Wybierz co najmniej jeden widok.",type:"error"});v(!0);try{if("add"===g){let{data:t,error:a}=await r.supabase.rpc("get_user_id_by_email",{em:y.email.trim()});if(a||!t){_({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie znaleziono uÅ¼ytkownika o podanym adresie eâ€‘mail. UÅ¼ytkownik musi istnieÄ‡ w systemie (np. utwÃ³rz go w Supabase Dashboard).",type:"error"}),v(!1);return}let{data:s,error:i}=await r.supabase.from("panel_clients").insert({user_id:t,name:y.name.trim()||null,email:y.email.trim()||null,company_name:y.company_name.trim()||null,marketing_client_id:y.marketing_client_id||null,created_by:e.id}).select("id").single();if(i)throw i;for(let t of y.view_tags)await r.supabase.from("client_view_grants").insert({client_id:s.id,view_tag:t,granted_by:e.id});_({isOpen:!0,title:"Sukces",message:"UÅ¼ytkownik panelu zostaÅ‚ dodany.",type:"success"})}else if("edit"===g&&f){for(let t of(await r.supabase.from("panel_clients").update({name:y.name.trim()||null,company_name:y.company_name.trim()||null,marketing_client_id:y.marketing_client_id||null}).eq("id",f),await r.supabase.from("client_view_grants").delete().eq("client_id",f),y.view_tags))await r.supabase.from("client_view_grants").insert({client_id:f,view_tag:t,granted_by:e.id});_({isOpen:!0,title:"Sukces",message:"Zmiany zapisane.",type:"success"})}b(null),w(null),await z()}catch(e){_({isOpen:!0,title:"BÅ‚Ä…d",message:e?.message||"Nie udaÅ‚o siÄ™ zapisaÄ‡.",type:"error"})}finally{v(!1)}}};return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-[Montserrat] text-lg font-bold text-white",children:"Klienci panelu"}),(0,t.jsx)("p",{className:"text-gray-400 text-xs",children:"UÅ¼ytkownicy panelu klienta i przypisane widoki (Umowy, Kursy, Marketing, Dane, Projekty)"})]}),(0,t.jsx)("button",{onClick:()=>{w(null),j({email:"",name:"",company_name:"",marketing_client_id:"",view_tags:[]}),b("add")},className:"px-4 py-2 bg-[#fee715] text-[#101820] text-sm font-semibold rounded-lg hover:bg-[#fee715]/90",children:"+ Dodaj uÅ¼ytkownika"})]}),m?(0,t.jsx)(l.LoadingState,{variant:"block",skeleton:"table",label:"Åadowanie uÅ¼ytkownikÃ³wâ€¦"}):0===i.length?(0,t.jsx)("div",{className:"py-8 px-4 rounded-lg bg-white/5 border border-white/10 text-center text-gray-400 text-sm",children:"Brak uÅ¼ytkownikÃ³w. Kliknij â€žDodaj uÅ¼ytkownikaâ€ i podaj eâ€‘mail istniejÄ…cego uÅ¼ytkownika oraz wybierz widoki."}):(0,t.jsx)("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-white/10 bg-white/5",children:[(0,t.jsx)("th",{className:"text-left py-2 px-3 text-gray-400 font-medium",children:"Email"}),(0,t.jsx)("th",{className:"text-left py-2 px-3 text-gray-400 font-medium",children:"Nazwa"}),(0,t.jsx)("th",{className:"text-left py-2 px-3 text-gray-400 font-medium",children:"Widoki"}),(0,t.jsx)("th",{className:"text-right py-2 px-3 text-gray-400 font-medium",children:"Akcje"})]})}),(0,t.jsx)("tbody",{children:i.map(e=>(0,t.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[(0,t.jsx)("td",{className:"py-2 px-3 text-white",children:e.email||"â€”"}),(0,t.jsx)("td",{className:"py-2 px-3 text-gray-300",children:e.name||e.company_name||"â€”"}),(0,t.jsx)("td",{className:"py-2 px-3 text-gray-400",children:(e.view_tags||[]).join(", ")||"â€”"}),(0,t.jsx)("td",{className:"py-2 px-3 text-right",children:(0,t.jsx)("button",{onClick:()=>{w(e.id),j({email:e.email||"",name:e.name||"",company_name:e.company_name||"",marketing_client_id:e.marketing_client_id||"",view_tags:e.view_tags||[]}),b("edit")},className:"text-[#00C9A7] hover:underline text-xs",children:"Edytuj"})})]},e.id))})]})}),g&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/70",onClick:()=>b(null)}),(0,t.jsxs)("div",{className:"relative bg-[#18232F] rounded-xl p-5 border border-white/10 max-w-md w-full",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-white mb-4",children:"add"===g?"Dodaj uÅ¼ytkownika panelu":"Edytuj uprawnienia"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Eâ€‘mail *"}),(0,t.jsx)("input",{type:"email",value:y.email,onChange:e=>j(t=>({...t,email:e.target.value})),disabled:"edit"===g,placeholder:"email@example.com",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2 text-sm text-white placeholder-gray-500 disabled:opacity-60"}),"add"===g&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"UÅ¼ytkownik musi juÅ¼ istnieÄ‡ w systemie (auth)."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Nazwa"}),(0,t.jsx)("input",{type:"text",value:y.name,onChange:e=>j(t=>({...t,name:e.target.value})),placeholder:"ImiÄ™ / firma",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2 text-sm text-white placeholder-gray-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Nazwa firmy"}),(0,t.jsx)("input",{type:"text",value:y.company_name,onChange:e=>j(t=>({...t,company_name:e.target.value})),placeholder:"Firma",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2 text-sm text-white placeholder-gray-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Klient marketingowy (dla lejkÃ³w)"}),(0,t.jsx)(u.CustomSelect,{value:y.marketing_client_id,onChange:e=>j(t=>({...t,marketing_client_id:e})),placeholder:"â€” Brak â€”",options:[{value:"",label:"â€” Brak â€”"},...d.map(e=>({value:e.id,label:e.company_name?`${e.name} (${e.company_name})`:e.name}))],className:"w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-gray-400 mb-2",children:"Widoki (co najmniej jeden) *"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:h.map(({value:e,label:a})=>(0,t.jsx)(x.CustomCheckbox,{checked:y.view_tags.includes(e),onChange:t=>j(a=>({...a,view_tags:t?a.view_tags.includes(e)?a.view_tags:[...a.view_tags,e]:a.view_tags.filter(t=>t!==e)})),label:a,className:"text-sm"},e))})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-5",children:[(0,t.jsx)("button",{onClick:C,disabled:k,className:"px-4 py-2 bg-[#fee715] text-[#101820] text-sm font-semibold rounded-lg hover:bg-[#fee715]/90 disabled:opacity-50",children:k?"Zapisywanieâ€¦":"Zapisz"}),(0,t.jsx)("button",{onClick:()=>b(null),className:"px-4 py-2 bg-white/10 text-white text-sm rounded-lg hover:bg-white/20",children:"Anuluj"})]})]})]}),(0,t.jsx)(n.AlertModal,{isOpen:N.isOpen,title:N.title,message:N.message,type:N.type,onClose:()=>_(e=>({...e,isOpen:!1}))})]})}],60754);var p=e.i(94342);e.s(["ProposalsList",0,()=>{let{user:e}=(0,s.useAuth)(),i=(0,c.useRouter)(),[o,d]=(0,a.useState)([]),[m,u]=(0,a.useState)(!0),[x,h]=(0,a.useState)("all"),[g,b]=(0,a.useState)({isOpen:!1,title:"",message:"",type:"info"});(0,a.useEffect)(()=>{e&&f()},[e,x]);let f=async()=>{try{u(!0);let e=r.supabase.from("proposals").select(`
          *,
          client:panel_clients(name, company_name),
          marketing_client:marketing_clients(name, company_name)
        `).order("updated_at",{ascending:!1});"all"!==x&&(e=e.eq("status",x));let{data:t,error:a}=await e;if(a)throw console.error("BÅ‚Ä…d zapytania proposals:",a),a;let s=[];for(let e of t||[]){let t=null,a=null;try{let{data:a}=await r.supabase.from("proposal_tracking_events").select("created_at").eq("proposal_id",e.id).eq("event_type","view").order("created_at",{ascending:!1}).limit(1).maybeSingle();t=a?.created_at||null}catch(t){console.warn("BÅ‚Ä…d pobierania tracking dla oferty",e.id,t)}try{let{data:t}=await r.supabase.from("proposal_acceptances").select("accepted_at").eq("proposal_id",e.id).maybeSingle();a=t?.accepted_at||null}catch(t){console.warn("BÅ‚Ä…d pobierania acceptance dla oferty",e.id,t)}s.push({...e,client:Array.isArray(e.client)?e.client[0]:e.client,marketing_client:Array.isArray(e.marketing_client)?e.marketing_client[0]:e.marketing_client,last_viewed_at:t,accepted_at:a})}d(s)}catch(e){console.error("BÅ‚Ä…d Å‚adowania ofert:",e),b({isOpen:!0,title:"BÅ‚Ä…d",message:"Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ ofert: "+(e.message||"Nieznany bÅ‚Ä…d"),type:"error"})}finally{u(!1)}},w=e=>({draft:"Szkic",sent:"WysÅ‚ana",viewed:"Otworzona",accepted:"Zaakceptowana",expired:"WygasÅ‚a",archived:"Zarchiwizowana"})[e]||e,y=e=>{let t={draft:"bg-yellow-500/20 text-yellow-300 border-yellow-500/50",sent:"bg-blue-500/20 text-blue-300 border-blue-500/50",viewed:"bg-purple-500/20 text-purple-300 border-purple-500/50",accepted:"bg-green-500/20 text-green-300 border-green-500/50",expired:"bg-gray-500/20 text-gray-300 border-gray-500/50",archived:"bg-gray-500/20 text-gray-300 border-gray-500/50"};return t[e]||t.draft},j="all"===x?o:o.filter(e=>e.status===x);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-[Montserrat] text-2xl font-bold text-white mb-2",children:"Oferty"}),(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:"TwÃ³rz i zarzÄ…dzaj ofertami dla swoich klientÃ³w"})]}),(0,t.jsxs)("button",{onClick:()=>i.push("/admin/proposals/new"),className:"px-6 py-3 bg-gradient-to-r from-[#fee715] to-[#00C9A7] text-[#101820] font-[Montserrat] font-bold rounded-xl hover:shadow-2xl hover:shadow-[#fee715]/40 transform hover:scale-105 transition-all duration-300 flex items-center gap-2",children:[(0,t.jsx)(p.FileText,{size:20,weight:"bold"}),"Nowa Oferta"]})]}),(0,t.jsx)("div",{className:"mb-6 flex gap-2 flex-wrap",children:["all","draft","sent","viewed","accepted","expired","archived"].map(e=>(0,t.jsx)("button",{onClick:()=>h(e),className:`px-4 py-2 rounded-lg font-semibold transition-all text-sm ${x===e?"all"===e?"bg-[#fee715] text-[#101820]":y(e).replace("/20","").replace("/50",""):"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:"all"===e?"Wszystkie":w(e)},e))}),m?(0,t.jsx)(l.LoadingState,{variant:"block",skeleton:"cards",label:"Åadowanie ofertâ€¦"}):0===j.length?(0,t.jsxs)("div",{className:"bg-white/5 rounded-xl p-12 text-center text-gray-400",children:[(0,t.jsx)(p.FileText,{size:48,weight:"thin",className:"mx-auto mb-4 text-gray-500"}),(0,t.jsx)("p",{className:"text-lg mb-2",children:"Brak ofert"}),(0,t.jsx)("p",{className:"text-sm",children:'Kliknij "Nowa Oferta", aby rozpoczÄ…Ä‡'})]}):(0,t.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(e=>(0,t.jsxs)("div",{className:"bg-gradient-to-br from-white/5 to-white/3 rounded-xl p-6 border-2 border-white/10 hover:border-[#fee715]/50 transition-all duration-300 cursor-pointer",onClick:()=>i.push(`/admin/proposals/${e.id}`),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-[Montserrat] font-bold text-white text-lg mb-1",children:e.title}),(e.client||e.marketing_client)&&(0,t.jsxs)("p",{className:"text-gray-400 text-sm",children:[e.client?.name||e.marketing_client?.name,e.client?.company_name&&` â€¢ ${e.client.company_name}`,e.marketing_client?.company_name&&` â€¢ ${e.marketing_client.company_name}`]})]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-lg text-xs font-semibold border ${y(e.status)}`,children:w(e.status)})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mb-4 space-y-1",children:[e.last_viewed_at&&(0,t.jsxs)("div",{children:["Ostatnie otwarcie: ",new Date(e.last_viewed_at).toLocaleDateString("pl-PL")]}),e.accepted_at&&(0,t.jsxs)("div",{children:["Zaakceptowana: ",new Date(e.accepted_at).toLocaleDateString("pl-PL")]}),!e.last_viewed_at&&!e.accepted_at&&(0,t.jsxs)("div",{children:["Utworzona: ",new Date(e.created_at).toLocaleDateString("pl-PL")]})]}),(0,t.jsx)("div",{className:"flex gap-2 pt-4 border-t border-white/10",onClick:e=>e.stopPropagation(),children:(0,t.jsx)("button",{onClick:()=>i.push(`/admin/proposals/${e.id}`),className:"flex-1 px-4 py-2 bg-[#fee715] text-[#101820] rounded-lg transition-all text-sm font-semibold hover:bg-[#fee715]/90",children:"OtwÃ³rz"})})]},e.id))}),(0,t.jsx)(n.AlertModal,{isOpen:g.isOpen,title:g.title,message:g.message,type:g.type,onClose:()=>b(e=>({...e,isOpen:!1}))})]})}],46986);var g=e.i(50506),b=e.i(68708),f=new Map;f.set("bold",function(e){return a.default.createElement(a.default.Fragment,null,a.default.createElement("path",{d:"M128,88a32,32,0,0,1,32-32h64a8,8,0,0,1,8,8V192a8,8,0,0,1-8,8H160a32,32,0,0,0-32,32",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"}),a.default.createElement("path",{d:"M24,192a8,8,0,0,0,8,8H96a32,32,0,0,1,32,32V88A32,32,0,0,0,96,56H32a8,8,0,0,0-8,8Z",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"}))}),f.set("duotone",function(e){return a.default.createElement(a.default.Fragment,null,a.default.createElement("path",{d:"M224,56H160a32,32,0,0,0-32,32A32,32,0,0,0,96,56H32a8,8,0,0,0-8,8V192a8,8,0,0,0,8,8H96a32,32,0,0,1,32,32,32,32,0,0,1,32-32h64a8,8,0,0,0,8-8V64A8,8,0,0,0,224,56Z",opacity:"0.2"}),a.default.createElement("path",{d:"M128,88a32,32,0,0,1,32-32h64a8,8,0,0,1,8,8V192a8,8,0,0,1-8,8H160a32,32,0,0,0-32,32",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),a.default.createElement("path",{d:"M24,192a8,8,0,0,0,8,8H96a32,32,0,0,1,32,32V88A32,32,0,0,0,96,56H32a8,8,0,0,0-8,8Z",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}))}),f.set("fill",function(){return a.default.createElement(a.default.Fragment,null,a.default.createElement("path",{d:"M96,208a24.1,24.1,0,0,1,24,24,8,8,0,0,0,16,0,24.1,24.1,0,0,1,24-24h64a16,16,0,0,0,16-16V64a16,16,0,0,0-16-16H176a40,40,0,0,0-40,40v80a8,8,0,0,1-16,0V88A40,40,0,0,0,80,48H32A16,16,0,0,0,16,64V192a16,16,0,0,0,16,16Z"}))}),f.set("light",function(e){return a.default.createElement(a.default.Fragment,null,a.default.createElement("path",{d:"M128,88a32,32,0,0,1,32-32h64a8,8,0,0,1,8,8V192a8,8,0,0,1-8,8H160a32,32,0,0,0-32,32",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"}),a.default.createElement("path",{d:"M24,192a8,8,0,0,0,8,8H96a32,32,0,0,1,32,32V88A32,32,0,0,0,96,56H32a8,8,0,0,0-8,8Z",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"}))}),f.set("thin",function(e){return a.default.createElement(a.default.Fragment,null,a.default.createElement("path",{d:"M128,88a32,32,0,0,1,32-32h64a8,8,0,0,1,8,8V192a8,8,0,0,1-8,8H160a32,32,0,0,0-32,32",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"}),a.default.createElement("path",{d:"M24,192a8,8,0,0,0,8,8H96a32,32,0,0,1,32,32V88A32,32,0,0,0,96,56H32a8,8,0,0,0-8,8Z",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"}))}),f.set("regular",function(e){return a.default.createElement(a.default.Fragment,null,a.default.createElement("path",{d:"M128,88a32,32,0,0,1,32-32h64a8,8,0,0,1,8,8V192a8,8,0,0,1-8,8H160a32,32,0,0,0-32,32",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),a.default.createElement("path",{d:"M24,192a8,8,0,0,0,8,8H96a32,32,0,0,1,32,32V88A32,32,0,0,0,96,56H32a8,8,0,0,0-8,8Z",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}))});var w=function(e,t){return(0,g.renderPathForWeight)(e,t,f)},y=(0,a.forwardRef)(function(e,t){return a.default.createElement(b.default,Object.assign({ref:t},e,{renderPath:w}))});y.displayName="BookOpen",e.s(["BookOpen",0,y],84279)}]);