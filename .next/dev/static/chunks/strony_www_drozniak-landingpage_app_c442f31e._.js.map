{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/stanislawdrozniak/strony_www/drozniak-landingpage/app/hooks/useClientPanel.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase-client';\nimport { useAuth } from './useAuth';\n\nexport type ViewTag = 'documents' | 'courses' | 'marketing' | 'data' | 'projects';\n\nexport interface PanelClient {\n  id: string;\n  marketing_client_id: string | null;\n}\n\nexport const useClientPanel = () => {\n  const { user } = useAuth();\n  const [panelClient, setPanelClient] = useState<PanelClient | null>(null);\n  const [viewGrants, setViewGrants] = useState<ViewTag[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!user) {\n      setPanelClient(null);\n      setViewGrants([]);\n      setLoading(false);\n      return;\n    }\n    load();\n  }, [user?.id]);\n\n  const load = async () => {\n    if (!user) return;\n    setLoading(true);\n    try {\n      console.log('useClientPanel: loading for user', user.id, user.email);\n      // Używamy funkcji SECURITY DEFINER zamiast bezpośredniego zapytania - omija RLS\n      const [pcRes, grantsRes] = await Promise.all([\n        supabase.rpc('get_my_panel_client'),\n        supabase.rpc('get_my_view_grants'),\n      ]);\n\n      console.log('useClientPanel: pcRes (from RPC)', pcRes);\n      console.log('useClientPanel: pcRes.data', pcRes.data);\n      console.log('useClientPanel: pcRes.error', pcRes.error);\n      console.log('useClientPanel: grantsRes', grantsRes);\n      console.log('useClientPanel: grantsRes.data', grantsRes.data);\n      console.log('useClientPanel: grantsRes.error', grantsRes.error);\n\n      if (pcRes.error) {\n        console.error('useClientPanel: get_my_panel_client error', pcRes.error);\n        console.error('useClientPanel: error details', JSON.stringify(pcRes.error, null, 2));\n        setPanelClient(null);\n        setViewGrants([]);\n        return;\n      }\n\n      // get_my_panel_client zwraca TABLE, więc data to array\n      const pcData = Array.isArray(pcRes.data) && pcRes.data.length > 0 ? pcRes.data[0] : null;\n      setPanelClient(pcData ? { id: pcData.id, marketing_client_id: pcData.marketing_client_id } : null);\n\n      // Jeśli nie ma panel_clients, nie ma też view_grants\n      if (!pcData) {\n        setViewGrants([]);\n        return;\n      }\n\n      if (grantsRes.error) {\n        console.error('useClientPanel: get_my_view_grants error', grantsRes.error);\n        setViewGrants([]);\n        return;\n      }\n\n      const tags = (Array.isArray(grantsRes.data) ? grantsRes.data : []) as string[];\n      setViewGrants(tags.filter((t): t is ViewTag => ['documents','courses','marketing','data','projects'].includes(t)));\n    } catch (e) {\n      console.error('useClientPanel load error:', e);\n      setPanelClient(null);\n      setViewGrants([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return { panelClient, viewGrants, loading, reload: load };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAaO,MAAM,iBAAiB;;IAC5B,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,8KAAO;IACxB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,kNAAQ,EAAqB;IACnE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,kNAAQ,EAAY,EAAE;IAC1D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,kNAAQ,EAAC;IAEvC,IAAA,mNAAS;oCAAC;YACR,IAAI,CAAC,MAAM;gBACT,eAAe;gBACf,cAAc,EAAE;gBAChB,WAAW;gBACX;YACF;YACA;QACF;mCAAG;QAAC,MAAM;KAAG;IAEb,MAAM,OAAO;QACX,IAAI,CAAC,MAAM;QACX,WAAW;QACX,IAAI;YACF,QAAQ,GAAG,CAAC,oCAAoC,KAAK,EAAE,EAAE,KAAK,KAAK;YACnE,gFAAgF;YAChF,MAAM,CAAC,OAAO,UAAU,GAAG,MAAM,QAAQ,GAAG,CAAC;gBAC3C,iLAAQ,CAAC,GAAG,CAAC;gBACb,iLAAQ,CAAC,GAAG,CAAC;aACd;YAED,QAAQ,GAAG,CAAC,oCAAoC;YAChD,QAAQ,GAAG,CAAC,8BAA8B,MAAM,IAAI;YACpD,QAAQ,GAAG,CAAC,+BAA+B,MAAM,KAAK;YACtD,QAAQ,GAAG,CAAC,6BAA6B;YACzC,QAAQ,GAAG,CAAC,kCAAkC,UAAU,IAAI;YAC5D,QAAQ,GAAG,CAAC,mCAAmC,UAAU,KAAK;YAE9D,IAAI,MAAM,KAAK,EAAE;gBACf,QAAQ,KAAK,CAAC,6CAA6C,MAAM,KAAK;gBACtE,QAAQ,KAAK,CAAC,iCAAiC,KAAK,SAAS,CAAC,MAAM,KAAK,EAAE,MAAM;gBACjF,eAAe;gBACf,cAAc,EAAE;gBAChB;YACF;YAEA,uDAAuD;YACvD,MAAM,SAAS,MAAM,OAAO,CAAC,MAAM,IAAI,KAAK,MAAM,IAAI,CAAC,MAAM,GAAG,IAAI,MAAM,IAAI,CAAC,EAAE,GAAG;YACpF,eAAe,SAAS;gBAAE,IAAI,OAAO,EAAE;gBAAE,qBAAqB,OAAO,mBAAmB;YAAC,IAAI;YAE7F,qDAAqD;YACrD,IAAI,CAAC,QAAQ;gBACX,cAAc,EAAE;gBAChB;YACF;YAEA,IAAI,UAAU,KAAK,EAAE;gBACnB,QAAQ,KAAK,CAAC,4CAA4C,UAAU,KAAK;gBACzE,cAAc,EAAE;gBAChB;YACF;YAEA,MAAM,OAAQ,MAAM,OAAO,CAAC,UAAU,IAAI,IAAI,UAAU,IAAI,GAAG,EAAE;YACjE,cAAc,KAAK,MAAM,CAAC,CAAC,IAAoB;oBAAC;oBAAY;oBAAU;oBAAY;oBAAO;iBAAW,CAAC,QAAQ,CAAC;QAChH,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,eAAe;YACf,cAAc,EAAE;QAClB,SAAU;YACR,WAAW;QACb;IACF;IAEA,OAAO;QAAE;QAAa;QAAY;QAAS,QAAQ;IAAK;AAC1D;GAtEa;;QACM,8KAAO"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///Users/stanislawdrozniak/strony_www/drozniak-landingpage/app/panel/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useClientPanel } from '@/app/hooks/useClientPanel';\nimport { LoadingState } from '@/components/LoadingState';\n\nconst TAB: Record<string, { path: string; label: string }> = {\n  documents: { path: 'documents', label: 'Umowy i dokumenty' },\n  courses: { path: 'courses', label: 'Kursy' },\n  marketing: { path: 'marketing', label: 'Marketing' },\n  data: { path: 'data', label: 'Dane' },\n  projects: { path: 'projects', label: 'Projekty' },\n};\n\nconst TAB_ORDER = ['data', 'documents', 'courses', 'marketing', 'projects'];\n\nexport default function PanelRootPage() {\n  const router = useRouter();\n  const { panelClient, viewGrants, loading } = useClientPanel();\n\n  useEffect(() => {\n    if (!loading) {\n      // Jeśli nie ma panelu klienta, przekieruj do widoku z komunikatem\n      if (!panelClient) {\n        // Użyj catch-all route, który obsłuży brak panelu\n        router.replace('/panel/data');\n        return;\n      }\n      \n      // Jeśli nie ma uprawnień, przekieruj do widoku z komunikatem\n      if (viewGrants.length === 0) {\n        router.replace('/panel/data');\n        return;\n      }\n      \n      // Jeśli są uprawnienia, przekieruj do pierwszego dostępnego widoku\n      if (viewGrants.length > 0) {\n        const orderedGrants = TAB_ORDER.filter((t) => viewGrants.includes(t as any));\n        const first = TAB[orderedGrants[0]];\n        if (first) {\n          router.replace(`/panel/${first.path}`);\n        }\n      }\n    }\n  }, [loading, panelClient, viewGrants, router]);\n\n  return <LoadingState variant=\"fullscreen\" label=\"Ładowanie panelu…\" />;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAOA,MAAM,MAAuD;IAC3D,WAAW;QAAE,MAAM;QAAa,OAAO;IAAoB;IAC3D,SAAS;QAAE,MAAM;QAAW,OAAO;IAAQ;IAC3C,WAAW;QAAE,MAAM;QAAa,OAAO;IAAY;IACnD,MAAM;QAAE,MAAM;QAAQ,OAAO;IAAO;IACpC,UAAU;QAAE,MAAM;QAAY,OAAO;IAAW;AAClD;AAEA,MAAM,YAAY;IAAC;IAAQ;IAAa;IAAW;IAAa;CAAW;AAE5D,SAAS;;IACtB,MAAM,SAAS,IAAA,2LAAS;IACxB,MAAM,EAAE,WAAW,EAAE,UAAU,EAAE,OAAO,EAAE,GAAG,IAAA,4LAAc;IAE3D,IAAA,mNAAS;mCAAC;YACR,IAAI,CAAC,SAAS;gBACZ,kEAAkE;gBAClE,IAAI,CAAC,aAAa;oBAChB,kDAAkD;oBAClD,OAAO,OAAO,CAAC;oBACf;gBACF;gBAEA,6DAA6D;gBAC7D,IAAI,WAAW,MAAM,KAAK,GAAG;oBAC3B,OAAO,OAAO,CAAC;oBACf;gBACF;gBAEA,mEAAmE;gBACnE,IAAI,WAAW,MAAM,GAAG,GAAG;oBACzB,MAAM,gBAAgB,UAAU,MAAM;iEAAC,CAAC,IAAM,WAAW,QAAQ,CAAC;;oBAClE,MAAM,QAAQ,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC;oBACnC,IAAI,OAAO;wBACT,OAAO,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,IAAI,EAAE;oBACvC;gBACF;YACF;QACF;kCAAG;QAAC;QAAS;QAAa;QAAY;KAAO;IAE7C,qBAAO,sOAAC,uLAAY;QAAC,SAAQ;QAAa,OAAM;;;;;;AAClD;GA/BwB;;QACP,2LAAS;QACqB,4LAAc;;;KAFrC"}}]
}